
dictInObj = {
				
	'constLang':'ع | E',
	'noConnectionMsg':'تعثر الاتصال بالنظام، الرجاء المحاولة في وقت لاحق',
	'noConnectionMsgCurrency':'غير قادر على الحصول على سعر الصرف',
	
	'btn_Back':'رجوع',
	
	
	/*wheel page*/
	'tit_oBanking':"دخول",
	'tit_toolsSimulator':"محول العملات",
	'tit_contact':"أتصل بنا",
	'tit_productsOffers':"المنتجات والعروض",
	'tit_settings':"أعدادات",
	'tit_more':"خدمات أخرى",
	
	/*More page*/
	'more_call':"أتصل في مصرف الراجحي",
	'more_friend':"أخبر صديق",
	'more_feedback':"ملاحظات على التطبيق",
	'more_tocs':"الاتفاقات والشروط والأحكام",
	'more_about':"عن مصرف الراجحي",
	'more_faq':"الأسئلة المتكررة",
	
	/*Tell a Friend page*/
	'taf_mail':"البريد الإلكتروني",
	'taf_facebook':"فيس بوك",
	'taf_twitter':"تويتر",
	'taf_sms':"الرسائل النصية",
	'taf_message':"الآن بإمكانك استخدام تطبيق مصرف الراجحي على اجهزة الإندرويد",
	
	/*logout page*/
	'logout_ok':'تم تسجيل الخروج بنجاح لقد خرجت من النظام. شكرا لإستخدامك خدمة المباشر للانترنت المصرفية. دخول جديد',
	'logout_timeout':'انتهت دورتنا بسبب فترة طويلة من الخمول',
		
	/*contact page*/
	'contact_call':"أتصل بنا",
	'contact_mail':"أرسال بريدالإلكتروني",
	
	
	/*products & offers pages*/
	'products_offers_title': "المنتجات والعروض",
	'products_offers_More': "المزيد من المعلومات",
	
	/*tools(converter) pages*/
	'currencyConverter_tit':'محول العملات',
	'currencyConverter_rate':'تحويل العملة',
	'currencyConverter_help':'أضغظ على أيقونة العلم لتغيير العملة',
	'currencyConverter_change':'< >',
	'currencyConverter_rate':'سعر الصرف',
	
	'AUD':'دولار استرالي',
	'BDT':'&#1578;&#1603;&#1575;  &#1576;&#1606;&#1580;&#1604;&#1575;&#1583;&#1588;&#1610;&#1577;',
	'BND':'&#1583;&#1608;&#1604;&#1575;&#1585;  &#1576;&#1585;&#1606;&#1610;',
	'CAD':'&#1583;&#1608;&#1604;&#1575;&#1585;  &#1603;&#1606;&#1583;&#1610;',
	'CYP':'&#1580;&#1606;&#1610;&#1607;  &#1602;&#1576;&#1585;&#1589;&#1610;',
	'DKK':'&#1603;&#1585;&#1608;&#1606;  &#1583;&#1606;&#1605;&#1575;&#1585;&#1603;&#1610;',
	'EGP':'&#1580;&#1606;&#1610;&#1607;  &#1605;&#1589;&#1585;&#1610;',
	'EUR':'&#1610;&#1608;&#1585;&#1608;',
	'HKD':'&#1583;&#1608;&#1604;&#1575;&#1585;  &#1607;&#1608;&#1606;&#1594; &#1603;&#1608;&#1606;&#1594;',
	'INR':'&#1585;&#1608;&#1576;&#1610;&#1577;  &#1607;&#1606;&#1583;&#1610;&#1577;',
	'IDR':'&#1585;&#1608;&#1576;&#1610;&#1577;  &#1575;&#1606;&#1583;&#1608;&#1606;&#1610;&#1587;&#1610;&#1577;',
	'IRR':'&#1585;&#1610;&#1575;&#1604; &#1573;&#1610;&#1585;&#1575;&#1606;&#1610;',
	'JPY':'&#1610;&#1606;  &#1610;&#1575;&#1576;&#1575;&#1606;&#1610;',
	'JOD':'&#1583;&#1610;&#1606;&#1575;&#1585;  &#1571;&#1585;&#1583;&#1606;&#1610;',
	'KES':'&#1588;&#1610;&#1604;&#1610;&#1606;&#1594;  &#1603;&#1610;&#1606;&#1610;',
	'KWD':'&#1583;&#1610;&#1606;&#1575;&#1585;  &#1603;&#1608;&#1610;&#1578;&#1610;',
	'LBP':'&#1580;&#1606;&#1610;&#1607;  &#1604;&#1576;&#1606;&#1575;&#1606;&#1610;',
	'MYR':'&#1585;&#1610;&#1582;&#1578;  &#1605;&#1575;&#1604;&#1610;&#1586;&#1610;&#1577;',
	'MUR':'&#1585;&#1608;&#1576;&#1610;&#1577;  &#1605;&#1583;&#1594;&#1588;&#1602;&#1585;',
	'MAD':'&#1583;&#1585;&#1607;&#1605;  &#1605;&#1594;&#1585;&#1576;&#1610;',
	'NPR':'&#1585;&#1608;&#1576;&#1610;&#1577;  &#1606;&#1610;&#1576;&#1575;&#1604;&#1610;',
	'NZD':'&#1583;&#1608;&#1604;&#1575;&#1585;  &#1606;&#1610;&#1608;&#1586;&#1604;&#1606;&#1583;&#1610;',
	'NOK':'&#1603;&#1585;&#1608;&#1606;  &#1606;&#1585;&#1608;&#1610;&#1580;&#1610;',
	'OMR':'&#1585;&#1610;&#1575;&#1604;  &#1593;&#1605;&#1575;&#1606;&#1610;',
	'PKR':'&#1585;&#1608;&#1576;&#1610;&#1577;  &#1576;&#1575;&#1603;&#1587;&#1578;&#1575;&#1606;&#1610;',
	'PHP':'&#1576;&#1610;&#1587;&#1608;  &#1601;&#1604;&#1576;&#1610;&#1606;&#1610;',
	'PLN':'&#1586;&#1604;&#1608;&#1578;&#1610; &#1576;&#1608;&#1604;&#1606;&#1583;&#1610;&#1577;',
	'GBP':'&#1580;&#1606;&#1610;&#1607;  &#1573;&#1587;&#1578;&#1585;&#1604;&#1610;&#1606;&#1610;',
	'QAR':'&#1585;&#1610;&#1575;&#1604;  &#1602;&#1591;&#1585;&#1610;',
	'SAR':'&#1585;&#1610;&#1575;&#1604; &#1587;&#1593;&#1608;&#1583;&#1610;',
	'XOF':'&#1601;&#1585;&#1606;&#1603;  &#1587;&#1606;&#1594;&#1575;&#1604;&#1610;',
	'SGD':'&#1583;&#1608;&#1604;&#1575;&#1585;  &#1587;&#1606;&#1594;&#1575;&#1601;&#1608;&#1585;&#1610;',
	'ZAR':'&#1585;&#1575;&#1606;&#1583;  &#1580;&#1606;&#1608;&#1576; &#1571;&#1601;&#1585;&#1610;&#1602;&#1610;',
	'LKR':'&#1585;&#1608;&#1576;&#1610;&#1607;  &#1587;&#1585;&#1610;&#1604;&#1575;&#1606;&#1603;&#1610;',
	'SDD':'&#1583;&#1610;&#1606;&#1575;&#1585;  &#1587;&#1608;&#1583;&#1575;&#1606;&#1610;',
	'SEK':'&#1603;&#1585;&#1608;&#1606;&#1575;  &#1587;&#1608;&#1610;&#1583;&#1610;&#1577;',
	'CHF':'&#1601;&#1585;&#1606;&#1603;  &#1587;&#1608;&#1610;&#1587;&#1585;&#1610;',
	'SYP':'&#1580;&#1606;&#1610;&#1607;  &#1587;&#1608;&#1585;&#1610;',
	'THB':'&#1576;&#1607;&#1578;  &#1578;&#1575;&#1610;&#1604;&#1575;&#1606;&#1583;&#1610;',
	'TND':'&#1583;&#1610;&#1606;&#1575;&#1585;  &#1578;&#1608;&#1606;&#1587;&#1610;',
	'TRL':'&#1604;&#1610;&#1585;&#1607;  &#1578;&#1585;&#1603;&#1610;&#1577;',
	'AED':'&#1583;&#1585;&#1607;&#1605;  &#1573;&#1605;&#1575;&#1585;&#1575;&#1578;&#1610;',
	'USD':'&#1583;&#1608;&#1604;&#1575;&#1585; &#1571;&#1605;&#1585;&#1610;&#1603;&#1610;',
	'YER':'&#1585;&#1610;&#1575;&#1604;  &#1610;&#1605;&#1606;&#1610;',
	'BRL':' &#x0643;&#x0631;&#x0648;&#x0632;&#x064A;&#x0631;&#x0648; &#x0628;&#x0631;&#x0627;&#x0632;&#x064A;&#x0644;&#x064A;',
	'CNY':' &#1610;&#1608;&#1575;&#1606; &#1575;&#1604;&#1589;&#1610;&#1606;&#1610;',
};



dictInObj = {
				
	'constLang':'E | ع',
	'noConnectionMsg':'There appears to be a communication error between your device and our system. Try again later.',
	'noConnectionMsgCurrency':'Unable to get exchange rate.',
	
	'btn_Back':'Back',
	
	/*wheel page*/
	'tit_oBanking':"Login",
	'tit_toolsSimulator':"Currency Converter",
	'tit_contact':"Call Al Rajhi",
	'tit_productsOffers':"Products & Offers",
	'tit_settings':"Settings",
	'tit_more':"More Services",
	
	/*More page*/
	'more_call':"Call Al Rajhi Bank",
	'more_friend':"Tell a Friend",
	'more_feedback':"Application Feedback",
	'more_tocs':"Terms & Conditions",
	'more_about':"About Us",
	'more_faq':"FAQs",
	
	/*Tell a Friend page*/
	'taf_mail':"E-Mail",
	'taf_facebook':"Facebook",
	'taf_twitter':"Twitter",
	'taf_sms':"SMS",
	'taf_message':"Did you try the android mobile banking App for Al Rajhi Bank, it is great!",
	
	/*logout page*/
	'logout_ok':'You have logged out successfully. Thank you for using Al Mubasher Online Banking Services.',
	'logout_timeout':'Your session has expired due to an extended period of inactivity.',
		
	/*contact page*/
	'contact_call':"Call Al Rajhi",
	'contact_mail':"Send an E-Mail",
	
	/*products & offers pages*/
	'products_offers_title':"Products and Offers",
	'products_offers_More': "More info",
	
	/*tools(converter) pages*/
	'currencyConverter_tit':'Currency converter',
	'currencyConverter_rate':'EXCHANGE RATE:',
	'currencyConverter_help':'Press the flag icon in order to change currency',
	'currencyConverter_change':'< >',
	'currencyConverter_rate':'Ex.rate',

	'AUD':'AUSTRALIAN DOLLAR',
	'BHD':'BAHRAINI DINAR',
	'BDT':'BANGLADESHI TAKA',
	'BND':'BRUNEI DOLLAR',
	'CAD':'CANADIAN DOLLAR',
	'CNY':'CHINESE YUAN',
	'CYP':'CYPRIOT POUND',
	'DKK':'DANISH KRONE',
	'EGP':'EGYPTIAN POUND',
	'EUR':'EURO',
	'HKD':'HONG KONG DOLLAR',
	'INR':'INDIAN RUPEE',
	'IDR':'INDONESIAN RUPIAH',
	'IRR':'IRANI RIYAL',
	'JPY':'JAPANESE YEN',
	'JOD':'JORDANIAN DINAR',
	'KES':'KENYAN SHILLING',
	'KWD':'KUWAITI DINAR',
	'LBP':'LEBANESE POUND',
	'MYR':'MALAYSIAN RINGGIT',
	'MUR':'MAURITIUS RUPEE',
	'MAD':'MOROCCAN DIRHAM',
	'NPR':'NEPALESE RUPEE',
	'NZD':'NEW ZEALAND DOLLAR',
	'NOK':'NORWEGIAN KRONE',
	'OMR':'OMANI RIYAL',
	'PKR':'PAKISTANI RUPEE',
	'PHP':'PHILIPPINES PESO',
	'PLN':'POLAND ZLOTY',
	'GBP':'POUND STERLING',
	'QAR':'QATARI RIYAL',
	'SAR':'SAUDI RIYAL',
	'XOF':'SENEGALESE FRANC',
	'SGD':'SINGAPORE DOLLAR',
	'ZAR':'SOUTH AFRICAN RAND',
	'LKR':'SRI LANKAN RUPEE',
	'SDD':'SUDANESE DINAR',
	'SEK':'SWEDISH KRONA',
	'CHF':'SWISS FRANC',
	'SYP':'SYRIAN POUND',
	'THB':'THAILAND BAHT',
	'TND':'TUNISIAN DINAR',
	'TRL':'TURKISH LIRA',
	'AED':'UAE DIRHAM',
	'USD':'US DOLLAR',
	'YER':'YEMENI RIYAL',
	'BRL': 'BRAZILIAN CRUZEIRO'
	
};

//Arranque de sistemas, configuraciones, etc etc etc
var GestorIdiomas;
var GestorPrefs;
var ProductsManager;


//var Proxy;
var History;
var typeLocator;
var BannerManager;
var BannerManagerPopUp;
var CurrentPage;



var ConstPages={
	'Element_Menu' : 'divMenu',
	'Element_Banner' : 'imgBanner',
	'Element_BannerPopUp' : 'imgBannerPopUp'	
};

/*
 * Cuidado, el orden de inicialización de los 'objetos' es importante
 */
function init(){
    //console.log('Metodo init');
    GestorPrefs = new _GestorPrefs();
   	Utils = new _Utils();

	ProductsManager = new _ProductsManager();
	GestorIdiomas = new _GestorIdiomas();
    GestorIdiomas.init(initCallBack);
	BannerManager = new _BannerManager();
	BannerManagerPopUp = new _BannerManager();
	
	BannerManager.init(ConstF.BannerId); 
	BannerManagerPopUp.init(ConstF.BannerIdPopUp); 

    History = new _History();
	//$.ajaxSetup({ cache: false });
	if (ConstF.traceLog) console.log('ajaxSetup set to cache false - Time:'  + new Date().getTime());
    
}

//Encargado de comprobar que los sistemas estan cargados y por tanto cambiar de pagina a index
//Es invocado al acabar de cargar todos los subsistemas
var core_arrancado = false;
function initCallBack(){
	//console.log('Init callback');
	if(!core_arrancado){
		if(GestorIdiomas!=null){
			core_arrancado = true;
			//console.log(GestorIdiomas.getLang());
			//console.log('Inyeccion CSS');
			injectCSSByPlatform();
			
			
			f001_fixDoubleClickAndroid42();
			
			browse('../comun/pages/wheel.html','none',true);
		}
	}
}

function injectCSSByPlatform()
{
	var platformCSSLine = null;

	if (Utils.isAndroid())
		platformCSSLine = '<link rel="stylesheet" href="../comun/themes/default/platform_themes/Android/platform.css" />';
	else if (Utils.isIphone())
		platformCSSLine = '<link rel="stylesheet" href="../comun/themes/default/platform_themes/iPhone/platform.css" />';
	else if (Utils.isWindowsPhone())
		platformCSSLine = '<link rel="stylesheet" href="../comun/themes/default/platform_themes/WindowsPhone/platform.css" />';

	if (platformCSSLine != null)
	{
		//console.log('Inyectar CSS: ' + platformCSSLine);
		$('head').append(platformCSSLine);
	}
}


//Controlador hacia atras para emplear en los botones y en los eventos
function backAction(e){

	//console.log('Atrás');
    	//console.log(History.topPage());
    if(e!=null)
    	e.preventDefault();
    	
    if(History.size()==0){
          console.log('Vacia la pila, salimos');
          navigator.app.exitApp();
      }
  	else { //Hay historia (Vaciar siempre la pila antes de cambiar)
  		ShowLoadingMessage();
  		if(History.topPage()=='#wheel'){
     	  //Como es index, vacio la pila
  		  History.clear();
          //console.log("Vuelta a wheel");
          $.mobile.changePage($.mobile.path.get() + "wheel.html", {transition: "none"});
        } else if(History.topPage()=='#more'){
  		  History.pop();
          //console.log("Vuelta a more");
          $.mobile.changePage($.mobile.path.get() + "more.html", {transition: "none"});
       	} else if(History.topPage()=='#productsOffers'){
     	  History.pop();
          //console.log("Vuelta a productsOffers");
          $.mobile.changePage($.mobile.path.get() + "productsOffers.html", {transition: "none"});
     	} else if(History.topPage()=='#prod_of_details'){
     	  History.pop();
          //console.log("Vuelta a prod_of_details");
          $.mobile.changePage($.mobile.path.get() + "prod_of_details.html", {transition: "none"});
     	} else if(History.topPage()=='#currencyConverter'){
     		navigator.app.exitApp(); // No se puede volver a currency con el botón de atrás, nos salimos
     	  // History.pop();
          // console.log("Vuelta a currencyConverter");
          // $.mobile.changePage($.mobile.path.get() + "currencyConverter.html", {transition: "none"});
     	} else if(History.topPage()=='#contact'){
     	  History.pop(); 
          //console.log("Vuelta a contact");
          $.mobile.changePage($.mobile.path.get() + "contact.html", {transition: "none"});
     	} else if(History.topPage()=='#tellAFriend'){
     	  History.pop();
          //console.log("Vuelta a Tell a Friend");
          $.mobile.changePage($.mobile.path.get() + "tellAFriend.html", {transition: "none"});
     	}
     	
     }
}

/**Hace de controlador para cuando en los Android se vuelve atrás con el botón*/
function createBackController() {
    document.addEventListener("backbutton", function(e){
    	backAction(e);
   }, false);
}

//Se llama desde todas las pantallas para ejecutar las traducciones, la codBar, publicidad... 
function initPage(page){
	
	CurrentPage=page;
	
	if($('#' + ConstPages.Element_Menu).length){
		paintMenu(ConstPages.Element_Menu);
	}
	
	GestorIdiomas.refresca(page);
	$('#btn_BackDiv').removeClass('ARLabel');
	$(page).trigger('create');
}


function changeLanguageAndNav(id_page,okCB){
	var lang = GestorIdiomas.getLang();
	if(lang=='ar_SA'){lang='en_US'}else{lang='ar_SA'};
	GestorIdiomas.setLang(lang,function(){
		GestorIdiomas.refresca('#'+id_page);
		paintBanner(ConstPages.Element_Banner);
		$(id_page).trigger('create');
		if($.objectHasContent(okCB)){okCB();}
	});
	
}
function checkConnection(okCB,ErrCB) {
$.mobile.loading('hide');
if (ConstF.traceLog) console.log('checkConnection Method Raised - Time:'  + new Date().getTime());


$.ajax({
		type : ConstF.GET,
		url : ConstF.base_WS + 'ping',
		data : null,
		timeout: ConstF.timeoutBase,
		contentType : ConstF.JsonContent,
		dataType : ConstF.JsonTipoDatos,
		cache: false,
		success : function(data){
			if (ConstF.traceLog) console.log('checkConnection Method success  - Time:'  + new Date().getTime());
			$.mobile.loading('hide');
			if($.objectHasContent(okCB)) okCB();
		},
	error : function(err, textStatus, xhr){			
			if (ConstF.traceLog){ 
				console.log('checkConnection Method error   - Time:'  + new Date().getTime());
				console.log('Error Message textStatus:'  + textStatus);
				console.log('Error Message err:'  + JSON.stringify(err));
				console.log('Error Message xhr:'  + xhr);
			}
			showPopup(GestorIdiomas.getLiteral('noConnectionMsg'));
			$.mobile.loading('hide');
			if($.objectHasContent(ErrCB)) ErrCB();
		}
});
}

/**
 * Gestor de Preferencias
 */
function _GestorPrefs() {
	var me = this;

	me.setPref = function(key,value){
		return window.localStorage.setItem(key, value);
	}
	
	me.getPref = function(key){
		return window.localStorage.getItem(key);
	}
	
	me.borraPref = function(key){
		return window.localStorage.removeItem(key);
	}
	
	me.clear = function(){
		return window.localStorage.clear();
	}
	
	me.setSesionPref = function(key,value){
		return window.sessionStorage.setItem(key, value);
	}
	
	me.getSesionPref = function(key){
		return window.sessionStorage.getItem(key);
	}
	
	me.borraSessionPref = function(key){
		return window.sessionStorage.removeItem(key);
	}
	
	me.clearSession = function(){
		return window.sessionStorage.clear();
	}
}


//var _UrlServerBase = 'http://213.0.103.69'; //MADRID - HEAD
//var _UrlServerBase = 'http://213.0.103.69:8080'; //MADRID - PRODUCION
//var _UrlServerBase = 'https://87.101.185.53';//Arabia - TEST
//var _UrlServerBase = 'https://87.101.185.54';//Arabia - UAT
var _UrlServerBase = 'https://www.almubasher.com.sa';//Arabia - PRODUCTION

/* ANALISIS DE URLS PARA EL FUTURO BY UNAI (QUE OS QUIERE) AND IVAN
 * http://213.0.103.69/bb-forms/server/start?project=r5-Simulator&flow=Start&version=0.0-Simulators&ui=xslt&noTools=true
 * https://87.101.185.53/bb-forms/server/start?project=r5-Simulator&flow=Start&version=0.0HO&languageCode=ar-SA&ui=xslt&theme=almubasher_ar&noTools=true 
 * https://87.101.185.54/bb-forms/server/start?project=r5-Simulator&flow=Start&version=0.0-Simulators&ui=xslt&noTools=true
 * https://www.almubasher.com.sa/bb-forms/server/start?project=r5-Simulator&flow=Start&version=0.0-Simulators&ui=xslt&noTools=true
 */


var ConstF = {
	'DatabaseNombre' : 'test',
	'DatabaseRev' : '1.0',
	'DataBaseDesc' : 'Test BD',
	'DatabaseTam' : 5*1024*1024,
	'err_timeout' : 'timeout',
	'prioridadBD' : 'bd',
	'prioridadNet' : 'net',
	'prioridadSoloBD' : 'soloBD',
	'prioridadSoloNet' : 'soloNet',
	'resultadoBD' : 'resultBD', //Indica que el resultado se ha sacado de la BD
	'resultadoNet' : 'resultNet', //Indica que el resultado se ha sacado de la red
	'base_WS' : _UrlServerBase + '/retail-rest/ext/',
	//'base_WS' : 'https://87.101.185.53/retail-rest/ext/',
	'timeoutBase' : 10*1000, //Timeout para el GET a la base del WS para chequear disponibilidad
	'timeoutRequest' : 5*60*1000, //Timeout para hacer las peticiones al WS
	'POST' : 'POST',
	'GET' : 'GET',
	'JsonContent' : 'application/json; charset=utf-8',
	'JsonTipoDatos' : 'json',
	//'urlServer': 'http://192.168.43.199:8082/mobile/auth/login.do',
	'urlServer': _UrlServerBase + '/mobile/',
	//'urlServer': 'https://87.101.185.53/mobile/auth/login.do',
	//'urlMap': 'http://192.168.43.199:8082/mobile/content/map.do',
	'urlMap':  _UrlServerBase + '/mobile/content/map.do',
	//'urlMap': 'https://87.101.185.53/mobile/content/map.do',
	'urlFinCalc':_UrlServerBase + '/bb-forms/server/start?project=r5-Simulator&flow=Start&version=0.0HO&ui=xslt&noTools=true',
	//'urlFinCalc':'https://87.101.185.53/bb-forms/server/start?project=r5-Simulator&flow=Start&version=0.0-Simulators&ui=xslt&noTools=true',
	'urlPublic': 'http://www.alrajhibank.com.sa/',	
	'urlBanner':_UrlServerBase + '/mobile/proxy?pipe=',
	//'urlBanner':'https://87.101.185.53/mobile/proxy?pipe=',
	'BannerId':'loginScreenFooter',
	'BannerIdPopUp':'alertScreen',
	'facebookId':'486200771429411',
	'traceLog':true

};



/*Variable global que almacena temporalmente el diccionario en la carga dinamica*/
var dictInObj;

/**
 * Gestor de Idiomas
 */
function _GestorIdiomas() {
	var me = this;

	var lang_disponibles = [];
	var lang_actual;//Por defecto

	/**
	 *Inicializa el gestor de idiomas cargando los disponibles y estableciendo el que se tenga en preferencias 
	 */
		me.init=function(callBack){
		me.addLang('ar_SA');
		me.addLang('en_US');
    	//console.log('Anadidos los lenguajes');
	
		var lang = GestorPrefs.getPref('LANGUAGE_ID');
		if (!lang || lang=='undefined'){//Por defecto inglés
			lang="ar_SA";
		}	
		
		me.setLang(lang,callBack);
	}


	/**
	 * Anade el lenguaje a los disponibles (es, en, fr...)
	 * @param {Object} id
	 * devuelve false si ya existe, true si se anade
	 */
	me.addLang = function(id) {
		if(lang_disponibles.indexOf(id) == -1) {
			lang_disponibles.push(id);
			return true;
		} else {
			return false;
		}
	}
	/**
	 * Quita un lenguaje de los disponibles (es, en, fr...)
	 * @param {Object} id
	 * devuelve false si no existe, true si se ha quitado
	 */
	me.removeLang = function(id) {
		if(lang_disponibles.indexOf(id) != -1) {
			lang_disponibles.slice(indexOf(id), 1);
			return true;
		} else {
			return false;
		}
	}
	/**
	 * Fija el lenguaje a emplear (Si existe otro, automaticamente se actualizara la pagina)
	 * @param {Object} id El mensaje a fijar
	 * @param {Object} callback callback para cargar dinamicamente el diccionario
	 * devuelve true si lleva a cabo, false si falla o no existe el lenguaje
	 */
	me.setLang = function(id,callback) {
        //console.log('Fijar nuevo idioma'+id);
        GestorPrefs.setPref('LANGUAGE_ID',id);
		if(lang_disponibles.indexOf(id) != -1) {
			obtenerDicc(id,callback);
			lang_actual = id;
			//TODO:Refrescar traduccion al vuelo
			return true;
		} else {
			return false;
		}
	}

	me.getLang = function() {
		return lang_actual;
	}
	
	me.getAvailableLangs = function(){
		return lang_disponibles;
	}
	
	/**
	 * Metodo privado para obtener y cargar el diccionario
	 * @param {Object} id
	 * @param {Object} callback callback para cargar dinamicamente el diccionario
	 */
	var obtenerDicc = function(id,callback) {
		//console.log('Obteniendo dicc');
        //Evitamos la cache de iOS
        var ruta;
        if(core_arrancado==false){
            ruta = "../comun/lang/"+id+"/js/resources.js";
        } else {
            ruta = "../lang/"+id+"/js/resources.js";
        }
        //console.log('ruta diccionario:'+ruta);
        
        //TODO:GetScript esta dando problemas en Android 4.0 de momento lo cambiamos por nuestra solucion adhoc
		/**$.getScript(ruta, function(data, textStatus, jqxhr) {
			console.log('Carga diccionario:'+JSON.stringify(dictInObj));
			jsIn.addDict(dictInObj);
            if(callback!=null){
                callback();
            } 
		}).fail(function(jqxhr, settings, exception) {
  				alert(JSON.stringify(jqxhr));
  				alert(settings);
  				alert(exception);
			});**/
		
		var head = document.getElementsByTagName("head")[0];
		script = document.createElement('script');
		script.type = 'text/javascript';
		script.src = ruta;
		script.charset ="utf-8";
		script.onload = function() { 
			//Todo ok cargamos el diccionario
			//console.log('Carga diccionario:'+JSON.stringify(dictInObj));
			jsIn.addDict(dictInObj);
            if(callback!=null){
                callback();
            } 
		 };
		script.onerror = function(e) { console.log("Fallo en nuestro apaño de getScript") };
		head.appendChild(script);
	}
	
	me.refresca = function(pag){
        console.log('Traduciendo toda la pagina');
		//Refresca los span con lang
		$(pag).find('span[lang=true]').each(function(){
			var trad = this.id.split("|");
			var nom = trad[0];
			trad.splice(0,1);
			$(this).html(__(nom,trad));
			if (lang_actual=='ar_SA'){
				$(this).parent('div').addClass('ARLabel');
				//$(this).addClass('ARLabel');
			}else{
				$(this).parent('div').removeClass('ARLabel');
				
			}
			
		});
		
		// Traducción de los flips
		$(pag).find('select[lang=true][data-role=slider]').each(function(){
			var langIdValue0 = $(this).attr('langIdValue0');
			var langIdValue1 = $(this).attr('langIdValue1');
			
			if (langIdValue0 != null && langIdValue1 != null)
			{
				var langValue0 = me.getLiteral(langIdValue0);
				var langValue1 = me.getLiteral(langIdValue1);
				
				me.translateFlip(this.id,langValue0,langValue1);
			}
		});
	}
	
	me.getLiteral = function(idLiteral){
		return __(idLiteral);
	}
	
	me.translateFlip = function (flipId, label0Text, label1Text){
		var mySlider     = $('#' + flipId);
		var activeLabel1  = $(mySlider).parent().find('span.ui-slider-label:first');
	    var activeLabel0  = $(mySlider).parent().find('span.ui-slider-label:last');
		    
		activeLabel0.text(label0Text);
		activeLabel1.text(label1Text);
	}
}

/**
 * Objeto que lleva la historia porque la del navegador hace lo que quiera
 */
function _History() {
	var me = this;
	
	var pages = [];
	var params = [];

	/* Guarda en la pila el id de la pagina y sus parametros*/
	me.push = function (page,param){
		pages[pages.length] = page;
		params[params.length] = params;
		console.log('Push');
		debug();
	}

	/* Desapila la pagina y sus parametros*/
	me.pop = function(){
		pages.splice(-1,1);
		params.splice(-1,1);
		console.log('Pop');
		debug();
	}
	
	/* Devuelve los parametros de la pagina en la pos de la pila*/
	me.getParams = function(pos){
		return params[pos];
	}
	
	/* Fija los parametros de la pagina de la pos de la pila*/
	me.setParams = function(pos,data){
		params[pos] = data;
		console.log('Set Params');
		debug();
	}
	
	/* Devuelve la pagina que esta en top*/
	me.topPage = function(){
		return pages[pages.length-1];
	}
	
	/* Devuelve los parametros de la pagina que esta en top*/
	me.topParams = function(){
		return params[params.length-1];
	}
	
	/* Devuelve el tamaño de la pila*/
	me.size = function(){
		return pages.length;
	}
	
	/* Vacia la pila*/
	me.clear = function(){
		pages.splice(0,pages.length);
		params.splice(0,params.length);
		console.log('Clear');
		debug();
	}
	
	/* Hace Debug, TODO: Borrar de produccion*/
	var debug = function(){
		console.log('Debug');
		for(var i=0;i<pages.length;i++){
			console.log('Page-'+i+': '+pages[i]);
			if(params[i]!=null){ 
				console.log('Params-'+i+': '+params[i].toString());
			} else {
				console.log('Params-'+i+': Sin params');
			}
		}
	}
	
	
}



// FIX 001 Fix double click effect in Android 4.2.2  in Phonegap 2.1 -----------------------------
// Called from initCallBack before any browsing

var f001_last_click_time = new Date().getTime();

function f001_fixDoubleClickAndroid42()
{
	document.addEventListener('click', function (e) {
		if (Utils.isAndroidMobile() && Utils.getVersion().match(/(4.2)/)!=null)
		{
			var click_time = e['timeStamp'];
			if (click_time && (click_time - f001_last_click_time) < 400) {
				e.stopImmediatePropagation();
				e.preventDefault();
				return false;
			}
			f001_last_click_time = click_time;
		}
	}, true);	
};

// ---------------------------------------------------------------------------------------------




//Cuando se invoca con isMenu, deja la historia lista para que al volver atras vuelva a index
function browseFromClick(relativeUrl, transition,params,isMenu){


		//Guardamos primero en la historia la pag actual
		var id = '#'+$.mobile.activePage.attr('id');
		if(id!='#init'){
			console.log('HISTORIA: '+id);
			History.push(id,params);
		}
	
	browse(relativeUrl,transition,true);
}

//Cuando se invoca con isMenu, deja la historia lista para que al volver atras vuelva a index
function browseFromClickNoLoading(relativeUrl, transition,params,isMenu){


		//Guardamos primero en la historia la pag actual
		var id = '#'+$.mobile.activePage.attr('id');
		if(id!='#init'){
			console.log('HISTORIA: '+id);
			History.push(id,params);
		}
	
	browse(relativeUrl,transition,false);
}


//Cuando se invoca con isMenu, deja la historia lista para que al volver atras vuelva a index
function browse(relativeUrl, transition,loading){
	var id = relativeUrl.replace(".html","");
	if(CurrentPage != id){//Solamente se navega si se cambia de página
		if(loading) ShowLoadingMessage();
		console.log('Cambio de página: ' + relativeUrl);
		$.mobile.changePage(relativeUrl, {transition: transition});
		if(loading) $.mobile.loading('hide');
	}
}




function ShowLoadingMessage(){
	$.mobile.loading( 'show');
}

function browseCurrencyConverter(){
	checkConnection(browseCurrencyConverterOK,null);
}

function browseCurrencyConverterOK(){
	browseFromClickNoLoading('currencyConverter.html', 'none');
}


jQuery.asyncTimerExecution  = function (method,interval, flag)
{
	method();
	setTimeout(
		function(){
			if (flag())
				$.asyncTimerExecution(method,interval,flag);
		},
		interval
	);
}

/*
 Agrupa por el campo JSONParamName y mete los elementos en un array para cada grupo
 * */
jQuery.getGroupedArrayFromJSONArray  = function(data, JSONParamName) {
	var result = [];
	
	$.each(data, function() {

		if (!result[this[JSONParamName]])
		{
			result[this[JSONParamName]] = [];
		}
		result[this[JSONParamName]].push(this); 
	});
	
	return sortOnKeys(result);
}

function sortOnKeys(dict) {

    var sorted = [];
    for(var key in dict) {
        sorted[sorted.length] = key;
    }
    sorted.sort();

    var tempDict = {};
    for(var i = 0; i < sorted.length; i++) {
        tempDict[sorted[i]] = dict[sorted[i]];
    }

    return tempDict;
}

/*
 Filtra el objeto JSON por igualdad y con AND
 el formato de los parámetros es 
 			   	var _params=[{'NAME':'','VALUE':''},{'NAME':'','VALUE':''}]
 * */
jQuery.getFilteredArrayFromJSONArray  = function(data,JSONParameters) {
	var result = [];
	$.each(data, function() {
		var ret=this;
		for(var i=0; i<JSONParameters.length; i++){
				var _val = JSONParameters[i].VALUE;
				var _elem =this[JSONParameters[i].NAME]; 
				if(_val==null){_val='null'};
				if(_elem==null){_elem='null'};
				if(_elem != _val){
					ret=null;
				}
		}
		
		if(ret!=null && ret!= 'undefined') result.push(this);
	
	});	

	return result;
}

/*
 Filtra el objeto JSON por igualdad y con OR
 el formato de los parámetros es 
 			   	var _params=[{'NAME':'','VALUE':''},{'NAME':'','VALUE':''}]
 * */
jQuery.getORFilteredArrayFromJSONArray  = function(data,JSONParameters) {
	var result = [];
	$.each(data, function() {
		var ret=null;
		for(var i=0; i<JSONParameters.length; i++){
			var _val = JSONParameters[i].VALUE;
			if(_val==null){_val='null'};
			
				if(this[JSONParameters[i].NAME].toString() == _val){
					ret=this;
					break;
			}
		}
		
		if(ret!=null && ret!= 'undefined') result.push(this);
	});	

	return result;
}

jQuery.getSingleObjectByPKFromJSONArray =  function (data, field, value){
	 
	 var _itemRes = null;
	 if (data != null){  
	
	  $.each(data, function(i, _itemIterado) {	
	         if (_itemIterado[field] == value) {
	             _itemRes = this;
	             return false; 
	         }
	  });
	 }
	 return _itemRes;
}


jQuery.getElementPositionByIdFromJSONArray =  function (data, field, value){
	 
	 var _res;
	 var fin;
	 if (data != null){  
	 _res=0;
	 $.each(data, function(i, _itemIterado) {	
	 	if (_itemIterado[field] == value) {
	 		fin = _res; 
	 	}else{
	 		_res+=1;
	 	}
	 });
	 }
	 return fin;
}

/*
 * Hace las comprobaciones de null, '' y undefined en el objeto para saber si tiene valor
 */
jQuery.objectHasContent = function (obj){
	return (obj!=null && obj!='' && obj!= 'undefined' && obj!='null');
}

jQuery.notNullString = function (str){
	if ($.objectHasContent(str))
		return str;
	else
		return '';
}


// EXTENSIONES DE FORMATO

jQuery.numberFormat  = function (num, length) {
	     var r = "" + num;
	     while (r.length < length) {
	          	         r = "0" + r;
         }
         return r; 
};

Date.prototype.setISO8601IgnoreLocalTimeOffSet = function (string) {

	// parenthese matches:
	// year month day    hours minutes seconds  
	// dotmilliseconds 
	// tzstring plusminus hours minutes
	var re = /(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)(\.\d+)?(Z|([+-])(\d\d):(\d\d))/;
	 
	var d = [];
	d = string.match(re);
	 
	// "2010-12-07T11:00:00.000-09:00" parses to:
	//  ["2010-12-07T11:00:00.000-09:00", "2010", "12", "07", "11",
	//     "00", "00", ".000", "-09:00", "-", "09", "00"]
	// "2010-12-07T11:00:00.000Z" parses to:
	//  ["2010-12-07T11:00:00.000Z",      "2010", "12", "07", "11", 
	//     "00", "00", ".000", "Z", undefined, undefined, undefined]
	 
	if (! d) {
		throw "Couldn't parse ISO 8601 date string '" + s + "'";
	}
	 
	// parse strings, leading zeros into proper ints
	var a = [1,2,3,4,5,6,10,11];
	for (var i in a) {
		d[a[i]] = parseInt(d[a[i]], 10);
	}
	d[7] = parseFloat(d[7]);
	 
	// Date.UTC(year, month[, date[, hrs[, min[, sec[, ms]]]]])
	// note that month is 0-11, not 1-12
	// see https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Date/UTC
	var ms = Date.UTC(d[1], d[2] - 1, d[3], d[4], d[5], d[6]);
	
	// if there are milliseconds, add them
	if (d[7] > 0) {  
		ms += Math.round(d[7] * 1000);
	}
	

	// Para ignorar la zona horaria local
	ms += new Date().getTimezoneOffset() * 60 * 1000;
	
	// if there's a timezone, calculate it
	// if (d[8] != "Z" && d[10]) {
		// var offset = d[10] * 60 * 60 * 1000;
		// if (d[11]) {
	  		// offset += d[11] * 60 * 1000;
		// }
		// if (d[9] == "+") { ms -= offset; } else { ms += offset; }
	// }
	

	this.setTime(ms);
}

Date.prototype.toShortTimeString = function () {
    return this.getHours() + ':' + $.numberFormat(this.getMinutes(),2); 
}

Date.prototype.toShortDateString = function () {
	var curr_date = this.getDate();
	var curr_month = this.getMonth();
	curr_month++;
	var curr_year = this.getFullYear();
	return curr_date + "/" + $.numberFormat(curr_month,2) + "/" + curr_year;
}

Date.prototype.toDetalleVueloFormat = function () {
    return this.toShortTimeString() + ' hrs. ' + this.toShortDateString();
}

/**Utilidades varias*/
function _Utils() {
    
    var me = this;
    
    /* Devuelve el id del dispositivo.
     * Dependiente de 'device' */
    me.getUniqueId = function() {
        return device.uuid;
    }
    
    
    /* Devuelve el nombre del dispositivo.
     * Dependiente de 'device' */
    me.getName = function() {
        return device.name;
    }
    
    /* Devuelve la versión de Cordova.
     * Dependiente de 'device' */
    me.getCordova = function() {
        return device.cordova;
    }
    
    /* Devuelve la plataforma.
     * Dependiente de 'device' */
    me.getPlatform = function() {
        return device.platform;
    }
    
    /* Devuelve la versión.
     * Dependiente de 'device' */
    me.getVersion = function() {
        return device.version;
    }
    
    /* Devuelve si es Android. */
    me.isAndroid = function() {
        return navigator.userAgent.toLowerCase().indexOf('android') >= 0;
    }
    
    /* Devuelve si es Android Mobile. */
    me.isAndroidMobile = function() {
    	var lowerUserAgent =  navigator.userAgent.toLowerCase();
        return lowerUserAgent.indexOf('android') >= 0 && lowerUserAgent.indexOf('mobile') >= 0;
    }
    
     /* Devuelve si es Android Tablet. */
    me.isAndroidTablet = function() {
    	var lowerUserAgent =  navigator.userAgent.toLowerCase();
        return lowerUserAgent.indexOf('android') >= 0 && !lowerUserAgent.indexOf('mobile') >= 0;
    }
    
    /* Devuelve si es Iphone. */
    me.isIphone = function() {
        return navigator.userAgent.toLowerCase().indexOf('iphone') >= 0;
    }
    
    /* Devuelve si es Ipod. */
    me.isIpod = function() {
        return navigator.userAgent.toLowerCase().indexOf('ipod') >= 0;
    }
    
    /* Devuelve si es Ipad. */
    me.isIpad = function() {
        return navigator.userAgent.toLowerCase().indexOf('ipad') >= 0;
    }
    
    /* Devuelve si es Ipad. */
    me.isWindowsPhone = function() {
        return navigator.userAgent.toLowerCase().indexOf('windows phone') >= 0;
    }
}

function _ProductsManager() {
 	var me = this;
 	var _selectedProduct;

	var _products = [
	   {'PROD_ID':'1','PROD_TITLE':'Personal Finance',
	   'PROD_DESC':'We provide you with the means to<br>renovate your home, prepare your<br>dream wedding, ensure your<br>children\'s education.',
	   'PROD_DESC_AMP':'We provide you with the means to renovate your home, prepare your dream wedding, ensure your children\'s education, or simply deal with those troublesome and unexpected expenses.',
	   'PROD_WHAT_OFF':'<b>What we offer:</b><br><ul><li>Lorem ipsum dolor sit amet</li><li>consectetuer adipiscing elit</li><li>sed diam nonummy nibh euismod</li></ul>',
	   'PROD_IMG':'foto_personal@2x.png','PROD_IMG_SMALL':'foto_products1@2x.png'},
	   
	   {'PROD_ID':'2','PROD_TITLE':'Car Finance Test',
	   'PROD_DESC':'If your salary is transfered to us,<br>you can choose from either the<br>Car Installments or the Car Lease.',
	   'PROD_DESC_AMP':'If your salary is transfered to us, you can choose from either the Car Installments or the Car Lease.',
	   'PROD_WHAT_OFF':'<b>What we offer:</b><br><ul><li>Lorem ipsum dolor sit amet</li><li>consectetuer adipiscing elit</li><li>sed diam nonummy nibh euismod</li></ul>',
	   'PROD_IMG':'foto_personal@2x.png','PROD_IMG_SMALL':'foto_products2@2x.png'},
	   
	   {'PROD_ID':'3','PROD_TITLE':'Home Finance',
	   'PROD_DESC':'We offer you independence and<br>security. Financially buying a home<br>is saving all the rent as well as<br>owning an asset thet most likely<br>appreciates though time.',
	   'PROD_DESC_AMP':'We offer you independence and security. Financially buying a home is saving all the rent as well as owning an asset thet most likely appreciates though time.',
	   'PROD_WHAT_OFF':'<b>What we offer:</b><br><ul><li>Lorem ipsum dolor sit amet</li><li>consectetuer adipiscing elit</li><li>sed diam nonummy nibh euismod</li></ul>',
	   'PROD_IMG':'foto_personal@2x.png','PROD_IMG_SMALL':'foto_products3@2x.png'},
	   
	   {'PROD_ID':'4','PROD_TITLE':'Health Insurance',
	   'PROD_DESC':'Lorem ipsum dolor sit amet,<br>consectetuera dipiscing elit, sed<br>diam nonummy nibh euismod<br>tincidunt ut laoreet doloremagna<br>aliquam erat.',
	   'PROD_DESC_AMP':'Lorem ipsum dolor sit amet, consectetuera dipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet doloremagna aliquam erat.',
	   'PROD_WHAT_OFF':'<b>What we offer:</b><br><ul><li>Lorem ipsum dolor sit amet</li><li>consectetuer adipiscing elit</li><li>sed diam nonummy nibh euismod</li></ul>',
	   'PROD_IMG':'foto_personal@2x.png','PROD_IMG_SMALL':'foto_products4@2x.png'},
	   ];

 me.PRODUCTS = function(){return _products};
 me.SELECTED_PRODUCT = function(){return _selectedProduct};

 me.init= function(){
   //NO NECESITA DE MOMENTO NADA
 };

 me.setProduct = function(productId){
  if(_selectedProduct==null || productId!=_selectedProduct.PROD_ID){
   _selectedProduct= $.getSingleObjectByPKFromJSONArray(_products,'PROD_ID',productId);
  }
 };  
 
 me.productPosition = function(productId){
 	return $.getElementPositionByIdFromJSONArray(_products,'PROD_ID',productId);
 };
 	
 me.IsFirst = function(productId){
   var _pos = me.productPosition(productId);
   return (_pos==0); 
 };
 
 me.IsLast = function(productId){
   var _pos = me.productPosition(productId);
   return (_pos==_products.length-1);
 };     
}  




function _BannerManager() {
 	var me = this;
 	
 	var _banners=[];
 	var _selectedBanner;
 	var _bannersId;
 	
 	
 	 me.init = function (BannersId){
 	 	_bannersId = BannersId
 	 }
 	 	
	/*
	 This must call to the WS to obtain the banner list using the language
	 * */
	me.loadBanners = function (idLanguage,okCB){
	
		_banners = [];
		var urlBanner = ConstF.urlBanner;
		var _lang = GestorIdiomas.getLang();
		if (_lang=='ar_SA'){
			_lang='Ar'
		
		}else{
			_lang='En'
		}
												
		$.ajax({
				type : ConstF.GET,
				url : urlBanner + 'banner&bannerId=' + _bannersId + _lang,
				data : null,
				timeout: ConstF.timeoutRequest,
				contentType : ConstF.JsonContent,
				dataType : ConstF.JsonTipoDatos,
				success : function(data){
						for (i=0;i<=data.length-1;i++){
							_banners.push( {'ID':data[i].bannerId,'index':i,'URL': urlBanner + 'content&path=' + data[i].bannerPath, 'campaignUrl' : data[i].campaignUrl, 'campaignId' : data[i].campaignId, 'bannerId' : data[i].bannerId});	
						}
				 		_selectedBanner = _banners[0];
						//after load the banners we must inform that is loaded
						if($.objectHasContent(okCB)){
							okCB();	
						}
						
					},
				error : function(err){
						if($.objectHasContent(okCB)){
							okCB();	
						}
					}
			});
									
	

	}
	
	me.bannersLength = function (){return _bannersLength};
	
	 me.getBanner = function (idBanner){
		var htmlData='';
		///ext/campaign/saveClick
		if ($.objectHasContent(_selectedBanner)){
			htmlData='<div class="section-'+_bannersId+'" id="' + idBanner + '" style="background:'
			if(_bannersId=='loginScreenFooter') htmlData+='#1D348F ';
			
			htmlData+='url(\'' + _selectedBanner.URL + '\') no-repeat center center;" onclick="openBanner(\''+_selectedBanner.campaignUrl+'\',\''+_selectedBanner.campaignId+'\',\''+_selectedBanner.bannerId+'\');">';
			
			if(_banners.length >1){
			
				htmlData+='<div id="pagination" class="pagination">';
				for (i=0;i<=_banners.length-1;i++){
					if (_banners[i].ID == _selectedBanner.ID){
						htmlData+='<span class="dot_selected">&nbsp;&nbsp;</span>';
					}else{
						
						htmlData+='<span class="dot">&nbsp;&nbsp;</span>';
					}
				}
				htmlData+='</div>';
			}
			
			
			htmlData+='&nbsp;</div>';
		}
		return htmlData;
	}
	
	me.setNextBanner = function(){		
		if(_banners.length > _selectedBanner.index +1){//If ID is greater or iqual the last one is showed
			_selectedBanner = _banners[_selectedBanner.index + 1];
		}else{
			_selectedBanner = _banners[0];
		}
	}
	
	me.setPrevBanner = function(){

		if(_selectedBanner.index != 0){//If we are not on the first one
			_selectedBanner = _banners[_selectedBanner.index -1];
		}else{
			_selectedBanner = _banners[_banners.length -1];
		}
	}
	
	me.notifyClick = function(campaignId,bannerId){
		
		var urlBanner = ConstF.urlBanner;
		var _JSONParameters = {
	                			campaign : campaignId,
	                			bannerId: bannerId,
	                			mobile: true
	        			};
	        			
	     var _param =  $.param(_JSONParameters);	

		$.ajax({
				type : ConstF.GET,
				url : urlBanner + 'campaign/saveClick?' + _param,
				data : null,
				timeout: ConstF.timeoutRequest,
				contentType : ConstF.JsonContent,
				dataType : ConstF.JsonTipoDatos,
				success : function(data){
					},
				error : function(err){
						console.log('notifyClick - ERROR: ' + JSON.stringify(err));
					}
			});
	}
 }

jQuery.initializeScroll  = function (scrollObject, scrollDivID)
{
	if (scrollObject== null)
	{
		setTimeout(function(){
							scrollObject = new iScroll(scrollDivID, 
							{
								snap: true,
								momentum: false,
								hScrollbar: false,
							});
							$($.mobile.activePage).trigger('create');
		},100);
	}
} 

jQuery.initializeScroll = function (scrollObject, scrollDivID, scrollIndicatorID)
{
	if (scrollObject== null)
	{
		setTimeout(function(){
							scrollObject = new iScroll(scrollDivID, 
							{
								snap: true,
								momentum: false,
								hScrollbar: false,
								onScrollEnd: function () {
												document.querySelector('#' + scrollIndicatorID + ' > li.active').className = '';
												document.querySelector('#' + scrollIndicatorID + ' > li:nth-child(' + (this.currPageX+1) + ')').className = 'active';
											}
							});
							$($.mobile.activePage).trigger('create');
		},100);
	}
}

jQuery.initializeSalidasScroll = function (scrollDivID, scrollIndicatorID)
{
	if (salidasScroll== null)
	{
		setTimeout(function(){
							salidasScroll = new iScroll(scrollDivID, 
							{
								snap: true,
								momentum: false,
								hScrollbar: false,
								onScrollEnd: function () {
												document.querySelector('#' + scrollIndicatorID + ' > li.active').className = '';
												document.querySelector('#' + scrollIndicatorID + ' > li:nth-child(' + (this.currPageX+1) + ')').className = 'active';
											}
							});
							$($.mobile.activePage).trigger('create');
		},100);
	}
}

jQuery.initializeLlegadasScroll = function (scrollDivID, scrollIndicatorID)
{
	if (llegadasScroll== null)
	{
		setTimeout(function(){
							llegadasScroll = new iScroll(scrollDivID, 
							{
								snap: true,
								momentum: false,
								hScrollbar: false,
								onScrollEnd: function () {
												document.querySelector('#' + scrollIndicatorID + ' > li.active').className = '';
												document.querySelector('#' + scrollIndicatorID + ' > li:nth-child(' + (this.currPageX+1) + ')').className = 'active';
											}
							});
							$($.mobile.activePage).trigger('create');
		},100);
	}
}

jQuery.initializeNotificationsScroll = function (scrollDivID, scrollIndicatorID)
{
	if (notificacionesScroll== null)
	{
		setTimeout(function(){
							notificacionesScroll = new iScroll(scrollDivID, 
							{
								snap: true,
								momentum: false,
								hScrollbar: false,
								onScrollEnd: function () {
												document.querySelector('#' + scrollIndicatorID + ' > li.active').className = '';
												document.querySelector('#' + scrollIndicatorID + ' > li:nth-child(' + (this.currPageX+1) + ')').className = 'active';
											}
							});
							$($.mobile.activePage).trigger('create');
		},100);
	}
}

var llegadasScroll = null;
var salidasScroll  = null;
var notificacionesScroll  = null;

function showLogOut(_msg){
	var lang = GestorIdiomas.getLang();
	var _langCss ='';
	if(lang == 'en_US'){
	} else if (lang == 'ar_SA'){
		_langCss ='ARLabel';
	}
	
    var _dialog = createDialog();
    var _dialogPanel = $(
    		'<div class="alpha_frente">' + 
    		
    			'<div class="titleSection">' + 
    				'<div class="title-bannerHeader"></div>' +
					'<img src="'+ $.mobile.path.get() +'../themes/default/styles/img/close.png" onclick="hideDialog();" style="float:right;padding-right: 10px;padding-top: 10px;"/>' +									
				'</div>'+ 
		    			'<div class="textSection ' + _langCss + '" >' + _msg + '</div>' +
						'<div id="imgBannerPopUp" style="height:180px"/>' +
		    		'</div>')
    .appendTo($(_dialog))
    .trigger('create');
   
   	centerDialogPanel(_dialogPanel);
   	setBannersPopUp();
    return false;
}

	      		function setBannersPopUp(){
	      			
					BannerManagerPopUp.loadBanners(GestorIdiomas.getLang(),paintBannerPopUp);
					

							
	      		}
	      		 function paintBannerPopUp(){
	      		 	
	      		 	
					if($('#' + ConstPages.Element_BannerPopUp).length){
						$('#' + ConstPages.Element_BannerPopUp).replaceWith(BannerManagerPopUp.getBanner(ConstPages.Element_BannerPopUp));
						$('#' + ConstPages.Element_BannerPopUp).on('swiperight', function(event) {
							navigatePrevBannerPopUp();
						});
		      			
		      			$('#' + ConstPages.Element_BannerPopUp).on('swipeleft', function(event) {
							navigateNextBannerPopUp();
						});
						$('#' + ConstPages.Element_BannerPopUp).trigger('create');
					}
				}
				
			function navigatePrevBannerPopUp(){
					BannerManagerPopUp.setPrevBanner();
					paintBannerPopUp();
				};
				function navigateNextBannerPopUp(){
					BannerManagerPopUp.setNextBanner();
					paintBannerPopUp();
				};

function showPopup(message){
    var _dialog = createDialog();
    var _langCss = (GestorIdiomas.getLang()=='ar_SA'?'ARLabel':'');
    var _dialogPanel = $('<div class="alpha_frente">' + 
				    	'<div class="titleSection">' + 
				    				'<div class="title-bannerHeader"></div>' +
									'<img src="'+ $.mobile.path.get() +'../themes/default/styles/img/close.png" onclick="hideDialog();" style="float:right;padding-right: 10px;padding-top: 10px;"/>' +									
						'</div>'+ 
		    			'<div class="textSection ' + _langCss + '" >' + 
		    					message + 
		    			'</div><br>' + 
		    		'</div>')
    .appendTo($(_dialog))
    .trigger('create');
   
   	centerDialogPanel(_dialogPanel);
    return false;
}

function showConfirm(message, resultFunctionNoParams){
	// Añade la función resultado a una variable interna
	this._resultFunctionNoParams = resultFunctionNoParams;

    var _dialog = createDialog();
    var _langCss = (GestorIdiomas.getLang()=='ar_SA'?'ARLabel':'');
    var _dialogPanel = $('<div class="alpha_frente">' + 
		    			'<div class="textSection ' + _langCss + '" >' + 
		    					message + 
		    			'</div>' + 
		    			'<div class="buttonSection" align="center"><table><tr>' +
		    				'<td><a href="" data-role="button" onclick="hideDialog();" data-theme="button" >OK</a></td>' +
		    				'<td><a href="" data-role="button" onclick="hideDialog();if(_resultFunctionNoParams != null){_resultFunctionNoParams();}" data-theme="button" >Cancel</a></td>' +
		    			'</tr></table></div>' + 
		    		'</div>')
    .appendTo($(_dialog))
    .trigger('create');
   
   	centerDialogPanel(_dialogPanel);
    return false;
}

function createDialog(){
	var _dialog = $('<div id="divMensaje" data-theme="a" class="cuadroCentrado">' + 
		    			'<div class="alpha_fondo">&nbsp;</div>' + 
		    		'</div>')
    .css({ "width":$(window).width(), "height":$(window).height()})
    .appendTo($("body"));
    
    return _dialog
}

function centerDialogPanel(dialogPanel){
	
	var _offsetWidth = $(dialogPanel).width()/2;
   	var _offsetHeight = $(dialogPanel).height()/2 - $(window).scrollTop();
   	$(dialogPanel).css('margin-top', - _offsetHeight + 'px');
   	$(dialogPanel).css('margin-left', - _offsetWidth + 'px');
}

function hideDialog(){
	
	var _divMsg = $("#divMensaje");
	$(_divMsg).css({"display":"none"}).remove();	
}
	
var _resultFunctionNoParams;	

//var _lastPageLogin = '';

//var _isLoginDone=false;

function openHybridOK(){
	
	if (ConstF.traceLog) console.log('openHybridOK  - Time:'  + new Date().getTime());
	
	window.plugins.childBrowser.onLocationChange= function(loc){
 		//if (loc.toString().indexOf('retail.do') != -1) _isLoginDone = true;
		if (loc.search('action=close')!=-1){
			window.plugins.childBrowser.close();
		}
		else if(loc.search('action=logout')!=-1)
		{
			window.plugins.childBrowser.close();
			//showLogOut(GestorIdiomas.getLiteral('logout_ok'));
			//_isLoginDone=false
		}
		
		else if(loc.search('action=forced')!=-1)
		{
			window.plugins.childBrowser.close();
			//showLogOut(GestorIdiomas.getLiteral('logout_timeout'));
			//_isLoginDone=false
			
		}   
		setLangNative(loc);  
	};
	var url=null;

		url = ConstF.urlServer;
	
		if(url!=null){
			
			// APK - Flag
			url+= '?access=APK';
			
			// Language
			var _lang = GestorIdiomas.getLang();
			if (_lang=='ar_SA'){_lang='ar_SA'}else{_lang='en_US'}
			url+= '&locale='+_lang;
		}

	window.plugins.childBrowser.showWebPage(url, { showLocationBar: false });		

}
function openHybrid() {
	if (ConstF.traceLog) console.log('openHybrid  - Time:'  + new Date().getTime());
	checkConnection(openHybridOK,null);
}

function openFinCalcOK() {
	if (ConstF.traceLog) console.log('openFinCalcOK  - Time:'  + new Date().getTime());
	window.plugins.childBrowser.onLocationChange= function(loc){
		if (loc.search('action=close')!=-1){
			window.plugins.childBrowser.close();
		}
	};
	
	var urlFC = ConstF.urlFinCalc;
	
	if(urlFC!=null){
		var _theme= "mobile_en"
		var _lang = GestorIdiomas.getLang();
		if (_lang=='ar_SA'){
				_lang='ar-SA'
				_theme= "mobile_ar"
			}else{
				_lang='en-GB'
				}
		urlFC+= '&languageCode='+_lang + '&theme=' + _theme;
		window.plugins.childBrowser.showWebPage(urlFC, { showLocationBar: false });
		
	} else {
		//alert('You haven\'t specified the\nfinance calculator URL');
	}			
}
function openFinCalc() {
	checkConnection(openFinCalcOK,null);
}

function openAboutOK(){
	if (ConstF.traceLog) console.log('openAboutOK  - Time:'  + new Date().getTime());
	var _lang = GestorIdiomas.getLang();
	var _URLsa = ConstF.urlPublic + _lang.split('_')[0] + "/pages/default.aspx"
	window.plugins.childBrowser.openExternal(_URLsa, false);
}
function openAbout() {
	checkConnection(openAboutOK,null);
}
			

function openBannerOK(campaignUrl,campaignId,bannerId){
	if (ConstF.traceLog) console.log('openBannerOK  - Time:'  + new Date().getTime());
	if ($.objectHasContent(campaignUrl))
	{
		window.plugins.childBrowser.openExternal(campaignUrl, false);
	}
	new _BannerManager().notifyClick(campaignId,bannerId);
}
function openBanner(campaignUrl,campaignId,bannerId) {
	checkConnection(openBannerOK(campaignUrl,campaignId,bannerId),null);
}
	
function openMapOK(){
	if (ConstF.traceLog) console.log('openMapOK  - Time:'  + new Date().getTime());
	window.plugins.childBrowser.onLocationChange= function(loc){
		
		if (loc.search('action=close')!=-1){
			window.plugins.childBrowser.close();
		}

		setLangNative(loc);  
	};
	
	var url = ConstF.urlMap;
	//url="http://192.168.43.199:8082/mobile/content/map.do";
	if(url!=null){
		var _lang = GestorIdiomas.getLang();
		if (_lang=='ar_SA'){_lang='ar_SA'}else{_lang='en_US'}
		url+= '?locale='+_lang;
		url+= '&isNative=true';
		window.plugins.childBrowser.showWebPage(url, { showLocationBar: false });
	} else {
		//alert('You haven\'t specified the\nhost URL');
	}		
}
function openMap() {
	checkConnection(openMapOK,null);
}




function openProductsOK(){
	
	var _lang = GestorIdiomas.getLang();
	var _URLsa = ConstF.urlPublic + _lang.split('_')[0] + "/personal/pages/latest-offers-competitions.aspx";
	window.plugins.childBrowser.openExternal(_URLsa, false);
	
}
function openProducts() {
	checkConnection(openProductsOK,null);
}

function openFeedbackOK(){
	if (ConstF.traceLog) console.log('openFeedbackOK  - Time:'  + new Date().getTime());
	window.plugins.packageInformation.getPackageName(
		function(data){
			console.log('getPackageName:' + data);
			var _URL = "market://details?id="+data;
			window.plugins.childBrowser.openExternal(_URL, false);
		},
		null);
}
function openFeedback() {
	checkConnection(openFeedbackOK,null);
}
	


var wheel;

function createWheel(_bodyMiddleX, _bodyMiddleY) {
	wheel = {
		RootObj : null,
		el : null,
		controller : null,
		log : null,
		angle : 0,
		OldDownAngleValue : 0,
		startAngle : 0,
		clickStartAngle : 0,
		slices : 2 * Math.PI / 6, // 6 slices
		originX : _bodyMiddleX,
		originY : _bodyMiddleY, 
		clickevent : false,
		startX : 0,
		startY : 0,
		selectedOption:null,
		values : {
			5 : 'Sel5',
			4 : 'Sel4',
			3 : 'Sel3',
			2 : 'Sel2',
			1 : 'Sel1',
			0 : 'Sel0'
		},

		handleEvent : function(e) {
			if(e.type == 'touchstart') {
				this.rotateStart(e);
			} else if(e.type == 'touchmove') {
				this.rotateMove(e);
			} else if(e.type == 'touchend') {
				this.rotateStop(e);
			}//else if(e.type == 'touchcancel'){}
		},

		init : function(pRootObj) {
			this.RootObj = pRootObj;

			this.el = document.getElementById('rotate');
			this.controller = document.getElementById('display1');
			this.el.style.webkitTransitionDuration = '0ms';
			this.log = document.getElementById('log');
			this.controller.addEventListener('touchstart', this, false);
			this.el.addEventListener( 'webkitTransitionEnd',function( event) {wheel.fixOption();}, false );
		},

		rotateStart : function(e) {
			// En cuanto la ruleta se empieza a mover, desaparece el cacho
			$('.selected_option_highlight').css('display', 'none');
			
			e.preventDefault();
			clickevent = true;
			
			this.el.style.webkitTransitionDuration = '0ms';

			//var startX = e.touches[0].pageX - this.originX;
			this.startX = e.touches[0].pageX - this.originX;
			//var startY = e.touches[0].pageY - this.originY;
			this.startY = e.touches[0].pageY - this.originY;
			this.startAngle = Math.atan2(this.startY, this.startX) - this.angle;
			this.clickStartAngle = Math.atan2(this.startY, this.startX);
			//this.startAngle = Math.atan2(startY, startX) - this.angle;
			//this.clickStartAngle = Math.atan2(startY, startX);
			
			this.controller.addEventListener('touchend', this, false);
			this.controller.addEventListener('touchmove', this, false);

			
		},

		// Movimiento de arrastre de la ruleta
		rotateMove : function(e) {
			// En cuanto la ruleta se empieza a mover, desaparece el cacho
			$('.selected_option_highlight').css('display', 'none');
			
			var dx = e.touches[0].pageX - this.originX;
			var dy = e.touches[0].pageY - this.originY;
			this.angle = Math.atan2(dy, dx) - this.startAngle;

			if (Math.abs(Math.abs(dy) - Math.abs(this.startY)) > 3) {
				this.el.style.webkitTransform = 'rotateZ(' + this.angle + 'rad)';
				e.preventDefault();
				clickevent = false;	
			}


		},

		rotateStop : function(e) {

			this.controller.removeEventListener('touchmove', this, false);
			this.controller.removeEventListener('touchend', this, false);
			e.preventDefault();
			if(clickevent) {
				this.angle += Math.PI / 2 - this.clickStartAngle;
				this.angle = Math.round(this.angle / this.slices) * this.slices;
				this.selectedOption = this.getSelectedValue();
				this.el.style.webkitTransitionDuration = '800ms';
				this.el.style.webkitTransform = 'rotateZ(' + this.angle + 'rad)';
				if(this.angle == this.OldDownAngleValue)
					this.detectselection();

			} else if(this.angle % this.slices) {
				this.angle = Math.round(this.angle / this.slices) * this.slices;
				this.selectedOption = this.getSelectedValue();
				this.el.style.webkitTransitionDuration = '300ms';
				this.el.style.webkitTransform = 'rotateZ(' + this.angle + 'rad)';
			}
			this.OldDownAngleValue = this.angle;
		},
		
		fixOption : function() {
			if(this.selectedOption!=null){
				console.log('LA OPCION ' + this.selectedOption);
				var _ltime = 100;
				switch ( this.selectedOption[0] ) {
					case 0:
						setTimeout(function(){
							$('#loginSelected').css('display', 'block').bind('click', function (evt) {ShowLoadingMessage();openHybrid();});
						},_ltime);	
						break;
					case 1:
						setTimeout(function(){
							$('#currconvSelected').css('display', 'block').bind('click', function (evt) {ShowLoadingMessage();browseCurrencyConverter();});
						},_ltime);	
						break;
					case 2:
						setTimeout(function(){
							$('#atmblSelected').css('display', 'block').bind('click', function (evt) {ShowLoadingMessage();openMap();});
						},_ltime);	
						break;
					case 3:
						setTimeout(function(){
							$('#prodoffSelected').css('display', 'block').bind('click', function (evt) {ShowLoadingMessage();openProducts();});
						},_ltime);	
						break;
					case 4:
						setTimeout(function(){
							$('#finsimSelected').css('display', 'block').bind('click', function (evt) {ShowLoadingMessage();openFinCalc();});
						},_ltime);	break;
					case 5:
						setTimeout(function(){
							$('#moreSelected').css('display', 'block').bind('click', function (evt) { browseFromClick('more.html', 'none');});
						},_ltime);	break;
				}
				this.selectedOption=null;	
			}		
		},
		getSelectedValue : function() {
			var selected = Math.floor(Math.abs(this.angle) / this.slices / 6);
			if(this.angle < 0)
				selected = -selected;
			selected = Math.round(this.angle / this.slices) - selected * 6;
			if(selected < 0)
				selected = 6 + selected;
			return [selected, this.values[selected]];
		},

		detectselection : function() {
			if(this.getSelectedValue() == "0,Sel0") {
				ShowLoadingMessage();openHybrid();
				$('#loginSelected').css('display', 'block').bind('click', function (evt) {openHybrid();});
			} else if(this.getSelectedValue() == "1,Sel1") {
				ShowLoadingMessage();browseCurrencyConverter();
			} else if(this.getSelectedValue() == "2,Sel2") {
				ShowLoadingMessage();
				openMap();
			} else if(this.getSelectedValue() == "3,Sel3") {
				ShowLoadingMessage();
				openProducts();
			} else if(this.getSelectedValue() == "4,Sel4") {
				ShowLoadingMessage();
				openFinCalc();
			} else if(this.getSelectedValue() == "5,Sel5") {
				ShowLoadingMessage();
				browseFromClick('more.html', 'none');
			}
		}
	};

	wheel.onerror = function(errorMessage, fileName, lineNumber) {
		var error = "";
		error = "There is an error at this page.\n";
		error += "Error: " + errorMessage + "\n";
		error += "URL: " + fileName + "\n";
		error += "Line: " + lineNumber + "\n\n";
		error += "Click OK to continue viewing this page,\n";
		//alert(error);
	}
}

function loaded() {
	var i, lis, theTransform, matrix;
	lis = document.getElementsByTagName('li');
	for( i = 0; i < lis.length; i += 1) {
		theTransform = window.getComputedStyle(lis[i]).webkitTransform;
		matrix = new WebKitCSSMatrix(theTransform).translate3d(0, 100);
		lis[i].style.webkitTransform = matrix;
	}

	function detectselection() {
		if(wheel.getSelectedValue() == "0,Sel0") {
			ShowLoadingMessage();
			openHybrid();
			$('#loginSelected').css('display', 'block').bind('click', function (evt) {openHybrid();});
		} else if(wheel.getSelectedValue() == "1,Sel1") {
			ShowLoadingMessage();
			browseCurrencyConverter();
		} else if(wheel.getSelectedValue() == "2,Sel2") {
			ShowLoadingMessage();
			openMap();
		} else if(wheel.getSelectedValue() == "3,Sel3") {
			ShowLoadingMessage();
			openProducts();
		} else if(wheel.getSelectedValue() == "4,Sel4") {
			ShowLoadingMessage();
			openFinCalc();
		} else if(wheel.getSelectedValue() == "5,Sel5") {
			ShowLoadingMessage();
			browseFromClick('more.html', 'none');
		}

	}

	wheel.init(this);
	
	document.getElementById('ok').addEventListener('touchstart', detectselection, false);
	document.getElementById('ok').addEventListener('touchmove', detectselection, false);
	document.getElementById('ok').addEventListener('touchstop', detectselection, false);
}


var PageScroll = null;

/**
 * Coge la pagina actual, calcula el tamaño que tiene que ocupar el content
 * se lo aplica y le pone un scroll 
 * Se pasa por parámetro el id de la pagina
 */
function autoScrollPageContentRole(pageId){
	console.log('AutoScrollPageContentRole desde '+pageId);
	if (document.getElementById(pageId)!=null)
	{
		var mobileHeight = $(window).height();
		var header = $('#'+pageId+' div[data-role="header"]');
		var footer = $('#'+pageId+' div[data-role="footer"]');
		var content = $('#'+pageId+' div[data-role="content"]');
		
		/* Fijamos al maximo el content*/
		var contentSize = mobileHeight-header.height()-footer.height();
		setContentControlHeight(content,contentSize);
			
	 	createScroll(content);
	 	$($.mobile.activePage).trigger('create');
	}
	else
	{
		console.log('NULACO: ' + pageId);
	}
}

/**
 * Aplica autoscroll a un determinado control contenido restándole a la altura de la ventana la de los controlse
 * pasados por parámetro. 
 * 
 * Únicamente se aplica a pois.html que es el único caso en el que no se hace autoscroll a todo el data-role="content" de la página 
 */
function autoScrollDefiningContent(contentControl, otherControls){
	console.log('AutoScrollDefiningContent desde '+contentControl);
	if (document.getElementById(contentControl)!=null)
	{
		var mobileHeight = $(window).height();
		var content = $('#'+contentControl);
		
		var _otherControlsHeight = 0;
		if (otherControls!= null && otherControls.length>0)
		{
			for(var i=0; i< otherControls.length; i++)
			{
				_otherControlsHeight += $('#'+otherControls[i]).height();
			}
		}
		
		/* Fijamos al maximo el content*/
		var contentSize = mobileHeight-_otherControlsHeight;
		setContentControlHeight(content,contentSize);
		
	 	createScroll(content);
	 	$($.mobile.activePage).trigger('create');
	}
	else
	{
		console.log('NULACO: ' + pageId);
	}
}

function setContentControlHeight(content, contentSize)
{
	/* Fijamos al maximo el content*/
	content.height(contentSize);
	content.css('max-height',contentSize);
	content.css('height',contentSize);
	content.css('min-height',contentSize);
	$($.mobile.activePage).trigger('create');
	console.log('Content fijado automaticamente a:' + contentSize);
}


function createScroll(content)
{
	/* Aplicamos el iScroll al content para que realice el scroll*/
	 	if (PageScroll!=null){ PageScroll.destroy(); PageScroll = null; }
	 	PageScroll = new iScroll($(content).attr('id'),{ hScrollbar: false, hideScrollbar: true,
		onBeforeScrollStart: function (e) {
			var target = e.target;
			while (target.nodeType != 1) target = target.parentNode;

			if (target.tagName != 'SELECT' && target.tagName != 'INPUT' && target.tagName != 'TEXTAREA')
				e.preventDefault();
		} });
}

/**
 * Fija el content al tamaño sobrante de la cabecera y del footer 
 * @param {Object} id
 */
function autoFit(pageId){
	var mobileHeight = $(window).height();
	var header = $('#'+pageId+' div[data-role="header"]');
	var footer = $('#'+pageId+' div[data-role="footer"]');
	var content = $('#'+pageId+' div[data-role="content"]');
	console.log('Header:'+header.height());
	console.log('Footer:'+footer.height());
	console.log('Window:'+mobileHeight);
	
	/* Fijamos al maximo el content*/
	var contentSize = mobileHeight-header.height()-footer.height();
	console.log('Final'+contentSize);
	setContentControlHeight(content,contentSize);
}



				$('#productsOffers').on('pageshow', function(event) {
					initPage(this);
					cargaProductsOffers('productList-div');
					
				});

				function NavigateProduct(idProduct) {
					ProductsManager.setProduct(idProduct);
					browseFromClick('prod_of_details.html', 'none');
				}

				function cargaProductsOffers(listDivId) {
					var listHTML = '';
					var indicatorHTML = '';
					
					var _langCss = (GestorIdiomas.getLang()=='ar_SA'?'ARLabel':'');
					//TODO: esto se tiene que programar bien con la lista correcta
					listHTML += '<ul data-role="listview"  data-inset="true" data-theme="lista">';
					products = ProductsManager.PRODUCTS();
					for(var i = 0; i < products.length; i++) {
						listHTML += '<li data-icon="arrow_blue">';
						listHTML += '<a href="javascript:NavigateProduct(' + products[i].PROD_ID + ');"  class="ui-btn-text" >';
						listHTML += '<table width="90%"><tr><td width="10%" style="vertical-align: top;">';
						listHTML += '<img src="../productsOffers/' + products[i].PROD_IMG_SMALL + '"  class="ui-li-thumb-big" />';
						listHTML += '</td><td width="80%" style="vertical-align: top;">';
						listHTML += '<h3 class="ui-li-heading ' + _langCss + '">' + products[i].PROD_TITLE + '</h3>';
						listHTML += '<div class="ui-li-desc  ' + _langCss + '">' + products[i].PROD_DESC + '</div>';
						listHTML += '</td></tr></table>';
						listHTML += '</a>';
						listHTML += '</li>';
					}
					listHTML += '</ul>';

					// Evitamos ghost clicks
					setTimeout(function() {
						$('#' + listDivId).html(listHTML);
						$('#' + listDivId).trigger('create');
						
						autoScrollPageContentRole('productsOffers');
					}, 301);
				}
			




var currencyOrder = {'en_US':'SAR;EUR;USD;INR;AUD;CAD;BHD;BDT;BND;BRL;CNY;CYP;DKK;EGP;HKD;IDR;IRR;JPY;JOD;KES;KWD;LBP;MYR;MUR;MAD;NPR;NZD;NOK;OMR;PKR;PHP;PLN;GBP;QAR;XOF;SGD;ZAR;LKR;SDD;SEK;CHF;SYP;THB;TND;TRL;AED;YER',
					 'ar_SA':'SAR;EUR;USD;INR;AUD;CAD;THB;PHP;BDT;GBP;SYP;CYP;LBP;EGP;AED;MAD;BND;SGD;NZD;HKD;JOD;BHD;TND;SDD;KWD;ZAR;IDR;PKR;MUR;NPR;LKR;OMR;QAR;YER;IRR;MYR;PLN;KES;XOF;CHF;DKK;NOK;SEK;TRL;JPY;BRL;CNY'
					} 

var rates = {
		 'AUD':{"currencyCode":"AUD","numDecimals":2},
		 'BHD':{"currencyCode":"BHD","numDecimals":3},
		 'BDT':{"currencyCode":"BDT","numDecimals":2},
		 'BND':{"currencyCode":"BND","numDecimals":2},
		 'CAD':{"currencyCode":"CAD","numDecimals":2},
		 'CNY':{"currencyCode":"CNY","numDecimals":2},
		 'CYP':{"currencyCode":"CYP","numDecimals":2},
		 'DKK':{"currencyCode":"DKK","numDecimals":2},
		 'EGP':{"currencyCode":"EGP","numDecimals":3},
		 'EUR':{"currencyCode":"EUR","numDecimals":2},
		 'HKD':{"currencyCode":"HKD","numDecimals":2},
		 'INR':{"currencyCode":"INR","numDecimals":2},
		 'IDR':{"currencyCode":"IDR","numDecimals":2},
		 'IRR':{"currencyCode":"IRR","numDecimals":2},
		 'JPY':{"currencyCode":"JPY","numDecimals":0},
		 'JOD':{"currencyCode":"JOD","numDecimals":3},
		 'KES':{"currencyCode":"KES","numDecimals":2},
		 'KWD':{"currencyCode":"KWD","numDecimals":3},
		 'LBP':{"currencyCode":"LBP","numDecimals":2},
		 'MYR':{"currencyCode":"MYR","numDecimals":2},
		 'MUR':{"currencyCode":"MUR","numDecimals":2},
		 'MAD':{"currencyCode":"MAD","numDecimals":2},
		 'NPR':{"currencyCode":"NPR","numDecimals":2},
		 'NZD':{"currencyCode":"NZD","numDecimals":2},
		 'NOK':{"currencyCode":"NOK","numDecimals":2},
		 'OMR':{"currencyCode":"OMR","numDecimals":3},
		 'PKR':{"currencyCode":"PKR","numDecimals":2},
		 'PHP':{"currencyCode":"PHP","numDecimals":2},
		 'PLN':{"currencyCode":"PLN","numDecimals":2},
		 'GBP':{"currencyCode":"GBP","numDecimals":2},
		 'QAR':{"currencyCode":"QAR","numDecimals":2},
		 'SAR':{"currencyCode":"SAR","numDecimals":2},
		 'XOF':{"currencyCode":"XOF","numDecimals":0},
		 'SGD':{"currencyCode":"SGD","numDecimals":2},
		 'ZAR':{"currencyCode":"ZAR","numDecimals":2},
		 'LKR':{"currencyCode":"LKR","numDecimals":2},
		 'SDD':{"currencyCode":"SDD","numDecimals":2},
		 'SEK':{"currencyCode":"SEK","numDecimals":2},
		 'CHF':{"currencyCode":"CHF","numDecimals":2},
		 'SYP':{"currencyCode":"SYP","numDecimals":2},
		 'THB':{"currencyCode":"THB","numDecimals":2},
		 'TND':{"currencyCode":"TND","numDecimals":3},
		 'TRL':{"currencyCode":"TRL","numDecimals":0},
		 'AED':{"currencyCode":"AED","numDecimals":2},
		 'USD':{"currencyCode":"USD","numDecimals":2},
		 'YER':{"currencyCode":"YER","numDecimals":2},
		 'BRL':{"currencyCode":"BRL","numDecimals":2}
		 }


				var currencyFrom;
				var currencyTo;
				var rateFrom=1;
				var rateTo=1;
				var rateToApply=1;
				
				var changing;

				$('#currencyConverter').on('pageshow', function(event) {
					initPage(this);
					currencyFrom = 'SAR';//Default Value
					currencyTo = 'EUR';

					setRates(currencyFrom,currencyTo);

					setChangeCurrency();
					fillRates();

					autoScrollPageContentRole('currencyConverter');
					
				});


				function fillRates(){
					var _htmlData='',i=0;
					var _orderedRates = currencyOrder[GestorIdiomas.getLang()].split(";");
					
					for(var idx=0; idx < _orderedRates.length  ;idx++)
					{
						var  _rate = _orderedRates[idx];
						if(i%3 == 0){
							_htmlData+='<div class="divCurrencySelect">';
						}
						_htmlData+='<div class="divIcoCurrency" onclick="javascript:changeCurrency(\'' + rates[_rate].currencyCode + '\');">';
						 _htmlData+='<a href="#">';
						 _htmlData+='<img src="../themes/default/CurrencyImg/' + rates[_rate].currencyCode + 'ico.png"/><span>';
						 _htmlData+= _rate + '</span></a>';
						_htmlData+='</div>';
						
						if(((i + 1) %3) == 0 ){
							_htmlData+='</div>';
						}
						
						i++;
					}
					
					$('#currencySet').html(_htmlData);
					
				}
				
				function setChangeCurrency() {
					
					$('#lblrateFrom').html('<strong>1 ' + currencyFrom + '</strong> = ' + rateTo + ' ' + currencyTo);
					//$('#lblrateTo').html('<strong>1 ' + currencyTo + '</strong> = ' + rateFrom + ' ' + currencyFrom);
					$('#lblrateTo').html('<strong>' + GestorIdiomas.getLiteral('currencyConverter_rate') + ': </strong>' + rateFrom );

	


					$('#lblFrom').html(currencyFrom);
					$('#lblFromDesc').html(GestorIdiomas.getLiteral(rates[currencyFrom].currencyCode));
					$('#lblTo').html(currencyTo);
					$('#lblToDesc').html(GestorIdiomas.getLiteral(rates[currencyTo].currencyCode));

					$('#imgRateFrom').attr('src', '../themes/default/CurrencyImg/' + rates[currencyFrom].currencyCode + 'flag.png');
					$('#imgRateTo').attr('src','../themes/default/CurrencyImg/' + rates[currencyTo].currencyCode + 'flag.png');


					applyRate();
				}

				function changeRates() {
					var from = currencyFrom;
					currencyFrom = currencyTo;
					currencyTo = from;
					setRates(currencyFrom,currencyTo)
					//setChangeCurrency();
				}

				function applyRate() {
					$('#toolsChange').val(($('#toolsAmount').val() * rateToApply).toFixed(rates[currencyTo].numDecimals));
				}

				function showCurrencies(target) {
					changing = target;
					$('#currencySet').css('display', '');
					autoScrollPageContentRole('currencyConverter');
				}

				function changeCurrency(currency) {
					if(changing == 'from') {
						currencyFrom = currency;
					} else if(changing == 'to') {
						currencyTo = currency;
					}

					setRates(currencyFrom,currencyTo)

					//setChangeCurrency();

					$('#currencySet').css('display', 'none');
					autoScrollPageContentRole('currencyConverter');
				}

				// function getRateInvert() {
					// return (1 / rateTo).toFixed(rates[currencyTo].numDecimals);
				// }

				
				function setRates(from,to){
						ShowLoadingMessage();
						rateFrom = 1;
						rateTo=1;
		
						var oCurrencyParameters = {
	                			currencyFrom : from,
	                			currencyTo: to,
	                			amount: "1"
	        			};
	        			
	        			var _param =  $.param( oCurrencyParameters );	
							$.ajax({
									type : ConstF.GET,
									url : ConstF.base_WS + 'currency?' + _param,
									data : null,
									timeout: ConstF.timeoutRequest,
									contentType : ConstF.JsonContent,
									dataType : ConstF.JsonTipoDatos,
									success : function(data){
										//alert(JSON.stringify(data));
											rateTo = data.targetAmount; 
											rateFrom = data.exchangeRate;
											if(currencyFrom == 'SAR'){
												rateToApply = 1/data.exchangeRate;
											}else{
												rateToApply = data.exchangeRate;
											}
											$.mobile.loading('hide');
											setChangeCurrency();
										},
									error : function(err){											
											$.mobile.loading('hide');
											rateTo=1;
											setChangeCurrency();
											showPopup(GestorIdiomas.getLiteral('noConnectionMsgCurrency'));
											browseFromClick('wheel.html', 'none');
										}
								});
					}


					function validate(evt) {
					  var theEvent = evt || window.event;
					  var key = theEvent.keyCode || theEvent.which;
					  key = String.fromCharCode( key );
					  var regex = /[0-9]|\./;
					  if( !regex.test(key) ) {
					    theEvent.returnValue = false;
					    if(theEvent.preventDefault) theEvent.preventDefault();
					  }
					}

					function lostfocus(){
						$('#toolsAmount').val(($('#toolsAmount').val()*1).toFixed(rates[currencyFrom].numDecimals));
					}

			


				$('#contact').on('pageshow', function(event) {
					initPage(this);
					autoScrollPageContentRole('contact');
					
					
				});
			


				$('#language').on('pageshow',function(event){
	        		initPage(this);
	        		autoScrollPageContentRole('language');
	        		loadUrl();
	      		});
	      		
	      		
	      		function chooseLanguageAndNav(lang){
	      			GestorIdiomas.setLang(lang,navigate);
	      		}
	      		
	      		function navigate(){
	      			browse('wheel.html','none',true);
	      		}
	      		
	      		function saveUrl(){
	      			var url = $('#urlServer').val();
	      			var urlFC = $('#urlFinCalc').val();
	      			var urlMap = $('#urlMap').val();
	      			var baseWS = $('#base_WS').val();
	      			var urlBanner = $('#urlBanner').val();
	      			GestorPrefs.setPref('urlServer',url);
	      			GestorPrefs.setPref('urlFinCalc',urlFC);
	      			GestorPrefs.setPref('urlMap',urlMap);
	      			GestorPrefs.setPref('base_WS',baseWS);
	      			GestorPrefs.setPref('urlBanner',urlBanner);

	      			
	      			alert('URL successfully saved');
	      			navigate();
	      		}
	      		
	      		function loadUrl(){
	      			var url = GestorPrefs.getPref('urlServer');
	      			var urlFC = GestorPrefs.getPref('urlFinCalc');
	      			var urlMap = GestorPrefs.getPref('urlMap');
	      			var baseWS = GestorPrefs.getPref('base_WS');
	      			var urlBanner = GestorPrefs.getPref('urlBanner');
	      			
	      			
	      			if(url!=null){
	      				$('#urlServer').val(url);
	      			}
	      			if(urlFC!=null){
	      				$('#urlFinCalc').val(urlFC);
	      			}
	      			if(urlMap!=null){
	      				$('#urlMap').val(urlMap);
	      			}
	      			 if(baseWS!=null){
	      				$('#base_WS').val(baseWS);
	      			}
	      			
	      			if(urlBanner!=null){
	      				$('#urlBanner').val(urlBanner);
	      			}
	      			
	      		}
	      		
      		

					loadUrl();
				


      	
				$('#wheel').on('pageshow',function(event){
	        		initPage(this);
	        		
	        		$('#loginSelected').css('display','block');
	        		var _posicion = ($('#rotate').width()/2 - $('#loginSelected').width()/2);
					$('.selected_option_highlight').css('left', _posicion + 'px');
					var _bodyMiddleY = (($(window).height() - $('#wheel_header').height() - $('#wheel_footer').height())/2).toFixed();
					var _bodyMiddleX = ($(window).width()/2).toFixed();
					//$('#locker').css('left', (_bodyMiddleY - $('#rotate').height()/2).toString() + 'px ' + (_bodyMiddleX - $('#rotate').width()/2).toString() + 'px');
										
	        		if (GestorIdiomas.getLang()=='en_US'){
	      				$('#rotate').addClass('rotate_language_en');
	      				$('#loginSelected').addClass('loginSelected_en');
	      				$('#currconvSelected').addClass('currconvSelected_en');
	      				$('#atmblSelected').addClass('atmblSelected_en');
	      				$('#prodoffSelected').addClass('prodoffSelected_en');
	      				$('#finsimSelected').addClass('finsimSelected_en');
	      				$('#moreSelected').addClass('moreSelected_en');
	      			} else if (GestorIdiomas.getLang()=='ar_SA'){
	   	      			$('#rotate').addClass('rotate_language_ar');
	   	      			$('#loginSelected').addClass('loginSelected_ar');
	      				$('#currconvSelected').addClass('currconvSelected_ar');
	      				$('#atmblSelected').addClass('atmblSelected_ar');
	      				$('#prodoffSelected').addClass('prodoffSelected_ar');
	      				$('#finsimSelected').addClass('finsimSelected_ar');
	      				$('#moreSelected').addClass('moreSelected_ar');
	      			}
	        		createWheel(_bodyMiddleX, parseInt(_bodyMiddleY) + parseInt($('#wheel_header').height()));
	        		loaded();
	        		autoFit('wheel');
	        		setBanners();
	        		
	        		$('#locker').on('touchstart',function(e){
	        			e.preventDefault();
	        		});
	        		$('#locker').on('touchmove',function(e){
	        			e.preventDefault();
	        		});
	        		$('#locker').on('touchstop',function(e){
	        			e.preventDefault();
	        		});
	        		
	        		$('#display1').on('touchstart',function(e){
	        			e.preventDefault();
	        		});
	        		$('#display1').on('touchmove',function(e){
	        			e.preventDefault();
	        		});
	        		$('#display1').on('touchstop',function(e){
	        			e.preventDefault();
	        		});
	        		$('#wheel_content').on('touchstart',function(e){
	        			e.preventDefault();
	        		});
	        		$('#wheel_content').on('touchmove',function(e){
	        			e.preventDefault();
	        		});
	        		$('#wheel_content').on('touchstop',function(e){
	        			e.preventDefault();
	        		});
	        
	        	    $('#wheel_header').on('touchmove',function(e){
	        			e.preventDefault();
	        		});
	        		
	        		if(!navigator.userAgent.match(/4.[2-9]/)){
	        			
	        			$('#wheel_header').on('touchstart',function(e){
		        			e.preventDefault();
		        		});
	
		        		$('#wheel_header').on('touchstop',function(e){
		        			e.preventDefault();
		        		});
	        			
	        			$('#changeWheelBtn').on('tap',function(){
	        					changeWheel();
	        			});
	        		}else{
		  	      		$( "#changeWheelBtn" ).click(function() {
		        				changeWheel();
						});
	        		}
	 
	      		});
	      		
	      		function setBanners(){
	      			
					BannerManager.loadBanners(GestorIdiomas.getLang(),paintBanner);
					

							
	      		}
	      		 function paintBanner(){
					if($('#' + ConstPages.Element_Banner).length){
						$('#' + ConstPages.Element_Banner).replaceWith(BannerManager.getBanner(ConstPages.Element_Banner));
						$('#' + ConstPages.Element_Banner).on('swiperight', function(event) {
							navigatePrevBanner();
						});
		      			
		      			$('#' + ConstPages.Element_Banner).on('swipeleft', function(event) {
							navigateNextBanner();
						});
						$('#' + ConstPages.Element_Banner).trigger('create');
					}
				}
				
				function navigatePrevBanner(){
					BannerManager.setPrevBanner();
					paintBanner();
				};
				function navigateNextBanner(){
					BannerManager.setNextBanner();
					paintBanner();
				};


	      		function setLangNative(loc){
					var _natLang;
					if(loc.search('locale=ar_SA')!=-1){
						_natLang="ar_SA";
					}else if(loc.search('locale=en_US')!=-1){
						_natLang="en_US";
					} else {
						_natLang="";
					}
					// alert('En la URL: ' + _natLang);
					var _lang = GestorIdiomas.getLang();
					// alert('En la parte nativa: ' + _lang);
					if(_natLang != "" && _lang != _natLang){
						changeWheel();
						//changeLanguageAndNav('wheel',drawImages);
					}				
				}
	      		
	      		function changeWheel(){
	      			//ShowLoadingMessage();
	      			changeLanguageAndNav('wheel',drawImages);
	      			BannerManager.loadBanners(GestorIdiomas.getLang(),paintBanner);
	      		}
	      		
	      		function drawImages(){
	      			if (GestorIdiomas.getLang()=='ar_SA'){
	      				$('#rotate').removeClass('rotate_language_en').addClass('rotate_language_ar');
	      				$('#loginSelected').removeClass('loginSelected_en').addClass('loginSelected_ar');
	      				$('#currconvSelected').removeClass('currconvSelected_en').addClass('currconvSelected_ar');
	      				$('#atmblSelected').removeClass('atmblSelected_en').addClass('atmblSelected_ar');
	      				$('#prodoffSelected').removeClass('prodoffSelected_en').addClass('prodoffSelected_ar');
	      				$('#finsimSelected').removeClass('finsimSelected_en').addClass('finsimSelected_ar');
	      				$('#moreSelected').removeClass('moreSelected_en').addClass('moreSelected_ar');
	      			} else if (GestorIdiomas.getLang()=='en_US'){
	   	      			$('#rotate').removeClass('rotate_language_ar').addClass('rotate_language_en');
	      				$('#loginSelected').removeClass('loginSelected_ar').addClass('loginSelected_en');
	      				$('#currconvSelected').removeClass('currconvSelected_ar').addClass('currconvSelected_en');
	      				$('#atmblSelected').removeClass('atmblSelected_ar').addClass('atmblSelected_en');
	      				$('#prodoffSelected').removeClass('prodoffSelected_ar').addClass('prodoffSelected_en');
	      				$('#finsimSelected').removeClass('finsimSelected_ar').addClass('finsimSelected_en');
	      				$('#moreSelected').removeClass('moreSelected_ar').addClass('moreSelected_en');	   	      			
	      			}
	      			$.mobile.hidePageLoadingMsg();
	      		};
	      		
	      	
      		


				var productsScroll;
				var pageHeight;

				$('#prod_of_details').on('pageshow', function(event) {
					initPage(this);
					cargaProductOffer();
					autoScrollPageContentRole('prod_of_details');
				});

				function navigateNextOffer() {
					$.mobile.loading('show');
					idProduct = ProductsManager.PRODUCTS()[ProductsManager.productPosition(ProductsManager.SELECTED_PRODUCT().PROD_ID) + 1].PROD_ID;
					cargaProductOffer(idProduct)
				}

				function navigatePrevOffer() {
					$.mobile.loading('show');
					idProduct = ProductsManager.PRODUCTS()[ProductsManager.productPosition(ProductsManager.SELECTED_PRODUCT().PROD_ID) - 1].PROD_ID;
					cargaProductOffer(idProduct)
				}

				function cargaProductOffer(idProduct) {

					if($.objectHasContent(idProduct)) {
						ProductsManager.setProduct(idProduct);
					}


					$('#content_section_prod').off('swiperight');
					$('#content_section_prod').off('swipeleft');

					if($.objectHasContent(ProductsManager.SELECTED_PRODUCT())) {
						product = ProductsManager.SELECTED_PRODUCT();
						var _langCss = (GestorIdiomas.getLang()=='ar_SA'?'ARLabel':'');

						$('#divPROD_ID').html(product.PROD_ID);
						$('#divPROD_TITLE').html("<div class='" + _langCss + "'>" + product.PROD_TITLE + "</div>");
					
						$('#divPROD_DESC_AMP').html(product.PROD_DESC_AMP);
						$('#divPROD_DESC_AMP').addClass(_langCss);
						
						$('#divPROD_IMG').html('<img width="100%" src="../productsOffers/' + product.PROD_IMG + '"/>');
						$('#divPROD_WHAT_OFF').html(product.PROD_WHAT_OFF);
						$('#divPROD_WHAT_OFF').addClass(_langCss);

						if(ProductsManager.IsFirst(product.PROD_ID)) {
							document.getElementById("btnBack").style.visibility = "hidden";
			
						} else {
							document.getElementById("btnBack").style.visibility = "visible";
							$('#content_section_prod').on('swiperight', function(event) {
								navigatePrevOffer();
							});
						}

						if(ProductsManager.IsLast(product.PROD_ID)) {
							document.getElementById("btnNext").style.visibility = "hidden";
	
						} else {
							document.getElementById("btnNext").style.visibility = "visible";
							$('#content_section_prod').on('swipeleft', function(event) {
								navigateNextOffer();
							});
						}

					} else {
						//alert('No hay producto');

					}

					$.mobile.loading('hide');
				}
			


				$('#tellAFriend').on('pageshow', function(event) {
					initPage(this);
					mailAutoMessage('mail_autoMsg');
					twitterAutoMessage('twitter_autoMsg');	
					//fcbAutoMessage('fcb_autoMsg');			
					smsAutoMessage('sms_autoMsg');
					autoScrollPageContentRole('tellAFriend');			
				});
				function mailAutoMessage(msgDivId) {
					var a = document.getElementById(msgDivId);
					a.href = "javascript:sendEmail();";
				}
				
				function sendEmail(){
					window.plugins.emailComposer.showEmailComposer(null, GestorIdiomas.getLiteral('taf_message'),null,null,null,true,null,null,null);
				}
				
				function smsAutoMessage(msgDivId) {
					var a = document.getElementById(msgDivId); 
					a.href = "smsto:?body=" + encodeURIComponent(GestorIdiomas.getLiteral('taf_message'));
				}
				
				function twitterAutoMessage(msgDivId) {
					var a = document.getElementById(msgDivId); 
					a.href = "javascript:window.plugins.childBrowser.openExternal('https://twitter.com/share?text=" + encodeURIComponent(GestorIdiomas.getLiteral('taf_message')) + "', false);";
				}
				
				function fcbAutoMessage(msgDivId) {
					var a = document.getElementById(msgDivId); 
					var _urlFcb = encodeURIComponent(ConstF.urlServer + "proxy?pipe=theme&itemId=icoTellAFriend");
					var _desc = encodeURIComponent(GestorIdiomas.getLiteral('taf_message')) ;
					var _id = ConstF.facebookId;
					a.href = "javascript:window.plugins.childBrowser.openExternal('https://www.facebook.com/dialog/feed?app_id=" + _id + "&link=https://developers.facebook.com/docs/reference/dialogs/&name=Al%20Rajhi%20Bank&caption=" + _desc + "&description=Al%20Rajhi&redirect_uri=http://www.facebook.com', false);";
				}	
			


				$('#more').on('pageshow',function(event){
	        		initPage(this);
	        		if(GestorIdiomas.getLang()=='ar_SA'){
	        			$('h2').addClass('tit-second-levelRTL');
	        		} else {
	        			$('h2').addClass('tit-second-level');
	        		}	        		
	        		setTimeout(function() {
	        			$('#more_content').css('display','block');
						autoScrollPageContentRole('more');
					}, 301);
	      		});      		     		     		
      		     		
      			function changeLang(){
	      			ShowLoadingMessage();
	      			changeLanguageAndNav('more',retorno);
	      		}
      		
	      		function retorno(){
	      			autoScrollPageContentRole('more');
	      			if (GestorIdiomas.getLang()=='ar_SA'){
	      				$('h2').removeClass('tit-second-level').addClass('tit-second-levelRTL');
	      			} else {
	        			$('h2').removeClass('tit-second-levelRTL').addClass('tit-second-level');
	        		}
	      			$.mobile.hidePageLoadingMsg();
	      		}
      		































				$('#init').on('pageshow', function(event) {
					init();
				});
				//Registramos el controlador hacia atras
				document.addEventListener("deviceready", createBackController, false);
			

/**
 * 
 * Phonegap share plugin for Android
 *
 */

var PackageInformation = function() {};
            
PackageInformation.prototype.getPackageName = function(success, fail) {
    return cordova.exec( function(args) {
        success(args);
    }, function(args) {
        fail(args);
    }, 'PackageInformation', 'GetPackageName', []);
};

PackageInformation.prototype.getVersionName = function(success, fail) {
    return cordova.exec( function(args) {
        success(args);
    }, function(args) {
        fail(args);
    }, 'PackageInformation', 'GetVersionName', []);
};

if(!window.plugins) {
    window.plugins = {};
}
if (!window.plugins.packageInformation) {
    window.plugins.packageInformation = new PackageInformation();
}

var SmsComposer = function () {};

SmsComposer.prototype.send = function (phone, message, success, fail) {    
    return cordova.exec( function(args) {
    	if (success != null)
        	success(args);
    }, function(args) {
    	if (fail != null)
        	fail(args);
    }, 'SmsComposer', "SendSMS", [phone, message]);
};

if(!window.plugins) {
    window.plugins = {};
}
if (!window.plugins.smsComposer) {
    window.plugins.smsComposer = new SmsComposer();
}

// function EmailComposer() {
	// this.resultCallback = null; // Function
// }

var EmailComposer = function () {};

EmailComposer.prototype.showEmailComposer = function(subject,body,toRecipients,ccRecipients,bccRecipients,bIsHTML,attachments, success, fail) {
	var args = {};
	if(toRecipients)
		args.toRecipients = toRecipients;
	if(ccRecipients)
		args.ccRecipients = ccRecipients;
	if(bccRecipients)
		args.bccRecipients = bccRecipients;
	if(subject)
		args.subject = subject;
	if(body)
		args.body = body;
	if(bIsHTML)
		args.bIsHTML = bIsHTML;
    if(attachments)
        args.attachments = attachments;

	 return cordova.exec( function(args) {
    	if (success != null)
        	success(args);
    }, function(args) {
    	if (fail != null)
        	fail(args);
    }, "EmailComposer", "showEmailComposer", [args]);
}

if(!window.plugins) {
    window.plugins = {};
}
if (!window.plugins.emailComposer) {
    window.plugins.emailComposer = new EmailComposer();
}

/**
 * 
 * Phonegap share plugin for Android
 *
 */

var Share = function() {};
            
Share.prototype.show = function(content, success, fail) {
    return cordova.exec( function(args) {
    	if (success != null)
        	success(args);
    }, function(args) {
    	if (fail != null)
        	fail(args);
    }, 'Share', '', [content]);
};

if(!window.plugins) {
    window.plugins = {};
}
if (!window.plugins.share) {
    window.plugins.share = new Share();
}

var Dialer = function () {};

SmsComposer.prototype.dial = function (phone, success, fail) {    
    return cordova.exec( function(args) {
    	if (success != null)
        	success(args);
    }, function(args) {
    	if (fail != null)
        	fail(args);
    }, 'Dialer', "Dialer", [phone]);
};

if(!window.plugins) {
    window.plugins = {};
}
if (!window.plugins.dialer) {
    window.plugins.dialer = new Dialer();
}

var Constantes = {
	'DatabaseNombre' : 'test',
	'DatabaseRev' : '1.0',
	'DataBaseDesc' : 'Test BD',
	'DatabaseTam' : 5*1024*1024,
	'err_timeout' : 'timeout',
	'prioridadBD' : 'bd',
	'prioridadNet' : 'net',
	'prioridadSoloBD' : 'soloBD',
	'prioridadSoloNet' : 'soloNet',
	'resultadoBD' : 'resultBD', //Indica que el resultado se ha sacado de la BD
	'resultadoNet' : 'resultNet', //Indica que el resultado se ha sacado de la red
	'timeoutBase' : 10*1000, //Timeout para el GET a la base del WS para chequear disponibilidad
	'timeoutRequest' : 5*60*1000, //Timeout para hacer las peticiones al WS
	'POST' : 'POST',
	'GET' : 'GET',
	'JsonContent' : 'application/json; charset=utf-8',
	'JsonTipoDatos' : 'json',
	'ico_activo' : '_act.png',
	'ico_inactivo' : '_des.png'
};


