


"use strict";function var_dump(e){console.log(JSON.stringify(e,null,2))}function LRUCache(e){this.size=0,this.limit=e,this._keymap={}}var jqmReady=$.Deferred(),pgReady=$.Deferred(),appInited=$.Deferred(),dataReady=$.Deferred(),aesReady=$.Deferred(),jsonhReady=$.Deferred();document.addEventListener("deviceready",pgReady.resolve,!1);var Model={settings:{},firstStart:!0,data:{mslist:null,charlist:null,warshiplist:null,constants:null,design:null,msGetFrom:null,charGetFrom:null,warshipGetFrom:null,msdev:null,warshipdev:null,questlist:null,slb:null,version:null},isAllDataLoaded:function(){for(var e in Model.data)if(null==Model.data[e])return!1;return!0},mapping:{mslist:[3,2],charlist:[4,0],warshiplist:[2,7],constants:[1,5],design:[6,3],msGetFrom:[0,7],charGetFrom:[5,4],warshipGetFrom:[6,1],msdev:[5,2],warshipdev:[3,7],questlist:[4,3],slb:[0,5]},indexData:function(){Model.idx={},Model.idx.msByCode={},Model.idx.msByCodeVariant={};for(var e=0,t=Model.data.mslist.length;t>e;e++){var a=Model.data.mslist[e].code,n=Model.data.mslist[e].variant;Model.idx.msByCode[a]||(Model.idx.msByCode[a]=[]),Model.idx.msByCode[a].push(e),Model.idx.msByCodeVariant[""+a+n]=e}Model.idx.charByCodeVariant={};for(var e=0,t=Model.data.charlist.length;t>e;e++){var a=Model.data.charlist[e].code,n=Model.data.charlist[e].variant;Model.idx.charByCodeVariant[""+a+n]=e}Model.idx.warshipByCodeVariant={};for(var e=0,t=Model.data.warshiplist.length;t>e;e++){var a=Model.data.warshiplist[e].code,n=Model.data.warshiplist[e].variant;Model.idx.warshipByCodeVariant[""+a+n]=e}},parse:function(e,t){if(""==e)return{};var a="",n=Model.mapping[t];if(n)for(var o=0;o<n.length;o++)a+=Model.k[n[o]];return"mslist"==t||"charlist"==t||"warshiplist"==t||"msGetFrom"==t||"charGetFrom"==t?jsonh.parse(n?Aes.Ctr.d(e,a,128):e):$.parseJSON(n?Aes.Ctr.d(e,a,128):e)},k:["5Ubewr","thesuE","8w9aBr","6uurUd","s4uNaa","3sUdr7","f4WaRu","chJp7u"],imagePath:function(e,t,a,n){var o=e+"0"+t+a,r=null;return 2==e?r=Model.data.warshiplist[Model.idx.warshipByCodeVariant[t+a]]:3==e?r=Model.data.mslist[Model.idx.msByCodeVariant[t+a]]:4==e&&(r=Model.data.charlist[Model.idx.charByCodeVariant[t+a]]),r&&("c"==n&&r.cardv?o+="v"+r.cardv:"t"==n&&r.thumbv&&(o+="v"+r.thumbv)),o+="c"==n?".cd":".tn"}},DB={db:null,settingsDb:null,init:function(e){DB.db="Win32"==navigator.platform||"Linux x86_64"==navigator.platform?window.openDatabase("ggfguide","1.0","ggfguide",1e6):window.sqlitePlugin.openDatabase({name:"ggfguide.db"}),DB.db.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS app (name string primary key, data text)")},function(){console.log("main db load error")},function(){console.log("main db load success"),DB.settingsDb="Win32"==navigator.platform||"Linux x86_64"==navigator.platform?window.openDatabase("settings","1.0","settings",1e6):window.sqlitePlugin.openDatabase({name:"settings"}),DB.settingsDb.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS app (name string primary key, data text)")},function(){console.log("settings db load error"),e()},function(){console.log("settings db load success"),e()})})},getSettings:function(e){DB._getData("settings",e,DB.settingsDb)},getVersion:function(e){DB._getData("version",e)},getMSList:function(e){DB._getData("mslist",e)},getCharList:function(e){DB._getData("charlist",e)},getWarshipList:function(e){DB._getData("warshiplist",e)},getConstants:function(e){DB._getData("constants",e)},getDesign:function(e){DB._getData("design",e)},getMSGetFrom:function(e){DB._getData("msGetFrom",e)},getCharGetFrom:function(e){DB._getData("charGetFrom",e)},getWarshipGetFrom:function(e){DB._getData("warshipGetFrom",e)},getMSDev:function(e){DB._getData("msdev",e)},getWarshipDev:function(e){DB._getData("warshipdev",e)},getQuest:function(e){DB._getData("questlist",e)},getSLB:function(e){DB._getData("slb",e)},_getData:function(e,t,a){var n=a||DB.db;n.transaction(function(a){a.executeSql("SELECT data FROM app WHERE name=?",[e],function(a,n){if(n&&n.rows&&n.rows.length>0)try{return t(Model.parse(n.rows.item(0).data,e))}catch(o){console.log(e),console.log(o)}else a.executeSql("INSERT INTO app (name, data) VALUES (?, ?)",[e,""]);t({})},function(e){var_dump(e),t(null)})})},saveData:function(e,t){return DB.db?void DB.db.transaction(function(t){for(var a in e)t.executeSql("UPDATE app SET data=? WHERE name=?",[e[a],a])},function(){t(!1)},function(){t(!0)}):void t(!1)}};window.Template={renderList:function(e,t,a){var n,o,r=$(e).html(),l=r.match(Template._paramRegex),i="";for(n=0,o=t.length;o>n;n++){var s;a?(s={},s[a]=t[n]):s=t[n],i+=Template.renderHtml(r,s,l)}return i},renderHtml:function(html,data,parameters){parameters=parameters||html.match(Template._paramRegex);var output=html,paramIdx,l;for(paramIdx=0,l=parameters.length;l>paramIdx;paramIdx++){var param=parameters[paramIdx],exp=param.slice(1,-1);!function(d){var value=eval(exp);output=output.replace(param,null===value||void 0===value?"?":value)}(data)}return output},_paramRegex:/\{[^\{^\}]+\}/g};var FS={fs:null,path:"remote/",initCache:function(e){var t="undefined"==typeof LocalFileSystem?TEMPORARY:LocalFileSystem.TEMPORARY;window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(t,0,function(t){FS.fs=t,FS.fs.root.getDirectory(FS.path,{create:!0,exclusive:!1},function(e){console.log("Created dir "+e.name)},function(e){console.log("Error creating directory "+e.code)}),e&&e()})},getFile:function(e,t){return FS.fs?void FS.fs.root.getFile(FS.path+e,null,function(e){e.file(function(e){var a=new FileReader;a.onloadend=function(e){t(e.target.result)},a.readAsText(e)})},function(){t(null)}):void(t&&t(null))},saveFile:function(e,t,a){return FS.fs?void FS.fs.root.getFile(FS.path+e,{create:!0,exclusive:!1},function(e){e.createWriter(function(e){e.onwriteend=function(){a&&a(!0)},e.write(new Blob([t],{type:"text/plain"}))},function(){a&&a(!1)})},function(){a&&a(!1)}):void(a&&a(!1))}},ImageLoader={config:{remoteBaseUrl:"http://ggfrupdate.nethruworks.com/",localPath:"img/",cachePath:"",remotePath:"img/",imgClass:"cached",concurrentAjax:5},_currentAjax:0,_cache:new LRUCache(20),loadAll:function(e,t){t=t||50,$("img."+ImageLoader.config.imgClass,e).each(function(){var e=$(this),a=e.attr("data-name"),n=e.attr("data-type")||"png",o=ImageLoader._loadMemoryCache(a);o?ImageLoader._display(e,n,o):$(document).queue("ImageLoader",function(){ImageLoader._load(a,e,n)}).delay(t,"ImageLoader")}),ImageLoader._next()},cancel:function(){ImageLoader.skipCancelOnce?ImageLoader.skipCancelOnce=!1:$(document).clearQueue("ImageLoader")},_load:function(e,t,a){ImageLoader._currentAjax++,ImageLoader._loadLocal(e,function(n){n?(ImageLoader._display(t,a,n),ImageLoader._saveToMemoryCache(e,n),ImageLoader._currentAjax--,ImageLoader._next()):ImageLoader._loadCache(e,function(n){n?(ImageLoader._display(t,a,n),ImageLoader._saveToMemoryCache(e,n),ImageLoader._currentAjax--,ImageLoader._next()):ImageLoader._loadRemote(e,function(n){n?(ImageLoader._display(t,a,n),ImageLoader._saveToMemoryCache(e,n),FS.saveFile(e,n),ImageLoader._currentAjax--,ImageLoader._next()):(ImageLoader._displayFail(t),ImageLoader._currentAjax--,ImageLoader._next())})})})},_next:function(){ImageLoader._currentAjax<ImageLoader.config.concurrentAjax&&$(document).dequeue("ImageLoader")},_loadMemoryCache:function(e){return ImageLoader._cache.get(e)},_saveToMemoryCache:function(e,t){ImageLoader._cache.put(e,t)},_loadLocal:function(e,t){t(null)},_loadCache:function(e,t){FS?FS.getFile(e,t):t(null)},_loadRemote:function(e,t){$.get(ImageLoader.config.remoteBaseUrl+ImageLoader.config.remotePath+e).done(function(e){t(e)}).fail(function(){t(null)})},_display:function(e,t,a){e.attr("src","data:image/"+t+";base64,"+a),e.removeClass(ImageLoader.config.imgClass)},_displayFail:function(e){e.attr("src",e.attr("data-fail"))}},Updater={config:{updateSite:"http://ggfrupdate.nethruworks.com/data/",version:"version",playStoreLink:"https://play.google.com/store/apps/details?id=hk.nethru.android.ggenfrontierguide"},checkStatus:{FAIL:-1,NO_DATA_UPDATE:0,HAVE_DATA_UPDATE:1,REQUIRE_APP_UPDATE:2},updateDataStatus:{SUCCESS:0,DLING:1,DL_FAIL:2,SAVING:3,SAVE_FAIL:4},remoteVersion:{},checkResult:null,check:function(e){Updater.checkResult?e(Updater.checkResult):Updater.getRemoteVersion(function(t){var a={};if(t){if(Updater.remoteVersion=t,Updater.requireUpdateApp())a.status=Updater.checkStatus.REQUIRE_APP_UPDATE;else{var n=Updater.compareDataVersion();n.length>0?(a.status=Updater.checkStatus.HAVE_DATA_UPDATE,a.updateList=n):a.status=Updater.checkStatus.NO_DATA_UPDATE}a.newApp=Updater.hasNewApp(),a.newAppVersionName=Updater.getNewAppVersionName()}else a.status=Updater.checkStatus.FAIL;Updater.checkResult=a,e(a)})},updateData:function(e){Updater.checkResult.status==Updater.checkStatus.HAVE_DATA_UPDATE&&(e(Updater.updateDataStatus.DLING),Updater.getUpdateData(Updater.checkResult.updateList,function(t,a){t?e(Updater.updateDataStatus.DL_FAIL):($.extend(Model.data,a.parsed),Model.data.version.data=Updater.remoteVersion.data,Model.indexData(),e(Updater.updateDataStatus.SAVING),a.raw.version=JSON.stringify(Model.data.version),DB.saveData(a.raw,function(t){t?(Updater.checkResult=null,e(Updater.updateDataStatus.SUCCESS)):e(Updater.updateDataStatus.SAVE_FAIL)}))}))},goUpdateApp:function(){navigator.app.loadUrl(Updater.config.playStoreLink,{openExternal:!0})},getRemoteVersion:function(e){$.getJSON(Updater.config.updateSite+Updater.config.version+"?"+$.now()).done(function(t){e(t)}).fail(function(){e(null)})},getNewAppVersionName:function(){return Updater.remoteVersion.appVName},hasNewApp:function(){return Updater.remoteVersion.app>Model.data.version.app},requireUpdateApp:function(){return Updater.remoteVersion.rev>Model.data.version.rev},compareDataVersion:function(){var e=[],t=Updater.remoteVersion,a=Model.data.version;return $.each(t.data,function(t,n){n>a.data[t]&&e.push(t)}),e},getUpdateData:function(e,t){var a={parsed:{},raw:{}},n=!1;$.each(e,function(o,r){$(document).queue("Updater",function(o){$.ajax({url:Updater.config.updateSite+r+Updater.remoteVersion.data[r],timeout:1e4}).done(function(e){try{a.parsed[r]=Model.parse(e,r),a.raw[r]=e}catch(t){n=!0}}).fail(function(){n=!0}).always(function(){r==e[e.length-1]&&$(document).queue("Updater",function(e){t(n,a),e()}),o()})}).delay(50,"Updater")}),$(document).dequeue("Updater")}},Filter={getFilterOptions:function(e,t){var t=$.extend({name:!0,rarity:!0,range:!0,sortBy:!0,env:!0,skill:!0,bossSp:!0,isNew:!0,skillType:!1,canSLB:!1},t),a={rarity:[],range:[],envU:[],envG:[],envW:[],skilllv:[]},n=$("#filterForm",e).serializeArray();for(var o in n){var r=n[o].name,l=n[o].value;t.name&&"name"==r&&""!=l&&(a.name=l),t.rarity&&"rarity"==r&&a.rarity.push(l),t.range&&"range"==r&&a.range.push(l),t.sortBy&&"sortBy"==r&&"none"!=l&&(a.sortBy=l),t.env&&"envU"==r&&a.envU.push(l),t.env&&"envG"==r&&a.envG.push(l),t.env&&"envW"==r&&a.envW.push(l),t.skill&&"skill"==r&&(a.skill=l),t.skill&&"skilllv"==r&&a.skilllv.push(l),t.bossSp&&"bossSp"==r&&(a.bossSp=l),t.isNew&&"isNew"==r&&(a.isNew=l),t.skillType&&"skillType"==r&&(a.skillType=l),t.canSLB&&"canSLB"==r&&(a.canSLB=l)}return t.rarity&&6!=a.rarity.length&&0!=a.rarity.length||delete a.rarity,t.range&&3!=a.range.length&&0!=a.range.length||delete a.range,t.env&&3!=a.envU.length&&0!=a.envU.length||delete a.envU,t.env&&3!=a.envG.length&&0!=a.envG.length||delete a.envG,t.env&&3!=a.envW.length&&0!=a.envW.length||delete a.envW,t.skill&&""!=a.skill||delete a.skill,t.skill&&4!=a.skilllv.length&&0!=a.skilllv.length||delete a.skilllv,t.skillType&&""!=a.skillType||delete a.skillType,a},filter:function(e,t){if(null==e)return t;var a=null;e.name&&(a=new RegExp(Filter.escapeRegExp(e.name),"i"));var n,o=function(t){var n=!0;return e.rarity&&(n=n&&e.rarity.indexOf(t.rarity.toString())>-1,!n)?!1:e.range&&(n=n&&(e.range.indexOf(t.range)>-1||t.range2&&e.range.indexOf(t.range2)>-1),!n)?!1:e.envU&&(n=n&&t.env2&&e.envU.indexOf(""+~~(t.env2/100))>-1,!n)?!1:e.envG&&(n=n&&t.env2&&e.envG.indexOf(""+~~(t.env2%100/10))>-1,!n)?!1:e.envW&&(n=n&&t.env2&&e.envW.indexOf(""+t.env2%10)>-1,!n)?!1:(e.skill&&(n=n&&e.skill==t.skill),e.skilllv&&(n=n&&e.skilllv.indexOf(t.skilllv.toString())>-1),e.skillType&&(n=n&&$.inArray(t.skill,Model.data.constants.skilltype[e.skillType].skill)>-1),e.bossSp&&(n=n&&1==t.isBoss),e.isNew&&(n=n&&1==t.isNew),e.canSLB&&(n=n&&1==t.canSLB),"cost2"==e.sortBy&&(n=n&&t.cost2>0),a&&(n=n&&((t.nameHK?t.nameHK.match(a):!1)||(t.name?t.name.match(a):!1))),n)};return n=e.sortBy?"cost"==e.sortBy||"cost2"==e.sortBy?Enumerable.From(t).Where(o).OrderBy(function(t){return t[e.sortBy]?t[e.sortBy]:-1}).ToArray():Enumerable.From(t).Where(o).OrderByDescending(function(t){return t[e.sortBy]?t[e.sortBy]:-1}).ToArray():Enumerable.From(t).Where(o).ToArray()},groupAndCache:function(e,t,a){Model.searchcache={};var n=[];if(e&&e.sortBy){for(var o=a||20,r=~~(t.length/o),l=t.length%o,i=0;r>i;i++){Model.searchcache[i]=[],n.push({id:i,name:i*o+1+"-"+(i+1)*o,count:o});for(var s=0;o>s;s++)Model.searchcache[i].push(t[i*o+s])}if(l>0){var d=t.length-l;Model.searchcache[r]=[],n.push({id:r,name:d+1+"-"+t.length,count:l});for(var s=0;l>s;s++)Model.searchcache[i].push(t[d+s])}}else{for(var c in Model.data.constants.series)Model.searchcache[c]=[];var u=function(){Model.searchcache[this.series].push(this)};$(t).each(u);for(var c in Model.data.constants.series){var p=Model.searchcache[c].length;p>0&&n.push({id:c,name:Model.data.constants.series[c],count:p})}}return n},groupAndCacheMultiple:function(e,t){Model.searchcache={},e=e||{};for(var a=e.groupSize||20,n=[],o=0,r=0;r<t.length;r++){for(var l=t[r],i=~~(l.length/a),s=l.length%a,d=[],c=0;i>c;c++){Model.searchcache[o]=[],d.push({id:o,name:c*a+1+"-"+(c+1)*a,count:a});for(var u=0;a>u;u++)Model.searchcache[o].push(l[c*a+u]);o++}if(s>0){var p=l.length-s;Model.searchcache[o]=[],d.push({id:o,name:p+1+"-"+l.length,count:s});for(var u=0;s>u;u++)Model.searchcache[o].push(l[p+u]);o++}n.push(d)}return n},escapeRegExp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}};window.i18n={applyLanguage:function(e){$(".i18n",e).each(function(){var e=$(this),t=e.attr("data-str");Model.strings[t]&&e.text(Model.strings[t])})},getText:function(e){return Model.strings[e]}},LRUCache.prototype.put=function(e,t){var a={key:e,value:t};return this._keymap[e]=a,this.tail?(this.tail.newer=a,a.older=this.tail):this.head=a,this.tail=a,this.size===this.limit?this.shift():void this.size++},LRUCache.prototype.shift=function(){var e=this.head;return e&&(this.head.newer?(this.head=this.head.newer,this.head.older=void 0):this.head=void 0,e.newer=e.older=void 0,delete this._keymap[e.key]),e},LRUCache.prototype.get=function(e,t){var a=this._keymap[e];if(void 0!==a)return a===this.tail?a.value:(a.newer&&(a===this.head&&(this.head=a.newer),a.newer.older=a.older),a.older&&(a.older.newer=a.newer),a.newer=void 0,a.older=this.tail,this.tail&&(this.tail.newer=a),this.tail=a,t?a:a.value)},LRUCache.prototype.find=function(e){return this._keymap[e]},LRUCache.prototype.set=function(e,t){var a,n=this.get(e,!0);return n?(a=n.value,n.value=t):(a=this.put(e,t),a&&(a=a.value)),a},LRUCache.prototype.remove=function(e){var t=this._keymap[e];if(t)return delete this._keymap[t.key],t.newer&&t.older?(t.older.newer=t.newer,t.newer.older=t.older):t.newer?(t.newer.older=void 0,this.head=t.newer):t.older?(t.older.newer=void 0,this.tail=t.older):this.head=this.tail=void 0,this.size--,t.value},LRUCache.prototype.removeAll=function(){this.head=this.tail=void 0,this.size=0,this._keymap={}},LRUCache.prototype.keys="function"==typeof Object.keys?function(){return Object.keys(this._keymap)}:function(){var e=[];for(var t in this._keymap)e.push(t);return e},"object"==typeof this&&(this.LRUCache=LRUCache),function(e){function t(t){e(".i18n",t).each(function(){var t=e(this),a=t.attr("data-str");Model.strings[a]&&t.text(Model.strings[a])})}e(document).bind("pageinit",jqmReady.resolve),e.cachedScript=function(t,a){return a=e.extend(a||{},{dataType:"script",cache:!0,url:t}),jQuery.ajax(a)},e.cachedScript("js/jsonh.min.js").done(jsonhReady.resolve),e.cachedScript("js/aes.min.js").done(aesReady.resolve),e.when(jqmReady).then(function(){e.mobile.loading({theme:"b",text:"Loading...",textonly:!0,textVisible:!0}),window.NTController={$menu:e("#menu"),$live:e("#live-content"),$live_pop:e("#live-pop-content"),$header:e("#live-header"),$headerText:e("#live-header h1"),$live_pop_btn_close:e("#closepop"),RenderPage:{},PageInit:{},PageReady:{},PageDestroy:{},openMenu:function(e){NTController.$menu.panel("open",e)},closeMenu:function(e){NTController.$menu.panel("close",e)},_popStack:[],openPop:function(){var t=NTController._popStack[0]?NTController._popStack[0].view:NTController.$live,a=e(window).scrollTop();return t.hide(),NTController._popStack.unshift({view:NTController.$live_pop.clone().removeAttr("id").insertBefore(NTController.$live_pop),oldScrollPos:a,oldTitle:NTController.$headerText.text()}),NTController._popStack[0].view},closeAllPop:function(t){var a=NTController._popStack.length;if(a>0){for(var n=NTController._popStack[a-1].oldTitle,o=NTController._popStack[a-1].oldScrollPos,r=0;a>r;r++)NTController._popStack.shift().view.remove();NTController.$live_pop_btn_close.hide(),NTController.$live.fadeIn(),NTController.$headerText.text(n),t&&e(window).scrollTop(o)}},closePop:function(t){var a=NTController._popStack.shift();if(a){a.view.remove();var n;0==NTController._popStack.length?(NTController.$live_pop_btn_close.hide(),n=NTController.$live):n=NTController._popStack[0].view,n.fadeIn(),NTController.$headerText.text(a.oldTitle),t&&e(window).scrollTop(a.oldScrollPos),ImageLoader.cancel(),ImageLoader.loadAll(n)}},hasPop:function(){return NTController._popStack.length>0},go:function(t,a,n,o){if(t){setTimeout(function(){NTController.$menu.panel("close")},e.mobile.buttonMarkup.hoverDelay);var r=NTController._popStack[0]?NTController._popStack[0].view:NTController.$live,l=e(a,r).eq(0),i=l.length>0?l:NTController.$live;n?i=NTController.openPop():o||NTController.closeAllPop();var s=i.attr("data-current");if(s==t)return;var d=i.attr("data-current-page"),c=t.split("?"),u=c[0],p=e("[data-role='content']",u);if(p.size()>0){var h=c[1];if(h){var g=h.split("&");h={};for(var f in g){var m=g[f].split("=");h[m[0]]=m[1]}}i.hide().attr("data-current",t).attr("data-current-page",u),setTimeout(function(){ImageLoader.cancel(),e.isFunction(NTController.PageDestroy[d])&&NTController.PageDestroy[d](i);var t=p.html();e.isFunction(NTController.RenderPage[u])&&(t=NTController.RenderPage[u](t,h)),i.html(t),n&&NTController.$live_pop_btn_close.show();var a=p.attr("data-title");p.attr("data-i18n")&&(a=i18n.getText(a)),a&&NTController.$headerText.text(a),e.isFunction(NTController.PageInit[u])&&NTController.PageInit[u](i,h),i18n.applyLanguage(i),i.trigger("create"),i.fadeIn("normal",function(){e.isFunction(NTController.PageReady[u])&&NTController.PageReady[u](i,h)}).trigger("refresh")},150)}}}},e(document).on("click",".clink",function(t){t.preventDefault();var a=e(this),n=a.attr("target"),o=a.hasClass("keeppop");NTController.go(a.attr("href"),n,!1,o)}),e(document).on("click",".plink",function(t){t.preventDefault();var a=e(this);NTController.go(a.attr("href"),null,!0)}),e(document).on("click","#closepop",function(e){e.preventDefault(),NTController.closePop(!0)}),e(document).on("tap",".external-link",function(t){t.preventDefault();var a=e(this).attr("rel");return navigator.app.loadUrl(a,{openExternal:!0}),!1}),NTController.$menu.panel({beforeclose:function(){NTController.menuOpened=!1},beforeopen:function(){NTController.menuOpened=!0}})}),("Win32"==navigator.platform||"Linux x86_64"==navigator.platform)&&pgReady.resolve(),e.when(jqmReady,pgReady,aesReady,jsonhReady).then(function(){navigator.globalization?navigator.globalization.getPreferredLanguage(function(e){Model.settings.lang||(Model.settings.lang=e.value&&e.value.indexOf("ja")>-1?"jp":"hk")},function(){Model.settings.lang||(Model.settings.lang="hk")}):Model.settings.lang||(Model.settings.lang="hk"),FS.initCache(),DB.init(function(){DB.getSettings(function(a){Model.settings=e.extend(a||{},Model.settings),e.getJSON("lang/"+Model.settings.lang+".txt",function(e){Model.strings=e}).fail(function(){}).always(function(){t("#menu"),appInited.resolve()})}),DB.getVersion(function(t){Model.data.version=e.isEmptyObject(t)?{rev:4,app:12,appVName:"1.3.5",data:{constants:0,mslist:0,charlist:0,warshiplist:0,design:0,msGetFrom:0,charGetFrom:0,warshipGetFrom:0,msdev:0,warshipdev:0,questlist:0}}:t,Model.isAllDataLoaded()&&dataReady.resolve()}),DB.getMSList(function(e){Model.data.mslist=e,Model.isAllDataLoaded()&&dataReady.resolve()}),DB.getCharList(function(e){Model.data.charlist=e,Model.isAllDataLoaded()&&dataReady.resolve()}),DB.getWarshipList(function(e){Model.data.warshiplist=e,Model.isAllDataLoaded()&&dataReady.resolve()}),DB.getConstants(function(e){Model.data.constants=e,Model.isAllDataLoaded()&&dataReady.resolve()}),DB.getDesign(function(e){Model.data.design=e,Model.isAllDataLoaded()&&dataReady.resolve()}),DB.getMSGetFrom(function(e){Model.data.msGetFrom=e,Model.isAllDataLoaded()&&dataReady.resolve()}),DB.getCharGetFrom(function(e){Model.data.charGetFrom=e,Model.isAllDataLoaded()&&dataReady.resolve()}),DB.getWarshipGetFrom(function(e){Model.data.warshipGetFrom=e,Model.isAllDataLoaded()&&dataReady.resolve()}),DB.getMSDev(function(e){Model.data.msdev=e,Model.isAllDataLoaded()&&dataReady.resolve()}),DB.getWarshipDev(function(e){Model.data.warshipdev=e,Model.isAllDataLoaded()&&dataReady.resolve()}),DB.getQuest(function(e){Model.data.questlist=e,Model.isAllDataLoaded()&&dataReady.resolve()}),DB.getSLB(function(e){Model.data.slb=e,Model.isAllDataLoaded()&&dataReady.resolve()})}),e(document).on("backbutton",function(){NTController.hasPop()?NTController.closePop(!0):NTController.menuOpened?e("#btnExit").click():NTController.openMenu()}),e(document).on("click","#btnExit",function(e){e.preventDefault(),confirm(i18n.getText("menu_exit")+"?")&&navigator.app.exitApp()})}),e.when(appInited,dataReady).then(function(){Model.indexData(),console.log("app inited"),NTController.$menu.show(),setTimeout(function(){NTController.go("#home")},500)})}(jQuery);
$.when(jqmReady).then(function(){NTController.PageInit["#home"]=function(){$("."+Model.settings.lang+"_only").show()},NTController.PageReady["#home"]=function(a){Updater.check(function(t){var_dump(t),(t.newApp||t.status==Updater.checkStatus.REQUIRE_APP_UPDATE)&&$("#btnUpdateApp",a).click(function(a){a.preventDefault(),Updater.goUpdateApp()}).parent().show(),t.status==Updater.checkStatus.HAVE_DATA_UPDATE?$("#btnUpdateData",a).click(function(t){t.preventDefault(),console.log("updateData"),$("#label_save_fail",a).hide(),$("#label_fail",a).hide(),Updater.updateData(function(t){t==Updater.updateDataStatus.DLING?(console.log("update dling"),$("#btnUpdateData",a).hide(),$("#span_updating",a).show(),$("#label_dling",a).show()):t==Updater.updateDataStatus.DL_FAIL?(console.log("update dl fail"),$("#btnUpdateData",a).show(),$("#span_updating",a).hide(),$("#label_fail",a).show()):t==Updater.updateDataStatus.SAVING?(console.log("update saving"),$("#label_dling",a).hide(),$("#label_saving",a).show()):t==Updater.updateDataStatus.SAVE_FAIL?(console.log("update success"),$("#span_updating",a).hide(),$("#label_save_fail",a).show()):t==Updater.updateDataStatus.SUCCESS&&(console.log("update success"),$("#span_updating",a).hide(),$("#label_success",a).show())})}).parent().show():t.status==Updater.checkStatus.NO_DATA_UPDATE||t.status==Updater.checkStatus.FAIL})}});
$.when(jqmReady).then(function(){function e(e,t){var i=t?null:Filter.getFilterOptions(e,{skill:!1,canSLB:!0}),l=Filter.filter(i,Model.data.mslist),n=Filter.groupAndCache(i,l);$(".list_container",e).html(Template.renderList("#tmpl-list-group",n)),$.mobile.loading("hide"),$(window).scrollTop(0)}function t(e){$('.list_container [data-role="collapsible"]',e).on("collapsibleexpand",function(){var e=$(this);if(!e.attr("data-rendered")){$.mobile.loading("show");var t=e.attr("data-id"),i=e.find("#list"+t);setTimeout(function(){e.attr("data-rendered",!0),i.html(Template.renderList("#tmpl-mslist-item",Model.searchcache[t],"ms")).listview("refresh"),$.mobile.loading("hide"),$(document).clearQueue().delay(500).queue(function(){ImageLoader.loadAll(i),$(this).dequeue()})},150)}})}NTController.PageInit["#mslist"]=function(i){e(i,!0),t(i),$("#btnFilter",i).on("click",function(l){l.preventDefault(),l.stopPropagation(),$.mobile.loading("show"),setTimeout(function(){e(i),$(".list_container",i).trigger("create"),t(i),$("#filter-collapsible",i).collapsible("option","collapsed",!0)},50)}),$("#filterForm",i).on("submit",function(e){return e.preventDefault(),$("#btnFilter",i).click(),!1})}});
!function(t){t.when(jqmReady).then(function(){function l(l,e){var i=e?null:Filter.getFilterOptions(l,{range:!1,env:!1,bossSp:!1,skillType:!0,canSLB:!0}),n=Filter.filter(i,Model.data.charlist),a=Filter.groupAndCache(i,n);t(".list_container",l).html(Template.renderList("#tmpl-list-group",a)),t.mobile.loading("hide"),t(window).scrollTop(0)}function e(l){t('.list_container [data-role="collapsible"]',l).on("collapsibleexpand",function(){var l=t(this);if(!l.attr("data-rendered")){t.mobile.loading("show");var e=l.attr("data-id"),i=l.find("#list"+e);setTimeout(function(){l.attr("data-rendered",!0),i.html(Template.renderList("#tmpl-charlist-item",Model.searchcache[e],"char")).listview("refresh"),i18n.applyLanguage(i),t.mobile.loading("hide"),setTimeout(function(){ImageLoader.loadAll(i)},500)},150)}})}NTController.PageInit["#charlist"]=function(i){var n=[];for(var a in Model.data.constants.skill){var o=Model.data.constants.skill[a];o.id=a,n.push(o)}t("#options_skill",i).append(Template.renderList("#tmpl-filter-skill-item",n,"skill"));var r=[];for(var a in Model.data.constants.skilltype){var s=Model.data.constants.skilltype[a];s.id=a,r.push(s)}t("#options_skilltype",i).append(Template.renderList("#tmpl-filter-skilltype-item",r,"skilltype")),l(i,!0),e(i),t("#btnFilter",i).on("click",function(n){n.preventDefault(),n.stopPropagation(),t.mobile.loading("show"),setTimeout(function(){l(i),t(".list_container",i).trigger("create"),e(i),t("#filter-collapsible",i).collapsible("option","collapsed",!0)},50)}),t("#filterForm",i).on("submit",function(l){return l.preventDefault(),t("#btnFilter",i).click(),!1}),t("#options_skilltype",i).on("change",function(){""!=t(this).val()&&t("#options_skill",i).val("").change()}),t("#options_skill",i).on("change",function(){""!=t(this).val()&&t("#options_skilltype",i).val("").change()})}})}(jQuery);
!function(e){e.when(jqmReady).then(function(){function t(t,i){var l=i?null:Filter.getFilterOptions(t,{skill:!1,bossSp:!1}),n=Filter.filter(l,Model.data.warshiplist),o=Filter.groupAndCache(l,n);e(".list_container",t).html(Template.renderList("#tmpl-list-group",o)),e.mobile.loading("hide"),e(window).scrollTop(0)}function i(t){e('.list_container [data-role="collapsible"]',t).on("collapsibleexpand",function(){var t=e(this);if(!t.attr("data-rendered")){e.mobile.loading("show");var i=t.attr("data-id"),l=t.find("#list"+i);setTimeout(function(){t.attr("data-rendered",!0),l.html(Template.renderList("#tmpl-warshiplist-item",Model.searchcache[i],"warship")).listview("refresh"),e.mobile.loading("hide"),e(document).clearQueue().delay(500).queue(function(){ImageLoader.loadAll(l),e(this).dequeue()})},150)}})}NTController.PageInit["#warshiplist"]=function(l){t(l,!0),i(l),e("#btnFilter",l).on("click",function(n){n.preventDefault(),n.stopPropagation(),e.mobile.loading("show"),setTimeout(function(){t(l),e(".list_container",l).trigger("create"),i(l),e("#filter-collapsible",l).collapsible("option","collapsed",!0)},50)}),e("#filterForm",l).on("submit",function(t){return t.preventDefault(),e("#btnFilter",l).click(),!1})}})}(jQuery);
$.when(jqmReady).then(function(){function e(e){$('.list_container [data-role="collapsible"]',e).on("collapsibleexpand",function(){var e=$(this);if(!e.attr("data-rendered")){$.mobile.loading("show");var t=e.attr("data-id"),d=e.find("#list"+t);setTimeout(function(){e.attr("data-rendered",!0),d.html(Template.renderList("#tmpl-designlist-item",Model.searchcache[t])).listview("refresh"),$.mobile.loading("hide"),i18n.applyLanguage(e),$(document).clearQueue().delay(500).queue(function(){ImageLoader.loadAll(d),$(this).dequeue()})},150)}})}NTController.PageInit["#designlist"]=function(t){for(var d=[],i=[],l=[],a=[],o=0,n=Model.data.design.length;n>o;o++){var r={},s=Model.data.design[o];r.result=Model.data.mslist[Model.idx.msByCodeVariant[s.toCode+s.toVariant]],r.m1=s.v1?[Model.idx.msByCodeVariant[s.code1+s.v1]]:Model.idx.msByCode[s.code1],r.m2=s.v2?[Model.idx.msByCodeVariant[s.code2+s.v2]]:Model.idx.msByCode[s.code2],r.m1Code=s.code1,r.m2Code=s.code2,r.m1V=s.v1||"",r.m2V=s.v2||"",r.m1lv=s.lv1||1,r.m2lv=s.lv2||1,r.expire="y"==s.expire,r.expire?a.push(r):""==r.m1V?l.push(r):i.push(r)}d[0]=i,d[1]=l,d[2]=a;var m=Filter.groupAndCacheMultiple({groupSize:10},d);$(".special_design",t).html(Template.renderList("#tmpl-list-group",m[0])),$(".normal_design",t).html(Template.renderList("#tmpl-list-group",m[1])),$(".inactive_design",t).html(Template.renderList("#tmpl-list-group",m[2])),e(t)}});
$.when(jqmReady).then(function(){function e(e){var t=Model.data.questlist,i=Filter.groupAndCache(null,t);$(".list_container",e).html(Template.renderList("#tmpl-list-group",i)),$.mobile.loading("hide")}function t(e){$('.list_container [data-role="collapsible"]',e).on("collapsibleexpand",function(){var e=$(this);if(!e.attr("data-rendered")){$.mobile.loading("show");var t=e.attr("data-id"),i=e.find("#list"+t);setTimeout(function(){e.attr("data-rendered",!0),i.html(Template.renderList("#tmpl-questlist-item",Model.searchcache[t],"quest")).listview("refresh"),$.mobile.loading("hide"),$(document).clearQueue().delay(500).queue(function(){ImageLoader.loadAll(i),$(this).dequeue()})},150)}})}NTController.PageInit["#questlist"]=function(i){e(i,!0),t(i)}});
var isGoogleFormSubmitted=!1;window.googleFormReady=function(){isGoogleFormSubmitted&&($.mobile.loading("show",{theme:"b",text:i18n.getText("feedback_thanks"),textonly:!0,textVisible:!0,html:'<h1><i class="icon-ok"></i> '+i18n.getText("feedback_thanks")+"</h1>"}),setTimeout('$.mobile.loading("hide")',5e3)),isGoogleFormSubmitted=!1};
!function(e){e.when(jqmReady).then(function(){NTController.PageInit["#feedback"]=function(t){e("#feedbackForm",t).submit(function(){var t=e(this),r=!1;return e(".error",t).remove(),e("input.required, select.required, textarea.required",t).each(function(){var t=e(this);(""==t.val()||t.val()==t.find('[data-placeholder="true"]').val())&&(t.parents("li").append('<div class="error">'+i18n.getText("error_required")+"</div>"),r=!0)}),r?!1:(isGoogleFormSubmitted=!0,!0)}),e(".spacer").css({display:"none",height:e.mobile.getScreenHeight()/2}),e("input, textarea",t).on("focus",function(){$this=e(this),e(".spacer",t).show(),setTimeout(function(){e("html, body").animate({scrollTop:$this.offset().top-NTController.$header.height()-$this.closest("li").height()},0)},400)}).on("blur",function(){e(".spacer",t).hide()})}})}(jQuery);
$.when(jqmReady).then(function(){NTController.PageInit["#msdetail"]=function(e,a){function t(e){return e.code==n}a=a||{code:"0001",variant:"01"};var n=a.code,i=(a.variant,$.grep(Model.data.mslist,t));Model.detailcache=i;var l=$(".navbar-list",e);l.html(i.length>0?Template.renderList("#tmpl-msdetail-navbar-item",i):"<li></li>"),setTimeout(function(){ImageLoader.loadAll(l)},300)},NTController.PageReady["#msdetail"]=function(e,a){a=a||{code:"0001",variant:"01"},ImageLoader.skipCancelOnce=!0,$("#navbaritem"+a.code+a.variant,e).click()}});
$.when(jqmReady).then(function(){NTController.PageInit["#msdata"]=function(e,t){var d=t.code,o=t.variant,a=$.grep(Model.detailcache,function(e){return e.code==d&&e.variant==o});0==a.length&&(a=[Model.data.mslist[Model.idx.msByCodeVariant[d+o]]]),$(".simpleData",e).html(Template.renderHtml($("#tmpl-msdata").html(),{ms:a[0]}));var l=a[0].ability;if(""==l)$(".abilityList",e).append("<li>?</li>");else if("-"==l)$(".abilityList",e).append("<li>-</li>");else{var i=l.split(";");l=[];for(var m=0,r=i.length;r>m;m++)l.push({id:i[m]});$(".abilityList",e).append(Template.renderList("#tmpl-msdata-ability-item",l))}var n=$(".getFromTitle",e).hide(),v=$.grep(Model.data.design,function(e){return e.toCode==d&&e.toVariant==o});if(v.length>0){n.show();for(var s=[],m=0,r=v.length;r>m;m++){var p={},c=v[m];p.m1=c.v1?[Model.idx.msByCodeVariant[c.code1+c.v1]]:Model.idx.msByCode[c.code1],p.m2=c.v2?[Model.idx.msByCodeVariant[c.code2+c.v2]]:Model.idx.msByCode[c.code2],p.m1Code=c.code1,p.m2Code=c.code2,p.m1V=c.v1||"",p.m2V=c.v2||"",p.m1lv=c.lv1||1,p.m2lv=c.lv2||1,p.expire="y"==c.expire,s.push(p)}$(".getByDesign",e).html(Template.renderList("#tmpl-msdata-getfrom-design-item",s))}var g=$.grep(Model.data.msdev,function(e){return e.tc==d&&e.tv==o&&Model.idx.msByCodeVariant[e.fc+e.fv]});g.length>0&&(n.show(),$(".getFromDev",e).html(Template.renderList("#tmpl-msdata-getfrom-dev-item",g)));var h=$.grep(Model.data.msGetFrom,function(e){return e.c==d&&e.v==o});if(h.length>0&&(n.show(),$(".getFrom",e).html(Template.renderList("#tmpl-getfrom-item",h))),v=$.grep(Model.data.design,function(e){return!e.v1&&e.code1==d||e.v1&&e.code1==d&&e.v1==o||!e.v2&&e.code2==d||e.v2&&e.code2==d&&e.v2==o}),v.length>0){for(var s=[],m=0,r=v.length;r>m;m++){var p={},c=v[m];p.result=Model.data.mslist[Model.idx.msByCodeVariant[c.toCode+c.toVariant]],c.v1?(p.m1V=d==c.code1&&o==c.v1?c.v2||"":c.v1||"",p.m1lv=d==c.code1&&o==c.v1?c.lv2||1:c.lv1||1,p.m1Code=d==c.code1&&o==c.v1?c.code2:c.code1,p.m0lv=d==c.code1&&o==c.v1?c.lv1||1:c.lv2||1):(p.m1V=d==c.code1?c.v2||"":c.v1||"",p.m1lv=d==c.code1?c.lv2||1:c.lv1||1,p.m1Code=d==c.code1?c.code2:c.code1,p.m0lv=d==c.code1?c.lv1||1:c.lv2||1),p.m1=p.m1V?[Model.idx.msByCodeVariant[p.m1Code+p.m1V]]:Model.idx.msByCode[p.m1Code],p.expire="y"==c.expire,s.push(p)}$(".useInDesign",e).append(Template.renderList("#tmpl-msdata-useindesign-item",s)).show()}var f=$.grep(Model.data.msdev,function(e){return e.fc==d&&e.fv==o&&Model.idx.msByCodeVariant[e.tc+e.tv]});f.length>0&&$(".developTo",e).append(Template.renderList("#tmpl-msdata-devto-item",f)).show();var u=$.grep(Model.data.slb,function(e){return 3==e.t&&e.c==d&&e.v==o});u.length>0&&$(".slb",e).append(Template.renderList("#tmpl-msdata-slb-item",u[0].m)).show(),ImageLoader.loadAll(e)}});
$.when(jqmReady).then(function(){NTController.PageInit["#chardetail"]=function(a,e){function t(a){return a.code==n}e=e||{code:"0001",variant:"02"};var n=e.code,i=(e.variant,$.grep(Model.data.charlist,t));Model.detailcache=i;var r=$(".navbar-list",a);r.html(i.length>0?Template.renderList("#tmpl-chardetail-navbar-item",i):"<li></li>"),setTimeout(function(){ImageLoader.loadAll(r)},300)},NTController.PageReady["#chardetail"]=function(a,e){e=e||{code:"0001",variant:"02"},ImageLoader.skipCancelOnce=!0,$("#navbaritem"+e.code+e.variant,a).click()}});
$.when(jqmReady).then(function(){NTController.PageInit["#chardata"]=function(e,t){var a=t.code,r=t.variant,l=$.grep(Model.detailcache,function(e){return e.code==a&&e.variant==r});$(".simpleData",e).html(Template.renderHtml($("#tmpl-chardata").html(),{"char":l[0]}));var n=$(".getFromTitle",e).hide(),m=$.grep(Model.data.charGetFrom,function(e){return e.c==a&&e.v==r});m.length>0&&(n.show(),$(".getFrom",e).html(Template.renderList("#tmpl-getfrom-item",m)));var o=$.grep(Model.data.slb,function(e){return 4==e.t&&e.c==a&&e.v==r});o.length>0&&$(".slb",e).append(Template.renderList("#tmpl-chardata-slb-item",o[0].m)).show(),ImageLoader.loadAll(e)}});
$.when(jqmReady).then(function(){NTController.PageInit["#warshipdetail"]=function(a,e){function t(a){return a.code==i}e=e||{code:"0001",variant:"01"};var i=e.code,n=(e.variant,$.grep(Model.data.warshiplist,t));Model.detailcache=n;var r=$(".navbar-list",a);r.html(n.length>0?Template.renderList("#tmpl-warshipdetail-navbar-item",n):"<li></li>"),setTimeout(function(){ImageLoader.loadAll(r)},300)},NTController.PageReady["#warshipdetail"]=function(a,e){e=e||{code:"0001",variant:"01"},ImageLoader.skipCancelOnce=!0,$("#navbaritem"+e.code+e.variant,a).click()}});
$.when(jqmReady).then(function(){NTController.PageInit["#warshipdata"]=function(e,t){var a=t.code,i=t.variant,r=$.grep(Model.detailcache,function(e){return e.code==a&&e.variant==i});0==r.length&&(r=[Model.data.warshiplist[Model.idx.warshipByCodeVariant[a+i]]]),$(".simpleData",e).html(Template.renderHtml($("#tmpl-warshipdata").html(),{warship:r[0]}));var l=r[0].ability;if(l)if("-"==l)$(".abilityList",e).append("<li>-</li>");else{var d=l.split(";");l=[];for(var n=0,p=d.length;p>n;n++)l.push({id:d[n]});$(".abilityList",e).append(Template.renderList("#tmpl-warshipdata-ability-item",l))}else $(".abilityList",e).append("<li>?</li>");var o=$(".getFromTitle",e).hide(),h=$.grep(Model.data.warshipdev,function(e){return e.tc==a&&e.tv==i&&Model.idx.warshipByCodeVariant[e.fc+e.fv]});h.length>0&&(o.show(),$(".getFromDev",e).html(Template.renderList("#tmpl-warshipdata-getfrom-dev-item",h)));var s=$.grep(Model.data.warshipGetFrom,function(e){return e.c==a&&e.v==i});s.length>0&&(o.show(),$(".getFrom",e).html(Template.renderList("#tmpl-getfrom-item",s)));var m=$.grep(Model.data.warshipdev,function(e){return e.fc==a&&e.fv==i&&Model.idx.warshipByCodeVariant[e.tc+e.tv]});m.length>0&&(o.show(),$(".developTo",e).append(Template.renderList("#tmpl-warshipdata-devto-item",m)).show()),ImageLoader.loadAll(e)}});
$.when(jqmReady).then(function(){NTController.PageInit["#questdetail"]=function(e,a){function t(e){return 1==e.t&&e.v1==a.series&&e.v2==a.number}a=a||{series:"1",number:"1"};for(var r=$.grep(Model.data.msGetFrom,t),d=[],i=0,l=r.length;l>i;i++){var o=r[i],s=Model.idx.msByCodeVariant[o.c+""+o.v];void 0!=s&&d.push(Model.data.mslist[s])}for(var n=$.grep(Model.data.charGetFrom,t),p=[],i=0,l=n.length;l>i;i++){var o=n[i],s=Model.idx.charByCodeVariant[o.c+""+o.v];void 0!=s&&p.push(Model.data.charlist[s])}for(var m=$.grep(Model.data.warshipGetFrom,t),h=[],i=0,l=m.length;l>i;i++){var o=m[i],s=Model.idx.warshipByCodeVariant[o.c+""+o.v];void 0!=s&&h.push(Model.data.warshiplist[s])}$("#list",e).append(Template.renderList("#tmpl-mslist-item",d,"ms")).append(Template.renderList("#tmpl-charlist-item",p,"char")).append(Template.renderList("#tmpl-warshiplist-item",h,"warship")),$(document).clearQueue().delay(500).queue(function(){ImageLoader.loadAll($("#list",e)),$(this).dequeue()})}});




