





/*7fc1e0bcc5cf48978fd01b4474d876b2ca228911*/Ext.define("Judge.controller.ArticlesController",{extend:"Ext.app.Controller",config:{refs:{listViewContainer:"#ArticlesView",listView:"#articlesList",xtype:"articles",autoCreate:true}},loadData:function(){var b=this;var a=b.getListView().getStore();a.setProxy({type:"ajax",url:"http://evestnik.by/fav_list.html",extraParams:{user_id:b.getApplication().getController("MagazineContainerController").loggedIn},reader:{type:"json",rootProperty:"data"}});a.load({callback:function(d,c,e){a.remove(a.last())},params:{ignoreload:true}})},onItemTap:function(f,d,e,b,g){var h=this.getListViewContainer();var i=b.get("id");var a=h.getAt(1);var c=this.getApplication().getController("MagazineContainerController").loggedIn;Ext.Ajax.request({url:"http://evestnik.by/show.html",method:"GET",params:{article_id:i,user_id:c},success:function(p){var l=JSON.parse(p.responseText);var q=l.title;var k;var r=l.content.split("</p>");if(r.length>paraCount){var o=[];var m=0;while(m<=r.length){var n=r.slice(m,m+paraCount).join("</p>");var j=m+paraCount<r.length?n+"</p>":n+'<div class="sw social"><span class="fb"  href="http://www.facebook.com/sharer.php?u=http://www.evestnik.by&t='+q+'"></span><span class="vk social"  href="http://vkontakte.ru/share.php?url=http://www.evestnik.by&title='+q+'"></span><span class="tw social"  href="https://twitter.com/share?url=http://www.evestnik.by&text='+q+'"></span></div>';o.push(j);m=m+paraCount}function s(){return Ext.create("Ext.TitleBar",{cls:"magazineArticleEntryBar",ui:"light",magazineArticleEntryBar:true,inline:true,layout:{pack:"center"},items:[{iconMask:true,iconCls:"arrow_left",text:"назад",align:"left",flex:1,cls:"favPrevPageBtn",hidden:true,listeners:{tap:function(){var t=Ext.getCmp("currentFavContent");if(t.config.currentind>0){t.setHtml(o[--t.config.currentind]);t.lastAction="prev";Ext.getCmp("articlesEntry").getScrollable().getScroller().scrollTo(0,t.element.getHeight());Ext.each(Ext.ComponentQuery.query("button[cls=favNextPageBtn]"),function(v,u,w){v.show()})}if(t.config.currentind==0){Ext.each(Ext.ComponentQuery.query("button[cls=favPrevPageBtn]"),function(v,u,w){v.hide()})}}}},{xtype:"spacer",flex:5},{iconMask:true,iconCls:"arrow_right",align:"right",flex:1,text:"читать дальше",cls:"favNextPageBtn",listeners:{tap:function(){var t=Ext.getCmp("currentFavContent");if(t.config.currentind<o.length-1){t.setHtml(o[++t.config.currentind]);t.lastAction="next";Ext.getCmp("articlesEntry").getScrollable().getScroller().scrollTo(0,0);Ext.each(Ext.ComponentQuery.query("button[cls=favPrevPageBtn]"),function(v,u,w){v.show()})}if(t.config.currentind>=o.length-1){Ext.each(Ext.ComponentQuery.query("button[cls=favNextPageBtn]"),function(v,u,w){v.hide()})}}}}]})}k=Ext.create("Ext.Container",{layout:"vbox",cls:"articlesEntry",id:"articlesEntry",scrollable:{direction:"vertical",directionLock:true,fps:25},items:[{id:"currentFavContent",currentind:0,html:o[0]},s()],listeners:{tap:{element:"element",delegate:"a.social",fn:function(t){window.open(t.target.attributes.href.value,"_system","location=yes")}}}})}else{k=Ext.create("Ext.Container",{cls:"articlesEntry",id:"articlesEntry",scrollable:{direction:"vertical",directionLock:true,fps:25},listeners:{tap:{element:"element",delegate:"a.social",fn:function(t){window.open(t.target.attributes.href.value,"_system","location=yes")}}},html:l.content+'<div class="sw"><span class="fb social"   href="http://www.facebook.com/sharer.php?u=http://www.evestnik.by&t='+q+'"></span><span class="vk social" href="http://vkontakte.ru/share.php?url=http://www.evestnik.by&title='+q+'"></span><span class="tw social"  href="https://twitter.com/share?url=http://www.evestnik.by&text='+q+'"></span></div>'})}a.removeAll(true,false);a.add(k);a.setActiveItem(k);h.setActiveItem(a);Ext.getCmp("RemoveFromFavorites").articleId=i},failure:function(){Ext.Msg.alert("Информация","Произошла ошибка загрузки данных. Повторите попытку позже.")}})},addFavorite:function(b,d){var c=this;var a=c.getApplication().getController("MagazineContainerController").loggedIn;if(a>0){Ext.Ajax.request({url:"http://evestnik.by/fav_add.html",method:"GET",params:{user_id:a,article_id:b},success:function(f){if(f.responseText=="1"){Ext.Msg.alert("Информация",'Статья успешно добавлена в "Закладки"');var e=c.getListView().getStore();e.add([{id:b,title:d}])}},failure:function(){Ext.Msg.alert("Информация",'Произошла ошибка при добавлении статьи в "Закладки". Повторите попытку позже.')}})}else{Ext.Msg.alert("Информация","Вы не зарегистрированы.")}},removeFavorite:function(a){var b=this;Ext.Ajax.request({url:"http://evestnik.by/fav_del.html",method:"GET",params:{user_id:b.getApplication().getController("MagazineContainerController").loggedIn,article_id:a},success:function(d){if(d.responseText=="1"){Ext.Msg.alert("Информация",'Статья успешно удалена из "Закладок"');var c=b.getListView().getStore();c.remove(c.findRecord("id",a));return}Ext.Msg.alert("Информация",'Произошла ошибка при удалении статьи из "Закладок"')},failure:function(){Ext.Msg.alert("Информация",'Произошла ошибка при удалении статьи из "Закладок". Повторите попытку позже.')}})}});Ext.define("Judge.controller.SearchController",{extend:"Ext.app.Controller",config:{refs:{listViewContainer:"#SearchView",listView:"#searchList",detailsView:"#searchDetails",searchField:"#searchField"}},loadData:function(){var b=this;var a=b.getListView().getStore();a.setProxy({type:"ajax",url:"http://evestnik.by/search_list.html",extraParams:{query:b.getSearchField().getValue()},reader:{type:"json"}});a.load({callback:function(d,c,e){var f=a.last();if(f&&!f.get("magazine")){a.remove(f)}}})},onItemTap:function(f,b,g,a,d){var h=this.getListViewContainer();var e=a.get("id");var c=this.getApplication().getController("MagazineContainerController").loggedIn;Ext.Ajax.request({url:"http://evestnik.by/show.html",method:"GET",params:{article_id:e,user_id:c,},success:function(o){var k=JSON.parse(o.responseText);var q=k.title;var p=h.getAt(1);var j;var r=k.content.split("</p>");if(r.length>paraCount){var n=[];var m=0;while(m<=r.length){var l=r.slice(m,m+paraCount).join("</p>");var i=m+paraCount<r.length?l+"</p>":l+'<div class="sw"><span class="fb social"  href="http://www.facebook.com/sharer.php?u=http://www.evestnik.by&t='+q+'"></span><span class="vk social"  href="http://vkontakte.ru/share.php?url=http://www.evestnik.by&title='+q+'"></span><span class="tw social"   href="https://twitter.com/share?url=http://www.evestnik.by&text='+q+'"></span></div>';n.push(i);m=m+paraCount}function s(){return Ext.create("Ext.TitleBar",{cls:"magazineArticleEntryBar",ui:"light",magazineArticleEntryBar:true,inline:true,layout:{pack:"center"},items:[{iconMask:true,iconCls:"arrow_left",align:"left",flex:1,text:"назад",cls:"searchPrevPageBtn",hidden:true,listeners:{tap:function(){var t=Ext.getCmp("currentSearchContent");if(t.config.currentind>0){t.setHtml(n[--t.config.currentind]);t.lastAction="prev";Ext.getCmp("searchEntry").getScrollable().getScroller().scrollTo(0,t.element.getHeight());Ext.each(Ext.ComponentQuery.query("button[cls=searchNextPageBtn]"),function(v,u,w){v.show()})}if(t.config.currentind==0){Ext.each(Ext.ComponentQuery.query("button[cls=searchPrevPageBtn]"),function(v,u,w){v.hide()})}}}},{xtype:"spacer",flex:5},{iconMask:true,iconCls:"arrow_right",align:"right",flex:1,text:"читать дальше",cls:"searchNextPageBtn",listeners:{tap:function(){var t=Ext.getCmp("currentSearchContent");if(t.config.currentind<n.length-1){t.setHtml(n[++t.config.currentind]);t.lastAction="next";Ext.getCmp("searchEntry").getScrollable().getScroller().scrollTo(0,0);Ext.each(Ext.ComponentQuery.query("button[cls=searchPrevPageBtn]"),function(v,u,w){v.show()})}if(t.config.currentind>=n.length-1){Ext.each(Ext.ComponentQuery.query("button[cls=searchNextPageBtn]"),function(v,u,w){v.hide()})}}}}]})}j=Ext.create("Ext.Container",{layout:"vbox",cls:"searchEntry",id:"searchEntry",scrollable:{direction:"vertical",directionLock:true,fps:25},items:[{id:"currentSearchContent",currentind:0,html:n[0]},s()],listeners:{tap:{element:"element",delegate:"a.social",fn:function(t){window.open(t.target.attributes.href.value,"_system","location=yes")}}},})}else{j=Ext.create("Ext.Container",{cls:"searchEntry",id:"searchEntry",scrollable:{direction:"vertical",directionLock:true,fps:25},listeners:{tap:{element:"element",delegate:"a.social",fn:function(t){window.open(t.target.attributes.href.value,"_system","location=yes")}}},html:k.content+'<div class="sw"><span class="fb social" href="http://www.facebook.com/sharer.php?u=http://www.evestnik.by&t='+q+'"></span><span class="vk social"   href="http://vkontakte.ru/share.php?url=http://www.evestnik.by&title='+q+'"></span><span class="tw social"  href="https://twitter.com/share?url=http://www.evestnik.by&text='+q+'"></span></div>'})}p.removeAll(true,false);p.add(j);p.setActiveItem(j);h.setActiveItem(p)},failure:function(){Ext.Msg.alert("Информация","Произошла ошибка загрузки данных. Повторите попытку позже.")}})}});Ext.define("Judge.view.Articles",{id:"ArticlesView",extend:"Ext.dataview.List",xtype:"articles",initialize:function(){this.callParent();var a=Judge.app.getController("ArticlesController");a.loadData()},config:{layout:"card",title:"Закладки",iconCls:"star",items:[{xtype:"list",id:"articlesList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><h4>{title}</h4><small>{description}</small></div>',{disableFormats:true}),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,listeners:{itemtap:function(e,b,f,a,c){var d=Judge.app.getController("ArticlesController");d.onItemTap(e,b,f,a,c)}},store:{model:"Judge.model.ListItemModel",autoLoad:false}},{xtype:"container",id:"articlesDetails",layout:"card",items:[{xtype:"titlebar",docked:"top",title:"Закладки",ui:"light",inline:true,items:[{text:"К списку..",align:"left",listeners:{tap:function(){Ext.getCmp("ArticlesView").setActiveItem(0);var a=Ext.getCmp("articlesEntry");a.suspendEvents();a.removeAll(true,true);a.destroy()}}},{iconMask:true,iconCls:"trash",align:"right",id:"RemoveFromFavorites",listeners:{tap:function(){Judge.app.getController("ArticlesController").removeFavorite(this.articleId)}}}]}]}]}});Ext.define("Judge.view.About",{id:"AboutView",extend:"Ext.Container",xtype:"about",requires:["Ext.data.Store"],initialize:function(){this.callParent();var a=Judge.app.getController("AboutController");a.loadData()},config:{layout:"card",title:"Информация",iconCls:"info",items:[{xtype:"list",id:"aboutList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><h4>{title}</h4><small>{description}</small></div>',{disableFormats:true}),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,listeners:{itemtap:function(e,b,f,a,c){var d=Judge.app.getController("AboutController");d.onItemTap(e,b,f,a,c)}}},{xtype:"container",id:"aboutDetails",items:[{xtype:"titlebar",docked:"top",title:"Информация",ui:"light",items:[{text:"К списку..",listeners:{tap:function(){Ext.getCmp("AboutView").setActiveItem(0)}}}]}],scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true}]}});Ext.define("Judge.view.News",{id:"NewsView",extend:"Ext.Container",xtype:"news",requires:["Ext.data.Store"],initialize:function(){this.callParent();var a=Judge.app.getController("NewsController");a.loadData()},config:{layout:"card",title:"Библиотека",iconCls:"compose",items:[{xtype:"list",id:"newsList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><h4>{title}</h4><small>{description}</small></div>',{disableFormats:true}),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,listeners:{itemtap:function(e,b,f,a,c){var d=Judge.app.getController("NewsController");d.onItemTap(e,b,f,a,c)}}},{xtype:"container",id:"newsDetails",items:[{xtype:"titlebar",docked:"top",title:"Библиотека",ui:"light",items:[{text:"К списку..",align:"left",listeners:{tap:function(){Ext.getCmp("NewsView").setActiveItem(0)}}}]},{xtype:"container",}],scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true}]}});Ext.define("Judge.view.Search",{id:"SearchView",extend:"Ext.Container",xtype:"search",config:{layout:"card",title:"Поиск",iconCls:"search",items:[{xtype:"container",layout:"vbox",id:"articlesSearch",scrollable:{direction:"vertical",directionLock:true},items:[{xtype:"container",layout:"vbox",title:"Поиск",items:[{xtype:"textfield",label:"Фраза",placeHolder:"Введите фразу",name:"searchField",required:true,id:"searchField",labelWidth:"35%",},{xtype:"button",text:"Поиск",ui:"confirm",id:"btnSearch",style:"margin-top:20px",listeners:{tap:function(){Judge.app.getController("SearchController").loadData()}}},{xtype:"label",html:'Введите поисковую фразу и нажмите кнопку "Поиск". Поиск осуществляется по ключевым словам.',style:"text-align: center;font-style: italic;opacity: 0.7;font-size: small;"}]},{xtype:"list",scrollable:false,loadingText:null,id:"searchList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><small>{magazine}</small><tpl if="img"><img src="{img}"/></tpl><h4>{title}</h4><small>{description}</small></div>',{disableFormats:true}),styleHtmlContent:true,listeners:{itemtap:function(e,b,f,a,c){var d=Judge.app.getController("SearchController");d.onItemTap(e,b,f,a,c)}},store:{model:"Judge.model.ListItemModel",autoLoad:false}}]},{xtype:"container",id:"searchDetails",layout:"card",items:[{xtype:"titlebar",docked:"top",title:"Поиск",ui:"light",items:[{text:"К списку..",align:"left",listeners:{tap:function(){Ext.getCmp("SearchView").setActiveItem(0);var a=Ext.getCmp("searchEntry");a.suspendEvents();a.removeAll(true,true);a.destroy()}}}]}]}]}});Ext.define("Judge.model.LoginModel",{extend:"Ext.data.Model",config:{fields:["name","password","uniqkey"]}});Ext.define("Judge.controller.FileProvider",{config:{appDirectory:"magazines",fileExt:".txt",objectToWrite:undefined,getFileErrorCallback:undefined,createFile:true,isWriteAccess:false,fileName:undefined,writeCallback:undefined,readCallback:undefined},fileSystemError:function(){var a=Ext.Viewport.getComponent("loading");if(a){a.hide()}Ext.Msg.alert("Информация","Ошибка в доступе к файловой системе. Убедитесь в наличии свободного места.")},deleteFile:function(a){this.processFile(a)},processFile:function(a){var d=this;if(window.LocalFileSystem){window.requestFileSystem(window.LocalFileSystem.PERSISTENT,0,e,this.fileSystemError)}function e(f){f.root.getDirectory(d.appDirectory,{create:true,exclusive:false},g,d.fileSystemError);function g(h){h.getFile(d.fileName+d.fileExt,{create:d.createFile,exclusive:false},c,b)}}function b(){d.getFileErrorCallback?d.getFileErrorCallback():d.fileSystemError()}function c(f){if(a){f.remove(function(){a.call()});return}d.isWriteAccess?d.writeFile.call(d,f):d.readFile.call(d,f)}},readFile:function(b){var a=this;b.file(function(d){var c=new FileReader();c.onloadend=function(f){if(a.readCallback){a.readCallback(f)}};c.readAsText(d)})},writeFile:function(c){var b=this;c.createWriter(a,this.fileSystemError);function a(d){d.onwriteend=function(e){if(b.writeCallback){b.writeCallback()}};d.write(b.objectToWrite)}},constructor:function(b){for(var a in b){this.config[a]=b[a]}for(var c in this.config){this[c]=this.config[c]}this.config=null;return this}});Ext.define("Judge.view.Login",{extend:"Ext.form.Panel",id:"LoginPanel",xtype:"login",requires:["Ext.TitleBar","Ext.form.FieldSet","Ext.field.Email","Ext.field.Password","Judge.model.LoginModel"],config:{title:"Вход",scrollable:true,items:[{xtype:"fieldset",title:"Вход",instructions:"Для входа в систему введите логин и нажмите вход",items:[{xtype:"emailfield",label:"Логин",placeHolder:"email@example.com",name:"user",required:true,id:"txtEmail"}]},{xtype:"container",layout:"hbox",items:[{xtype:"button",text:"Вход",ui:"confirm",flex:1,id:"btnSubmit"},{xtype:"spacer",flex:1},{xtype:"button",text:"Отмена",flex:1,id:"btnCancel"}]}]}});Ext.define("Judge.view.Register",{extend:"Ext.form.Panel",id:"RegisterPanel",xtype:"register",requires:["Ext.TitleBar","Ext.form.FieldSet","Ext.field.Email","Ext.field.Password","Judge.model.LoginModel"],config:{title:"Регистрация",scrollable:{direction:"vertical"},items:[{xtype:"fieldset",title:"Регистрация",instructions:"Для регистрации в системе введите Ваше имя, e-mail и номер телефона.",items:[{xtype:"textfield",label:"Имя",placeHolder:"Имя",name:"regName",required:true,id:"txtRegName",labelWidth:"35%"},{xtype:"emailfield",label:"E-mail",placeHolder:"email@example.com",name:"regEmail",required:true,id:"txtRegEmail",labelWidth:"35%"},{xtype:"textfield",label:"Телефон",placeHolder:"Телефон",name:"regPhone",required:true,id:"txtRegPhone",labelWidth:"35%"}]},{xtype:"fieldset",title:"Номера журналов",instructions:"Выберите номера журнала.",id:"regNumbers",items:[{xtype:"selectfield",label:"Год",name:"regYear",required:true,id:"txtRegYear",labelWidth:"35%",docked:"top",hideAnimation:false,options:[],defaultPhonePickerConfig:{cancelButton:GlobalMessages.Cancel,doneButton:GlobalMessages.Done,hideAnimation:false,},defaultTabletPickerConfig:{cancelButton:GlobalMessages.Cancel,doneButton:GlobalMessages.Done,hideAnimation:false,}}]},{xtype:"fieldset",title:"Оплата",instructions:"Выберите валюту и нажмите Регистрация.",items:[{xtype:"selectfield",label:"Валюта",name:"regCurrency",required:true,id:"txtRegCurrency",labelWidth:"35%",hideAnimation:false,options:[{text:"BYR",value:"BYR"},{text:"USD",value:"USD"},{text:"EUR",value:"EUR"},{text:"RUB",value:"RUB"}],defaultPhonePickerConfig:{cancelButton:GlobalMessages.Cancel,doneButton:GlobalMessages.Done,hideAnimation:false,},defaultTabletPickerConfig:{cancelButton:GlobalMessages.Cancel,doneButton:GlobalMessages.Done,hideAnimation:false,}},{xtype:"textareafield",label:"Примечания",placeHolder:"Примечания",name:"regRemarks",required:false,id:"txtRegRemarks",labelWidth:"35%"}]},{xtype:"container",layout:"hbox",items:[{xtype:"button",text:"Регистрация",ui:"confirm",flex:4,id:"btnRegister"},{xtype:"spacer",flex:1},{xtype:"button",text:"Отмена",ui:"decline",flex:4,id:"btnRegisterCancel"}]}]}});Ext.define("Judge.model.EntryModel",{extend:"Ext.data.Model",config:{fields:["id","title","headline","content"],proxy:{type:"ajax",url:"http://evestnik.by/export.html",reader:{type:"json"}}}});Ext.define("Judge.model.ListModel",{extend:"Ext.data.Model",config:{fields:["id","pagetitle","description","img","content","data"],hasMany:{model:"Judge.model.ListItemModel",name:"data"},proxy:{type:"ajax",url:"http://evestnik.by/export.html",reader:{type:"json"}}}});Ext.define("Judge.model.ListItemModel",{extend:"Ext.data.Model",config:{fields:["id","title","description","img","content",{name:"leaf",type:"boolean"},"list","downloaded","author","magazine"],belongsTo:"Judge.model.ListModel",hasMany:{model:"Judge.model.ListItemModel",name:"list"}}});Ext.define("Judge.view.LazyCarousel",{extend:"Ext.carousel.Carousel",xtype:"lazycarousel",initialize:function(){var a=this;a.callParent(arguments);a.on("activeitemchange",function(){var b=a.animationDirection;if(b===-1){a.deleteFrom("tail");a.fireEvent("movedforward",a);a._raiseIfHeadNeeded()}else{a.deleteFrom("head");a.fireEvent("movedbackward",a);a._raiseIfTailNeeded()}})},deleteFrom:function(d){var c=this;if(c.innerItems.length<2){return null}var a=c.getActiveIndex();if(d==="tail"&&a===1||d==="head"&&a===c.innerItems.length-2){return}var b=d==="tail"?c.innerItems[0]:c.innerItems[c.innerItems.length-1];if(b){c.remove(b);c.fireEvent("itemremoved",c,d,b)}return b},insertHead:function(b){var a=this;a.insert(a.innerItems.length+1,b)},insertTail:function(b){var a=this;a.insert(0,b)},_raiseIfHeadNeeded:function(){var c=this;var a=c.getActiveIndex();var b=c.innerItems.length-1;var d=b-a;if(d<1){c.fireEvent("headneeded",c)}},_raiseIfTailNeeded:function(){var b=this;var a=b.getActiveIndex();if(a<=1){b.fireEvent("tailneeded",b)}}});Ext.define("Judge.controller.LoginController",{extend:Ext.app.Controller,requires:["Judge.model.LoginModel"],config:{refs:{panelMagazine:"#magazinePanel",loginForm:"#LoginPanel",btnSubmit:"#btnSubmit",btnCancel:"#btnCancel",txtEmail:"#txtEmail",btnRegister:"#btnRegister",btnRegisterCancel:"#btnRegisterCancel",txtRegEmail:"#txtRegEmail",txtRegName:"#txtRegName",txtRegPhone:"#txtRegPhone",txtRegCurrency:"#txtRegCurrency",txtRegRemarks:"#txtRegRemarks",txtRegYear:"#txtRegYear",},control:{btnSubmit:{tap:"onSubmit"},btnCancel:{tap:"onCancel"},btnRegister:{tap:"onRegister"},btnRegisterCancel:{tap:"onRegisterCancel"},txtRegYear:{change:"onYearChange"}}},onYearChange:function(a,c,b){this.insertCheckboxes(this.loadedMagazines[c])},insertCheckboxes:function(d){var a=Ext.getCmp("regNumbers");a.removeAll(true,false);for(var c=0;c<d.length;c++){var b=d[c];a.add({xtype:"checkboxfield",label:b.title,labelWidth:"65%",value:b.id})}},loadMagazinesList:function(){var a=this;if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){Ext.Ajax.request({url:"http://evestnik.by/list.html",ignoreload:true,success:function(e){var g=JSON.parse(e.responseText);a.loadedMagazines=[];var b=0;g.map(function(j){if(j.id){var i=j.title.match(/\d+/)[0];if(i>b){b=i}if(!a.loadedMagazines[i]){a.loadedMagazines[i]=[]}a.loadedMagazines[i].push(j)}});var f=new Date().getFullYear();if(!a.loadedMagazines[f]){f=b}var d=Ext.getCmp("txtRegYear");var c=[];for(var h in a.loadedMagazines){c.push({text:h,value:h})}d.suspendEvents();d.setOptions(c);d.resumeEvents();d.setValue(f)},failure:function(){Ext.Msg.alert("Информация","Ошибка подключения при получении журналов.")}})}else{Ext.Msg.alert("Информация","Невозможно получить список журналов. Отсутствует подключение к интернету.")}},emailValidator:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,onSubmit:function(){var a=this;if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){a.loadMagazinesList();Ext.Ajax.request({url:"http://evestnik.by/user.html",method:"POST",ignoreload:true,params:{key:device.uuid},success:function(c){var b=parseInt(c.responseText);var d=a.getApplication().getController("MagazineContainerController");if(b&&b>0){d.loggedIn=b;Judge.app.getController("ArticlesController").loadData()}else{Ext.Msg.alert("Информация","Вы не зарегистрированы либо аккаунт не активирован.")}d.loadData()},failure:function(){Ext.Msg.alert("Информация","Вход невозможен. Ошибка подключения.");a.getApplication().getController("MagazineContainerController").loadData()}})}else{Ext.Msg.alert("Информация","Вход невозможен. Отсутствует подключение к интернету.");a.getApplication().getController("MagazineContainerController").loadData()}},onRegister:function(){var d=this;var c=this.getTxtRegEmail().getValue();var e=this.getTxtRegName().getValue();var b=this.getTxtRegPhone().getValue();var f=this.getTxtRegCurrency().getValue();var a=[];Ext.each(Ext.getCmp("regNumbers").getItems().items,function(h,g,i){if(i[g].getValue&&i[g].getSubmitValue&&i[g].getValue()){a.push(i[g].getSubmitValue())}});if(this.emailValidator.test(c)&&e&&b){if(a.length<=0){Ext.Msg.alert("Информация","Выберите номера журнала.");return}if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){Ext.Ajax.request({url:"http://evestnik.by/order_ok.html",method:"POST",params:{email:c,name:e,tel:b,key:device.uuid,currency:f,"a[]":a,remarks:this.getTxtRegRemarks().getValue()},success:function(g){if(g.responseText=="1"){Ext.Msg.alert("Информация","Регистрация прошла успешно. Ожидайте активации аккаунта.");d.getPanelMagazine().setActiveItem(0)}else{Ext.Msg.alert("Информация","Регистрация невозможна. Ошибка регистрации.")}},failure:function(){Ext.Msg.alert("Информация","Регистрация невозможна. Ошибка подключения.")}})}else{Ext.Msg.alert("Информация","Регистрация невозможна. Отсутствует подключение к интернету.")}}else{Ext.Msg.alert("Информация","Введите имя, e-mail и номер телефона.")}},onRegisterCancel:function(){this.getPanelMagazine().setActiveItem(0)}});Ext.define("Judge.controller.ListBaseController",{extend:"Ext.app.Controller",requires:["Judge.model.EntryModel","Judge.model.ListModel","Judge.model.ListItemModel"],config:{refs:{listView:"",listViewContainer:"",detailsView:""}},listModelId:undefined,getDetailsCardContent:function(a){return a.data.content},buildStore:function(c,b){var a=Ext.create("Ext.data.Store",{model:"Judge.model.ListItemModel",data:b});a.remove(a.last());c.setStore(a)},loadData:function(){var b=this.getListView();var c=this.listModelId;if(!c){throw"You should specify you model id in derrived class to retrive appropriate data from service!"}var a=this;this.loadModel("Judge.model.ListModel",c,function(d){a.buildStore(b,d.data.data)})},processProperties:function(b){var a=this;Ext.each(b,function(e,d,f){if(f[d].id){if(f[d].title==""){f[d].title=f[d].pagetitle}f[d].leaf=(f[d].leaf=="1");var c=f[d].list;if(c){a.processProperties(c)}}else{Ext.Array.remove(f,e)}})},loadModel:function(b,d,a){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){try{Ext.ModelMgr.getModel(b).load(d,{success:a,failure:function(){var e=Ext.Viewport.getComponent("loading");if(e!=null){e.hide()}Ext.Msg.alert("Информация","Произошла ошибка загрузки данных. Повторите попытку позже.")}})}catch(c){var f=Ext.Viewport.getComponent("loading");if(f!=null){f.hide()}Ext.Msg.alert("Информация","Ошибка загрузки данных. Повторите попытку позже.")}finally{}}},onItemTap:function(f,b,g,a,c){var h=this.getListViewContainer();var e=a.get("id");var d=this;this.loadModel("Judge.model.EntryModel",e,function(i){h.setActiveItem(1);h.getAt(1).setHtml(d.getDetailsCardContent(i))})}});Ext.define("Judge.controller.NewsController",{extend:"Judge.controller.ListBaseController",config:{refs:{listView:"#newsList",listViewContainer:"#NewsView"}},listModelId:174});Ext.define("Judge.controller.AboutController",{extend:"Judge.controller.ListBaseController",config:{refs:{listView:"#aboutList",listViewContainer:"#AboutView"}},listModelId:176,buildStore:function(c,b){b.pop();b.push({id:0,title:"Удалить журналы"});var a=Ext.create("Ext.data.Store",{model:"Judge.model.ListItemModel",data:b});c.setStore(a)},onItemTap:function(e,b,f,a,c){var d=a.get("id");if(d==0){Ext.Msg.confirm("Внимание!","Вы действительно хотите удалить все журналы?",function(h){if(h!="yes"){return}var k=Ext.Viewport.getComponent("loading");if(k!=null){k.show()}if(window.LocalFileSystem){window.requestFileSystem(window.LocalFileSystem.PERSISTENT,0,i,g)}function g(){if(k){k.hide()}Ext.Msg.alert("Информация","У вас нет скачанных журналов.");return false}function j(){if(k){k.hide()}Ext.Msg.alert("Информация","Операция завершена. Перезапустите приложение, чтобы изменения вступили в силу.")}function i(m){m.root.getDirectory("magazines",{create:false,exclusive:false},l,g);function l(n){n.removeRecursively(j,j)}}});return false}this.superclass.onItemTap.call(this,e,b,f,a,c)}});Ext.define("Judge.controller.MagazineContainerController",{extend:"Judge.controller.ListBaseController",requires:["Judge.controller.FileProvider"],config:{refs:{viewContainer:"#MagazineContainer",magazineList:"#magazines"},control:{}},listModelId:179,currentMagazineId:undefined,loggedIn:0,currentArticles:{},loadData:function(){var f=Ext.Viewport.getComponent("loading");this.currentArticles={};var e=this.listModelId;var c=this;if(!e){throw"You should specify you model id in derrived class to retrive appropriate data from service!"}var d;if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){Ext.Ajax.request({ignoreload:true,url:"http://evestnik.by/user_order.html?id="+c.loggedIn,success:function(g){c.ordered=JSON.parse(g.responseText);c.loadModel("Judge.model.ListModel",e,function(h){c.processProperties(h.data.data);d=c.processStoreData(h.data.data,false);a()})},failure:function(){if(f!=null){f.hide()}Ext.Msg.alert("Информация","Невозможно получить информацию о подписке");a()}})}else{a()}function b(h){if(h){var g=JSON.parse(h.target.result);if(d&&d.length>0){Ext.each(d,function(j,i,k){Ext.each(g,function(n,m,l){if(k[i].id==l[m].id){k[i].downloaded=true;return false}})})}else{Ext.each(g,function(j,i,k){k[i].downloaded=true});d=g}}if(d&&d.length>0){c.buildStore(d)}else{if(f!=null){f.hide()}Ext.Msg.alert("Информация","Отсустствует доступ к интернету.")}}function a(){if(f!=null){f.show()}Ext.create("Judge.controller.FileProvider",{isWriteAccess:false,readCallback:b,fileName:"all",createFile:false,getFileErrorCallback:b}).processFile()}},writeAllFile:function(c){var e=this;Ext.create("Judge.controller.FileProvider",{isWriteAccess:false,readCallback:d,fileName:"all",createFile:false,getFileErrorCallback:b}).processFile();function a(f){Ext.create("Judge.controller.FileProvider",{isWriteAccess:true,fileName:"all",createFile:f,objectToWrite:JSON.stringify(c),getFileErrorCallback:null,readCallback:null,writeCallback:function(){e.fireEvent("writeallfinish")}}).processFile()}function b(){c=[c];a(true)}function d(f){var g=JSON.parse(f.target.result);g.push(c);c=g;a(false)}},processArticles:function(e,b,d,a){var c=this;Ext.each(e,function(g,f,h){if(h[f].leaf==true){b.push({id:h[f].id,title:h[f].title,description:d,content:a?h[f].content:"",author:h[f].author});return}c.processArticles(h[f].data||h[f].list,b,d==""?h[f].title:">"+h[f].title,a)})},processStoreData:function(d,b){var a=[];var c=this;Ext.each(d,function(f,e,h){a.push({id:h[e].id,title:h[e].title,img:h[e].img});var g=[];c.processArticles(h[e].data||h[e].list,g,"",b);a[a.length-1].data=g});return a},ordered:null,tryLoad:function(b,a,c){if(b.ordered){for(var d in b.ordered){if(b.ordered[d]==a){b.onAvailableTap(a,null,null,null,true,c);return}}}Ext.Msg.alert("Информация","Данный журнал Вам не доступен.")},buildStore:function(f){var a=this.getMagazineList();var c=this;function b(h){var g=new Ext.XTemplate('<div class="magazine-cover"><p>{title}</p><img align="left" src="{img}"></img><tpl if="!downloaded"><span id="mag-{id}" class="btn download-btn">Скачать</span><br/><tpl if="this.showReg(id)"><span id="reg-{id}" class="btn reg-btn">Подписка</span></tpl></tpl></div>',{disableFormats:true,showReg:function(j){if(c.ordered){for(var i in c.ordered){if(c.ordered[i]==j){return false}}}return true}});return[Ext.create("Ext.Container",{layout:"vbox",scrollable:{direction:"vertical",directionLock:true},items:[Ext.create("Ext.Container",{height:"290px",html:g.apply({img:f[h].img,title:f[h].title,downloaded:f[h].downloaded,id:f[h].id}),listeners:{tap:function(l,j,n){if(l.target.className.match(/reg/)){var k=Ext.get("reg-"+f[h].id);k.addCls("pressed");setTimeout(function(){k.removeCls("pressed")},300);var m=Ext.getCmp("magazinePanel");m.getAt(1).disable();m.setActiveItem(1);setTimeout(function(){m.getAt(1).enable()},400)}else{var i=Ext.get("mag-"+f[h].id);i.addCls("pressed");setTimeout(function(){i.removeCls("pressed")},300);c.tryLoad(c,f[h].id,f[h])}},element:"element",delegate:"span.btn"}}),Ext.create("Ext.DataView",{itemTpl:'<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><small>{description}</small><h4>{title}</h4><small class="author">{author}</small></div>',scrollable:false,styleHtmlContent:true,listeners:{initialize:function(){Ext.each(f[h].data,function(j,l,k){if(!c.currentArticles[f[h].id]){c.currentArticles[f[h].id]=[]}c.currentArticles[f[h].id].push(k[l].id)});this.setStore(Ext.create("Ext.data.Store",{model:"Judge.model.ListItemModel",data:f[h].data}))},itemtap:function(j,l,m,i,k){c.onAvailableTap(f[h].id,f[h].title,i.get("id"),i.get("title"),null)}}})]})]}a.insert(0,b(0));if(f.length>1){a.insert(1,b(1))}var d=0;a.on("movedforward",function(){if(f.length>d+1){d=d+1}});a.on("movedbackward",function(){if(d-1>=0){d=d-1}});a.on("headneeded",function(){if(f.length>d+1){a.insertHead(b(d+1))}});a.on("tailneeded",function(){if(d-1>=0){a.insertTail(b(d-1))}});a.setActiveItem(0);var e=Ext.Viewport.getComponent("loading");if(e!=null){e.hide()}setTimeout(function(){if(e!=null){e.hide()}},5000)},prepareTitle:function(b,a){return b},openArticle:function(c,f,a,e){var d=this;var g=Ext.Viewport.getComponent("loading");Ext.create("Judge.controller.FileProvider",{isWriteAccess:false,readCallback:b,fileName:c,createFile:false,getFileErrorCallback:null}).processFile();function b(n){var o=n.target.result;var p=d.getViewContainer();var j;var q=o.split("</p>");if(q.length>paraCount){var l=[];var m=0;while(m<=q.length){var k=q.slice(m,m+paraCount).join("</p>");var i=m+paraCount<q.length?k+"</p>":k+'<div class="sw"><span class="fb social" href="http://www.facebook.com/sharer.php?u=http://www.evestnik.by&t='+e+'"></span><span class="vk social" href="http://vkontakte.ru/share.php?url=http://www.evestnik.by&title='+e+'"></span><span class="tw social" href="https://twitter.com/share?url=http://www.evestnik.by&text='+e+'"></span></div>';l.push(i);m=m+paraCount}function r(){return Ext.create("Ext.TitleBar",{cls:"magazineArticleEntryBar",ui:"light",magazineArticleEntryBar:true,inline:true,layout:{pack:"center"},items:[{iconMask:true,iconCls:"arrow_left",align:"left",flex:1,text:"назад",cls:"articlePrevPageBtn",hidden:true,listeners:{tap:function(){var s=Ext.getCmp("currentArticleContent");if(s.config.currentIndex>0){s.setHtml(l[--s.config.currentIndex]);s.lastAction="prev";Ext.getCmp("magazineArticlesEntry").getScrollable().getScroller().scrollTo(0,s.element.getHeight());Ext.each(Ext.ComponentQuery.query("button[cls=]"),function(u,t,v){u.show()})}if(s.config.currentIndex==0){Ext.each(Ext.ComponentQuery.query("button[cls=articlePrevPageBtn]"),function(u,t,v){u.hide()})}}}},{xtype:"spacer",flex:5},{iconMask:true,iconCls:"arrow_right",align:"right",flex:1,text:"читать дальше",cls:"articleNextPageBtn",listeners:{tap:function(){var s=Ext.getCmp("currentArticleContent");if(s.config.currentIndex<l.length-1){s.setHtml(l[++s.config.currentIndex]);s.lastAction="next";Ext.getCmp("magazineArticlesEntry").getScrollable().getScroller().scrollTo(0,0);Ext.each(Ext.ComponentQuery.query("button[cls=articlePrevPageBtn]"),function(u,t,v){u.show()})}if(s.config.currentIndex>=l.length-1){Ext.each(Ext.ComponentQuery.query("button[cls=articleNextPageBtn]"),function(u,t,v){u.hide()})}}}}]})}j=Ext.create("Ext.Container",{layout:"vbox",cls:"magazineArticleEntry",id:"magazineArticlesEntry",scrollable:{direction:"vertical",directionLock:true,fps:25},items:[{id:"currentArticleContent",currentIndex:0,html:l[0]},r()],listeners:{tap:{element:"element",delegate:"span.social",fn:function(s){window.open(s.target.attributes.href.value,"_system","location=yes")}}}})}else{j=Ext.create("Ext.Container",{cls:"magazineArticleEntry",id:"magazineArticlesEntry",scrollable:{direction:"vertical",directionLock:true,fps:25},listeners:{tap:{element:"element",delegate:"span.social",fn:function(s){window.open(s.target.attributes.href.value,"_system","location=yes")}}},html:o+'<div class="sw"><span class="fb social" href="http://www.facebook.com/sharer.php?u=http://www.evestnik.by&t='+e+'"></span><span class="vk social" href="http://vkontakte.ru/share.php?url=http://www.evestnik.by&title='+e+'"></span><span class="tw social" href="https://twitter.com/share?url=http://www.evestnik.by&text='+e+'"></span></div>'})}var h=Ext.create("Ext.Container",{id:"magazineArticleEntryWrapper",layout:"card",listeners:{deactivate:function(){Ext.getCmp("magazineArticlesEntry").suspendEvents();this.removeAll(true,true);this.destroy()}},items:[{docked:"top",xtype:"titlebar",ui:"light",inline:true,title:d.prepareTitle(f,e),items:[{text:"Назад",align:"left",listeners:{tap:function(){p.setActiveItem(d.getMagazineList())}}},{iconMask:true,iconCls:"star",align:"right",listeners:{tap:function(){Judge.app.getController("ArticlesController").addFavorite(c,e)}}}]}]});if(g!=null){g.hide()}h.add(j);p.add(h);p.setActiveItem(h)}},launch:function(){this.getApplication().getController("LoginController").onSubmit()},onAvailableTap:function(g,b,a,h,i,e){var f=this;var c=Ext.Viewport.getComponent("loading");if(c!=null){c.show()}if(i){d()}else{Ext.create("Judge.controller.FileProvider",{isWriteAccess:false,readCallback:d,fileName:"all",createFile:false,getFileErrorCallback:d}).processFile()}function d(l){var k=false;if(l){var j=JSON.parse(l.target.result);Ext.each(j,function(n,m,o){if(g==o[m].id){k=true;return false}})}if(!k){if(!i){if(c!=null){c.hide()}Ext.Msg.alert("Информация","Журнал не скачан. Сперва скачайте журнал, если он доступен для Вашей подписки.");return}f.on("writeallfinish",function(){var m=Ext.get("mag-"+g);if(m){m.dom.parentNode.removeChild(m.dom)}if(c!=null){c.hide()}Ext.Msg.alert("Завершено.","Журнал скачан!");e.downloaded=true},f,{single:true});f.writeFile(g)}else{f.openArticle(a,b,g,h)}}},writeMagazines:function(b,a){var c=this;Ext.create("Judge.controller.FileProvider",{objectToWrite:b[a].content,isWriteAccess:true,writeCallback:d,fileName:b[a].id,createFile:true,getFileErrorCallback:null}).processFile();function d(){a=a+1;if(b.length==a){c.fireEvent("writemagazinesfinish");return}else{c.writeMagazines(b,a)}}},writeFile:function(b){var a=this;if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){Ext.Ajax.request({ignoreload:true,url:"http://evestnik.by/export.html",urlParams:{id:b},success:function(d){var c=a.processStoreData([JSON.parse(d.responseText)],true)[0];a.on("writemagazinesfinish",function(){var e=Ext.Viewport.getComponent("loading");if(e!=null){e.show()}Ext.each(c.data,function(g,f,h){h[f].content=""});a.writeAllFile(c)},a,{single:true});a.writeMagazines(c.data,0)}})}else{Ext.Msg.alert("Информация","Невозможно скачать журнал. Отсутствует подключение к интернету.")}}});Ext.define("Judge.view.MagazineContainer",{extend:"Ext.Container",xtype:"magazinecontainer",requires:["Ext.data.Store","Judge.view.LazyCarousel"],id:"MagazineContainer",config:{layout:"card",title:"Журналы",items:[{xtype:"lazycarousel",id:"magazines",indicator:false,layout:"fit"}]}});Ext.define("Judge.view.Magazine",{extend:"Ext.Container",xtype:"magazines",requires:["Judge.view.Login","Judge.view.Register","Judge.view.MagazineContainer"],id:"magazinePanel",config:{layout:"card",title:"Журнал",iconCls:"bookmarks",items:[{xtype:"magazinecontainer"},{xtype:"register"}]}});Ext.define("Judge.view.Main",{id:"MainView",extend:"Ext.tab.Panel",requires:["Judge.view.Articles","Judge.view.Magazine","Judge.view.About","Judge.view.News","Judge.view.Search"],fullscreen:true,config:{tabBarPosition:"bottom",layout:{animation:false},items:[{xtype:"magazines"},{xtype:"articles"},{xtype:"news"},{xtype:"about"},{xtype:"search"}]}});var paraCount=45;function onExitCase(){Ext.Msg.confirm(GlobalMessages.ExitTitle,GlobalMessages.ExitPrompt,function(a){if(a=="yes"){navigator.app.exitApp()}})}function onBackKeyDown(){var b=Ext.getCmp("MainView").getActiveItem();var a=b.getId();if(a=="AboutView"||a=="ArticlesView"||a=="NewsView"||a=="SearchView"){var c=b.getActiveItem().getId();if(c=="aboutDetails"||c=="articlesDetails"||c=="newsDetails"||c=="searchDetails"){b.setActiveItem(0);if(c=="articlesDetails"){var g=Ext.getCmp("articlesEntry");g.suspendEvents();g.removeAll(true,true);g.destroy()}else{if(c=="searchDetails"){var d=Ext.getCmp("searchEntry");d.suspendEvents();d.removeAll(true,true);d.destroy()}}}else{onExitCase()}}else{if(a=="magazinePanel"){var e=b.getActiveItem();var f=e.getId();if(f=="RegisterPanel"){Ext.getCmp("magazinePanel").setActiveItem(0)}else{if(f=="MagazineContainer"){if(e.getActiveItem().getId()=="magazines"){onExitCase()}else{e.setActiveItem(Ext.getCmp("magazines"))}}}}}}Ext.application({name:"Judge",isIconPrecomposed:true,views:["Main"],controllers:["NewsController","ArticlesController","LoginController","AboutController","MagazineContainerController","SearchController"],phoneStartupScreen:"resources/loading/Homescreen.jpg",tabletStartupScreen:"resources/loading/Homescreen~ipad.jpg",launch:function(){Ext.fly("appLoadingIndicator").destroy();if(Ext.os.is.Tablet){Ext.getBody().addCls("app-tablet-layout")}Ext.MessageBox.YESNO[0].text=GlobalMessages.No;Ext.MessageBox.YESNO[1].text=GlobalMessages.Yes;Ext.Msg.defaultAllowedConfig.showAnimation=false;Ext.Msg.defaultAllowedConfig.hideAnimation=false;var a=Ext.create("Ext.LoadMask",{message:GlobalMessages.LoadingData,id:"loading"});Ext.Viewport.add(a);a.hide();if(navigator.network&&navigator.network.connection){if(navigator.network.connection.type==Connection.NONE){Ext.Msg.alert(GlobalMessages.ErrorTitle,GlobalMessages.NoInetOfflineMode)}else{Ext.Ajax.on("beforerequest",function(){a.show()});Ext.Ajax.on("requestcomplete",function(e,b,c,d){if(c.ignoreload||(c.params&&(c.params.ignoreload||c.params.id==179||c.params.id==176||c.params.id==174))){return}a.hide()});Ext.Ajax.on("requestexception",function(){a.hide()})}}Ext.Viewport.add(Ext.create("Judge.view.Main"));document.addEventListener("backbutton",onBackKeyDown,false)},onUpdated:function(){window.location.reload()}});

/*ab3da0d58c192f7fcc7ad871726960ea66739c6c*/var GlobalMessages={NoInetOfflineMode:"Отсутствует подключение к интернету. Приложение будет запущено в оффлайн режиме.",LoadingData:"Идет загрузка данных...",FileSystemError:"Произошла ошибка доступа к файловой системе. Проверьте наличие свободного места.",FileNotFoundError:"Журнал не найден.",ErrorTitle:"Информация",ExitTitle:"Выход",ExitPrompt:"Вы уверены, что хотите закрыть приложение?",No:"Нет",Yes:"Да",Cancel:"Отмена",Done:"Готово"};
