







((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=Object.prototype.hasOwnProperty,A=Array.prototype.slice;g={root_url:"http://www.post55.es",base_url:"/API/1/",current_key:"",cache:[],cache_limit:25,clear_cache:function(){return g.cache=[]},post:function(a,b){var c,d,e,f,h,i,j,k,l;e=(j=b!=null?b.data:void 0)!=null?j:{},f=(k=b!=null?b.type:void 0)!=null?k:"POST",e.api_key=g.current_key,d=!1;if(f==="POST")g.clear_cache();else{d=a+JSON.stringify(e),l=g.cache;for(h=0,i=l.length;h<i;h++){c=l[h];if(c[0]===d){typeof b.complete=="function"&&b.complete(c[1]);return}}}return $.ajax(g.method_url(a),{data:e,cache:!1,type:f,error:b.error,statusCode:{200:function(a){return d&&(g.cache.push([d,a]),g.cache.length>g.cache_limit&&g.cache.shift()),typeof b.complete=="function"?b.complete(a):void 0},404:function(a){return typeof b.not_found=="function"?b.not_found(a):void 0},500:function(a){return typeof b.error=="function"?b.error(a):void 0},401:function(a){return typeof b.unauthorized=="function"?b.unauthorized(a):void 0}}})},method_url:function(a){return g.root_url+g.base_url+a},resolve_url:function(a){return typeof a=="string"&&a.indexOf("/")===0?g.root_url+a:a}},n={es:{actions:{append:"Añadir",cancel:"Cancelar",search:"Busca",close:"Cerrar"},errors:{connection:"No se pudo conectar con la Web"},pagination:{next:"Sig.",prev:"Ant."},hometab:{header:"La comunidad de la Experiencia"},menu:{profile:"Perfil",people:"Gente",mailbox:"Buzón",blogs:"Blogs",pictures:"Fotos",alerts:"Alertas",news:"Novedades",help:"i",logout:"Cerrar sesión"},top_bar:{back:"Volver",home:"Inicio"},login:{indicator:"Comprobando las credenciales. Por favor, espere.",user_name:"Usuario",user_password:"Contraseña",button_ok:"Acceder",invalid_data:"Los datos de usuario y contraseña no son correctos.",forgot_password:"¿Olvidaste la contraseña?"},forgot_password:{title:"¿Olvidaste la contraseña?",help:"Si olvidaste tu contraseña podrás cambiarla desde aquí. Para ello indica la dirección de correo de la cuenta y te enviaremos instrucciones sobre cómo poner otra contraseña.",no_email:"No ha indicado ningún email",sending_request:"Enviando la petición. Por favor, espere.",email_sent:"Se envió un e-mail con instrucciones para recuperar su contraseña. Revise su cuenta de correo en unos minutos."},people:{search:{prompt:"Indica las palabras con las que quieres buscar",found_caption:"Todos los usuarios con ",no_results:"No se encontró ningún usuario.",forever_alone:"Todavía no has hecho amigos."},contacts:"Mis amigos",generic_title:"Gente"},comments:{indicator:"Guardando este comentario. Por favor, espere.",remove:{action:"Borrar",confirm:"¿Está seguro de que quiere borrar este comentario?",failed:"No se pudo borrar el comentario"},count:{one:"1 comentario",other:"{{count}} comentarios"}},profile:{wall:{publish:{caption:"Publica en este muro",indicator:"Guardando esta publicación. Por favor, espere."},new_comment:{caption:"Comenta"},none:"No hay contenido en este muro"},info:{personal:"Datos personales",professional:"Datos profesionales"},tabs:{wall:"Muro",information:"Info"}},mailbox:{home:{inbox:"Buzón de entrada",outbox:"Buzón de salida",invitations:"Invitaciones",send:"Crear mensaje"},invitations:{accept:"Aceptar",reject:"Ignorar",profile:"Ver perfil",error:"Ocurrió un error al procesar la invitación",action:{accept:"Invitación aceptada",reject:"Invitación ignorada"},sending:"Respondiendo a la invitación. Por favor, espere.",none:"No tiene invitaciones pendientes"}},message:{title:"Mensaje",none:"No hay ningún mensaje"},new_message:{title:"Crear mensaje",reply_to:"Respuesta",contacts_list:"Destinatarios",no_contacts:"Debe tener algún amigo para enviar mensajes",subject:"Asunto",body:"Contenido del mensaje",send_action:"Enviar mensaje",reply_action:"Responder",sending:"Enviando el mensaje. Por favor, espere.",validations:{no_subject:"Falta el asunto del mensaje",no_body:"Falta el contenido del mensaje",no_receivers:"Debe indicar al menos un destinatario"},result:{ok:"Mensaje enviado",error:"No se pudo enviar el mensaje"}},blogs:{title:"Blogs",post:"Post",comments:{"new":"Añade un comentario",caption:"Comentario a"}},pictures:{show:{title:"Foto"},album:{title:"Álbum",none:"No tiene álbumes"},home:{user_albums:"Mis álbumes",user_pictures:"Mis fotos",all_pictures:"Todas las fotos",camera:"Subir una foto"},count:{one:"1 foto",other:"{{count}} fotos"},none:"No tiene ningún contenido"},news:{title:"Mis novedades",notifications:{messages:{one:"1 mensaje sin leer",other:"{{count}} mensajes sin leer"},invitations:{one:"1 invitación pendiente",other:"{{count}} invitaciones pendientes"}},times:{last:"Desde el último acceso",day:"En el último día",twodays:"En los dos últimos días",ultima_semana:"En la última semana",ultimo_mes:"En el último mes"},none:"No tiene novedades"},alerts:{title:"Alertas",items:{lights:"Con luces",sound:"Con sonido",vibrate:"Con vibración"}}}},l={current_locale:function(){var a;a=[];for(y in n)a.push(y);return a}()[0],t:function(a){var b,c,d,e,f;b=n[this.current_locale],f=a.split(".");for(d=0,e=f.length;d<e;d++){c=f[d],b=b[c];if(b==null)return"Unknown translation for "+a}return b},count:function(a,b){var c,d,e,f;c=l.t(a);switch(b){case 0:d=(e=c.zero)!=null?e:c.other;break;case 1:d=(f=c.one)!=null?f:c.other;break;default:d=c.other}return d.replace("{{count}}",b)}},e={append:function(a){var b,c,d,e,h,i,j,k=this;return j=a.token_id,d=a.layout,i=a.title,h=a.success,e=a.main_form_class,c=f({"class":""+e+" modal-form"}),c.append(f({"class":"title",text:i})),c.append($("<textarea>")),b=f({"class":"actions"}),$("<button>",{"class":"action-button",text:l.t("actions.append"),click:function(){return c.find(".actions button").hide(),c.append(f({"class":"indicator",text:l.t("comments.indicator")})),g.post("post/comment",{type:"POST",data:{content:c.find("textarea").val(),token_id:j},complete:function(a){return c.remove(),d.stop_modal(),typeof h=="function"?h():void 0}})}}).appendTo(b),$("<button>",{"class":"cancel-button",text:l.t("actions.cancel"),click:function(){return c.remove(),d.stop_modal()}}).appendTo(b),c.append(b),d.set_modal_view(c)},comments_box:function(a,b,c,d){var h,i,j,k,m,n,o=this;j=f({"class":"comments"}),f({"class":"title",text:l.count("comments.count",a.length)}).appendTo(j);for(m=0,n=a.length;m<n;m++)i=a[m],k=f({"class":"comment"}),k.html('<div class="meta">\n  <div class="avatar"><img class="imgscale"></div>\n  <div class="text">\n    <div class="author"></div>\n    <div class="published-at"></div>\n  </div>\n</div>\n<div class="content"></div>'),i.can_delete&&(k.data("comment-id",i.id),$("<a>",{text:l.t("comments.remove.action"),"class":"remove-action",click:function(a){var b,c,d,e;if(confirm(l.t("comments.remove.confirm")))return d=$("<img>",{src:"images/loading.gif","class":"remove-action"}),e=$(a.target),b=e.closest(".comment"),c=b.data("comment-id"),e.replaceWith(d),g.post("comment/destroy",{type:"POST",data:{id:c},complete:function(a){return a.result==="OK"?b.remove():(alert(l.t("comments.remove.failed")),d.remove())}})}}).prependTo(k)),k.find("img").attr("src",g.resolve_url(i.author_avatar_url)),k.find(".author").text(i.author),k.find(".content").text(i.content),k.find(".published-at").text(i.published_at),k.appendTo(j);return h=f({"class":"actions-bar"}).appendTo(j),$("<a>",{"class":"new-comment",text:l.t("blogs.comments.new")}).click(function(a){return e.append({token_id:b.token_id,layout:c,title:""+l.t("blogs.comments.caption")+": "+b.title,success:d})}).appendTo(h),j}},j=function(){function a(a,b){var c=this;this.layout=a,this.history_size=b!=null?b:50,this.history=[],document.addEventListener("deviceready",function(){return document.addEventListener("backbutton",function(){return c.pop(),null},!0),null},!1)}return a.prototype.push=function(a){this.history.push(a);if(this.history.length>this.history_size)return this.history_size.shift()},a.prototype.drop_current=function(){return this.history.pop()},a.prototype.is_returning=function(){return this.last_time_item_popped&&new Date-this.last_time_item_popped<5e3},a.prototype.pop=function(){var a;this.last_time_item_popped=new Date,this.drop_current(),a=this.history.pop();if(a)return a();if(Platform.phoneGap)return PhoneGap.exec(null,null,"App","exitApp",[])},a}(),s={render:function(a){var b;return b=f({"class":"pagination-bar"}),a.has_prev_page&&b.append($("<a>",{"class":"pagination-button prev",text:l.t("pagination.prev"),data:{page:a.page-1,direction:"prev"}})),a.has_next_page&&b.append($("<a>",{"class":"pagination-button next",text:l.t("pagination.next"),data:{page:a.page+1,direction:"next"}})),b.find("a").click(function(b){var c,d,e,f;return f=$(b.target),e=f.data("direction"),e==="prev"&&(c=$(document),d=function(){return c.scrollTop(c.height()),c.unbind(m.Signals.ContentChanged,d)},c.bind(m.Signals.ContentChanged,d)),a.handler(f.data("page"),e)}),b}},m=function(){function a(a){this.app=a,this.body=null,this.history=new j(this)}return a.Signals={ContentChanged:"contentChanged"},a.prototype.generate=function(){var a;return this.body=f({id:"body",text:"."}),this.body.appendTo(this.app.box),this.banner_manager(),a=/tab:(.*)/.exec(location.hash),a&&a[1]?this.open_tab(a[1]):this.go_home(),!0},a.prototype.banner_manager=function(){var a,b,c;return this.banner=a=f({id:"bottom-banner"}).append($("<img>",{src:"images/banner.png"})).appendTo(this.app.box),b=this.body,c=function(){b.css("min-height",$(window).height()-b.position().top-80)},c(),$(window).bind("orientationchange",c),$(window).bind("resize",c),!0},a.prototype.go_home=function(){return this.open_tab("home")},a.prototype.set_modal_view=function(a){return this.body.hide(),this.modal_view=a,a.appendTo(document.body)},a.prototype.stop_modal=function(){if(this.modal_view)return this.modal_view.remove(),this.modal_view=null,this.body.show()},a.prototype.open_tab=function(a){var b,d,e=this;return this.current_tab=null,typeof a=="string"&&(b=c[a])?this.current_tab=new b(this):this.current_tab=a,this.history.push(function(){return e.open_tab(a)}),this.body.empty(),this.stop_modal(),typeof (d=this.current_tab).open=="function"?d.open():void 0},a.prototype.has_title=function(){var a;return(typeof (a=this.current_tab).show_topbar=="function"?a.show_topbar():void 0)!==!1},a.prototype.set_content=function(b,c){var d,e,g,h,i,j,k=this;return c==null&&(c={}),this.body.empty(),this.has_title()&&(c!=null?c.title:void 0)&&(e=f({id:"web-header"}).appendTo(this.body),g=h=null,Platform.android||(g=$("<a>",{"class":"back",text:l.t("top_bar.back"),click:function(){return k.history.pop()}}).appendTo(e),h=$("<a>",{"class":"home",text:l.t("top_bar.home"),click:function(){return k.open_tab("home")}}).appendTo(e)),i=$("<span>",{"class":"tab-title"}),i.text(c.title||"Post55"),i.appendTo(e),Platform.android||i.width(h.position().left-(g.position().left+g.width())-20)),(typeof (j=this.current_tab).has_detailed_background=="function"?j.has_detailed_background():void 0)?this.body.addClass("detailed-background"):this.body.removeClass("detailed-background"),this.body.append(b),b.find("img.imgscale").imgscale(),d=$(document),d.scrollTop(0),d.trigger(a.Signals.ContentChanged),b},a.prototype.show_loading=function(){var a;if($("#loading-box").get(0))return;return a=f({id:"loading-box"}),$("<img>",{src:"images/loading.gif"}).appendTo(a),this.body.removeClass("detailed-background"),a.appendTo(this.body)},a}(),c={},i=function(){function a(a){this.layout=a}return a.prototype.open=function(){var a;a=f({"class":"help-tab"}),a.html('<p>\n  Esta es una versión para móvil por lo que no contiene las mismas\n  funcionalidades que permite la página web\n  <a href="http://www.post55.es">www.post55.es</a>\n</p>\n\n<div class="section">\n  <div class="head">\n    <img src="images/home/alerts.png">\n    Mis novedades\n  </div>\n  <p>Consulta la actividad de tus amigos. Por agilidad, se presentan las últimas 60. \n  Puedes configurar el tiempo de actualización que prefieras: desde el último acceso, \n  en el último día, en los 2 últimos días, en la última semana o en el último mes.</p>\n</div>\n\n<div class="section">\n  <div class="head">\n    <img src="images/home/profile.png">\n    Perfil\n  </div>\n  <p>En esta sección verás tu muro en el que podrás dejar comentarios y la información de tu perfil público.</p>\n</div>\n\n<div class="section">\n  <div class="head">\n    <img src="images/home/people.png">\n    Gente\n  </div>\n  <p>En esta sección encontraras el directorio de tus amigos de Post55.<br/>\n  Tienes un buscador para localizar a otras personas de la comunidad.</p>\n</div>\n\n<div class="section">\n  <div class="head">\n    <img src="images/home/mailbox.png">\n    Buzón\n  </div>\n  <p>En el buzón de entrada visualizas los mensajes que te envían en la comunidad. Los no leídos aparecen sombreados en verde. En esta aplicación solo podrás enviar mensajes a tus amigos.</p>\n</div>\n\n<div class="section">\n  <div class="head">\n    <img src="images/home/blogs.png">\n    Blogs\n  </div>\n  <p>Consulta y comenta los post que los miembros de la comunidad han ido escribiendo. Aparecen en orden cronológico.</p>\n</div>\n\n<div class="section">\n  <div class="head">\n    <img src="images/home/pictures.png">\n    Fotos\n  </div>\n  <p>Encontrarás tus fotos y tus álbumes. En esta sección también puedes subir fotos desde tu móvil.</p>\n</div>\n\n<div class="section only-in-phonegap">\n  <div class="head">\n    <img src="images/home/alerts.png">\n    Alertas\n  </div>\n\n  <p>\n    Configura la forma en la que quieres que tu móvil te avise de las novedades en la comunidad: con sonido, con luces o con vibración.<br>\n    Te informamos de que el tiempo de actualización de las novedades es de 15 minutos.\n  </p>\n</div>\n'),this.layout.set_content(a,{title:"Ayuda"});if(!Platform.phoneGap)return a.find(".only-in-phonegap").remove()},a}(),k=function(){function b(a){this.layout=a}var a;return a=["news","profile","people","mailbox","blogs","pictures"],Platform.phoneGap&&a.push("alerts"),Platform.android||a.push("logout"),b.prototype.show_topbar=function(){return!1},b.prototype.has_detailed_background=function(){return!0},b.prototype.open=function(){var b,c,d,e,g,h,j,k=this;g=f({"class":"home-tab"}),g.append(f({"class":"header-info",text:l.t("hometab.header")})),b=f({"class":"app-home"}),g.append(b),c=f({"class":"first-column"}),c.appendTo(b),$("<img>",{src:"images/logo.png","class":"logo"}).appendTo(c),$("<img>",{click:function(){return k.layout.open_tab(new i(k.layout))},"class":"help-link",src:"images/logo-info.png"}).appendTo(c),e=f({"class":"second-column"}),e.appendTo(b);for(h=0,j=a.length;h<j;h++)d=a[h],$("<a>",{text:l.t("menu."+d),"class":"hl-on-pressed",data:{name:d}}).prepend($("<img>",{src:"images/home/"+d+".png"})).appendTo(e);return e.delegate("a","click",function(a){return k.layout.open_tab($(a.target).closest("a").data("name"))}),this.layout.set_content(g)},b}(),c.home=k,x=function(){function a(a,b){this.layout=a,this.user=b,this.user==null&&(this.user=window.localStorage.getItem("user_name"))}return a.prototype.open=function(){var a=this;return this.layout.show_loading(),g.post("profile",{type:"GET",data:{login:this.user},complete:function(b){return a.generate_profile(b)}})},a.prototype.generate_profile=function(b){var c,d,h,i,j,k,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J=this;if(!b)return;k=f({"class":"profile-view"}),t=f({"class":"header"}),t.appendTo(k),t.html('<div class="avatar"><img class="imgscale" /></div>\n<div class="name">\n  <div class="login"></div>\n  <div class="fullname"></div>\n</div>'),t.find("img").attr("src",g.resolve_url(b.avatar_url)),t.find(".login").text(this.user),t.find(".fullname").text(b.full_name),u=f({"class":"tab-selector"}),x=f({"class":"wall-tab",text:l.t("profile.tabs.wall"),click:function(){return J.open_tab("wall")}}),p=f({"class":"info-tab",text:l.t("profile.tabs.information"),click:function(){return J.open_tab("info")}}),u.append(x),u.append(p),k.append(u),w=f({"class":"wall-content"}),b.wall.can_write&&f({"class":"publish-box"}).append($("<button>",{"class":"action-button",text:l.t("profile.wall.publish.caption"),click:function(){return J.open_publish()}})).appendTo(w),E=b.wall.items;for(y=0,B=E.length;y<B;y++)q=E[y],d=this.generate_publish_box(q,"wall-item"),i=(F=q.comments)!=null?F:[],c=f({"class":"actions-box"}),c.appendTo(d),c.append($("<span>",{"class":"comment-link",text:l.count("comments.count",i.length),click:function(a){return $(a.target).parents(".wall-item").find(".comments-container").toggle()}})),j=f({"class":"comments-container"}),j.hide().appendTo(d),h=q.content,h.length>15&&(h=h.substr(0,12)+"…"),e.comments_box(i,{token_id:q.token_id,title:h},this.layout,function(){return J.layout.open_tab(new a(J.layout,J.user))}).appendTo(j),d.appendTo(w);b.wall.items.length===0&&w.append(f({text:l.t("profile.wall.none"),"class":"none"})),o=f({"class":"info-content"}),G=["personal","professional"];for(z=0,C=G.length;z<C;z++){m=G[z];if(!(b.information[m]&&b.information[m].length>0))continue;n=f({"class":"data-group"}),n.append(f({"class":"title",text:l.t("profile.info."+m)})),H=b.information[m];for(A=0,D=H.length;A<D;A++)I=H[A],s=I[0],v=I[1],/\S/.exec(v)&&(r=f({"class":"item-box"}),r.append(f({"class":"label",text:s})),r.append(f({"class":"value",text:v})),r.appendTo(n));n.appendTo(o)}return k.append(w),k.append(o),this.layout.set_content(k,{title:l.t("menu.profile")}),this.open_tab("wall")},a.prototype.open_tab=function(a){var b,c;c=$(".tab-selector .wall-tab, .wall-content"),b=$(".tab-selector .info-tab, .info-content");switch(a){case"info":return b.addClass("selected"),c.removeClass("selected");case"wall":return c.addClass("selected"),b.removeClass("selected")}},a.prototype.open_publish=function(){var a,b,c=this;return this.layout.history.push(function(){return c.open_publish()}),b=f({"class":"publish-form modal-form"}),b.append($("<textarea>")),a=f({"class":"actions"}),a.append($("<button>",{"class":"action-button",text:l.t("actions.append"),click:function(){return b.find(".actions button").hide(),b.append(f({"class":"indicator",text:l.t("profile.wall.publish.indicator")})),g.post("post/create",{type:"POST",data:{content:b.find("textarea").val(),user_wall:c.user},complete:function(a){return c.layout.history.pop()}})}})),a.append($("<button>",{"class":"cancel-button",text:l.t("actions.cancel"),click:function(){return b.remove(),c.layout.history.pop()}})),b.append(a),this.layout.set_content(b,{title:l.t("profile.wall.publish.caption")})},a.prototype.generate_publish_box=function(b,c){var d,e,h=this;return e=f({"class":""+c+" post-box"}),d=f({"class":"avatar"}),d.append($("<img>",{src:g.resolve_url(b.author_avatar_url),"class":"imgscale"})),d.appendTo(e),d=f({"class":"text"}),d.append(f({"class":"author",text:b.author})),d.append(f({"class":"content",text:b.content})),d.append(f({"class":"published_at",text:b.published_at})),d.appendTo(e),b.author_login!==this.user&&e.find(".avatar, .author").click(function(){return h.layout.open_tab(new a(h.layout,b.author_login))}),b.token_id!=null&&e.data("token_id",b.token_id),e},a}(),c.profile=x,t=function(){function a(a,b,c){this.layout=a,this.contacts=b!=null?b:"true",this.query=c!=null?c:null,this.current_page=1}return a.prototype.open=function(){return this.request_page(this.current_page)},a.prototype.request_page=function(a){var b=this;return this.layout.set_content(f()),this.layout.show_loading(),g.post("people",{type:"GET",data:{page:a,contacts:this.contacts||"",query:this.query||""},complete:function(c){return b.current_page=a,b.generated_index(c)}})},a.prototype.open_search=function(){var b;b=prompt(l.t("people.search.prompt"));if(b)return this.layout.open_tab(new a(this.layout,"",b))},a.prototype.generated_index=function(b){var c,d,e,h,i,j,k,m,n,o,p,q,r=this;e=f({"class":"people-index"}),this.contacts==="true"?i=l.t("people.contacts"):i=l.t("people.generic_title"),this.query&&(j=f({"class":"search-info"}).appendTo(e),j.append($("<span>",{"class":"caption",text:l.t("people.search.found_caption")})),j.append($("<span>",{"class":"terms",text:this.query}))),d=s.render({has_next_page:b.has_next_page,has_prev_page:b.has_prev_page,page:this.current_page,handler:function(a,b){return r.request_page(a)}}),this.query||d.prepend($("<a>",{text:l.t("actions.search"),"class":"search-button",click:function(){return r.open_search()}})),d.appendTo(e),m=f({"class":"users"});if((p=b.users)!=null?p.length:void 0){q=b.users;for(n=0,o=q.length;n<o;n++)k=q[n],h=f({"class":"item hl-on-pressed"}),h.html('<div class="avatar"><img class="imgscale" /></div>\n<div class="name">\n  <div class="login"></div>\n  <div class="fullname"></div>\n</div>'),h.find("img").attr("src",g.resolve_url(k.avatar_url)),h.find(".login").text(k.login),h.find(".fullname").text(k.name),h.bind("click",{login:k.login,layout:this.layout},function(b){var c;return c=$(window),a.scrollTo=[c.scrollTop(),c.scrollLeft()],b.data.layout.open_tab(new x(b.data.layout,b.data.login))}),m.append(h)}else this.contacts==="true"?m.append(f({"class":"no-results",text:l.t("people.search.forever_alone")})):m.append(f({"class":"no-results",text:l.t("people.search.no_results")}));return e.append(m),this.layout.set_content(e,{title:i}),a.scrollTo&&this.layout.history.is_returning()&&(c=$(window),c.scrollTop(a.scrollTo[0]),a.scrollTo=null),!0},a}(),c.people=t,p=function(){function a(a,b){this.layout=a,this.start_section=b}return a.prototype.open=function(){var a=this;return this.layout.show_loading(),g.post("mailbox",{type:"GET",complete:function(b){return a.mailbox_data=b,a.start_section?(a.layout.history.drop_current(),a.open_section(a.start_section)):a.generate_home()}})},a.prototype.has_detailed_background=function(){return!0},a.prototype.generate_home=function(){var a,b,c,d,e,g,h,i,j,k,m,n,o,p,q=this;a=f({"class":"mailbox-home"}),m=["send","inbox","outbox","invitations"];for(h=0,j=m.length;h<j;h++)g=m[h],$("<a>",{"class":"section "+g+" hl-on-pressed",text:l.t("mailbox.home."+g),data:{section:g}}).appendTo(a);a.delegate("a.section","click",function(a){return q.open_section($(a.target).data("section"))}),this.layout.set_content(a,{title:l.t("menu.mailbox")}),n=[[this.mailbox_data.messages.unread,"inbox"],[this.mailbox_data.invitations.length,"invitations"]],p=[];for(i=0,k=n.length;i<k;i++)o=n[i],b=o[0],g=o[1],b>0?(d=a.find("a."+g),c=$("<span>",{"class":"counter",text:b}).appendTo(d),e=d.offset(),p.push(c.css({top:e.top+(d.outerHeight()-c.outerHeight())/2,right:"15%"}))):p.push(void 0);return p},a.prototype.open_section=function(a){var b,c=this;return this.layout.history.push(function(){return c.open_section(a)}),typeof this[b="generate_section_"+a]=="function"?this[b]():void 0},a.prototype.generate_section_send=function(a){var b,c,d,e,h,i,j,k,m,n,o=this;a==null&&(a={}),i=$("<form>",{"class":"mailbox-new-message modal-form"}),e=null;if(a.parent!=null)j=l.t("new_message.reply_to");else{j=l.t("new_message.title"),h=f({"class":"selector-btn",text:l.t("new_message.contacts_list")}),h.appendTo(i),e=$("<select>",{multiple:"multiple","class":"contacts"}),i.append(e);if(this.mailbox_data.messages.contacts.length===0){this.layout.set_content(f({"class":"none",text:l.t("new_message.no_contacts")}),{title:j});return}n=this.mailbox_data.messages.contacts;for(k=0,m=n.length;k<m;k++)c=n[k],e.append(new Option(""+c.name+" ("+c.login+")",c.login));d=f({"class":"contact-names"}),d.appendTo(i),e.change(function(){var a,b,c,e,f;a=[],f=this.options;for(c=0,e=f.length;c<e;c++)b=f[c],b.selected&&a.push(b.text);return d.text(a.join(", ")),!0})}i.append($("<input>",{"class":"subject",placeholder:l.t("new_message.subject")})),i.append($("<textarea>",{"class":"body",placeholder:l.t("new_message.body")})),a.initial_subject&&i.find("input.subject").val(a.initial_subject),b=f({"class":"actions"}),$("<button>",{"class":"action-button",text:l.t("new_message.send_action"),click:function(b){var c,d,h,j,k;b.preventDefault(),c={subject:i.find("input.subject").val(),body:i.find("textarea.body").val()},a.parent!=null?c.parent_id=a.parent.id:c.receivers=function(){var a,b,c,d;c=e[0].options,d=[];for(a=0,b=c.length;a<b;a++)j=c[a],d.push(j.selected?j.value:"");return d}().join(" "),d=[];for(h in c)k=c[h],/\S+/.exec(k)||d.push(l.t("new_message.validations.no_"+h));return d.length===0?(i.find(".actions button").hide(),i.append(f({"class":"indicator",text:l.t("new_message.sending")})),g.post("message/create",{type:"POST",data:c,complete:function(a){return a==="OK"?(alert(l.t("new_message.result.ok")),o.layout.history.pop()):alert(""+l.t("new_message.result.error")+": "+a)}})):alert(d.join("\n"))}}).appendTo(b),$("<button>",{"class":"cancel-button",text:l.t("actions.cancel"),click:function(a){return a.preventDefault(),o.layout.history.pop()}}).appendTo(b),i.append(b),this.layout.set_content(i,{title:j});if(e)return e.width(h.outerWidth()),e.height(h.outerHeight()),e.css("margin-left",h.css("margin-left"))},a.prototype.generate_section_inbox=function(){return this.message_block("inbox")},a.prototype.generate_section_outbox=function(){return this.message_block("outbox")},a.prototype.generate_section_invitations=function(){var a,b,c,d,e,h,i=this;a=f({"class":"mailbox-invitations"});if(this.mailbox_data.invitations.length===0){this.layout.set_content(f({"class":"none",text:l.t("mailbox.invitations.none")}),{title:l.t("mailbox.home.invitations")});return}h=this.mailbox_data.invitations;for(d=0,e=h.length;d<e;d++)b=h[d],c=f({"class":"invitation"}),c.html('<div class="avatar"><img class="imgscale"></div>\n<span class="author"></span>\n<div class="body"></div>\n<div class="actions-bar">\n  <a class="profile" data-reply="profile"></a>\n  <a class="accept" data-reply="accept"></a>\n  <a class="reject" data-reply="reject"></a>\n</div>'),c.data("invitation_id",b.id),c.data("login",b.sender_login),c.find("img").attr("src",g.resolve_url(b.sender_avatar_url)),c.find(".author").text(b.sender),c.find(".body").text(b.text),c.find(".profile").text(l.t("mailbox.invitations.profile")),c.find(".accept").text(l.t("mailbox.invitations.accept")),c.find(".reject").text(l.t("mailbox.invitations.reject")),c.appendTo(a);return a.find(".invitation .actions-bar a").click(function(b){var d,e,h;return d=$(b.target),e=d.parents("div.invitation"),i.layout.set_modal_view(f({"class":"modal-text",text:l.t("mailbox.invitations.sending")})),h=d.data("reply"),h==="profile"?i.layout.open_tab(new x(i.layout,e.data("login"))):g.post("invitations/reply",{type:"POST",data:{id:e.data("invitation_id"),reply:h},complete:function(b){return a=f({"class":"mailbox-invitations"}),e.remove(),b==="OK"?c=f({"class":"none",text:l.t("mailbox.invitations.action."+h)}):c=f({"class":"none",text:l.t("mailbox.invitations.error")}),c.appendTo(a),i.layout.set_content(a,{title:l.t("mailbox.home.invitations")}),i.layout.stop_modal()}})}),this.layout.set_content(a,{title:l.t("mailbox.home.invitations")})},a.prototype.message_block=function(b){var c,d,e,h,i,j,k,m,n,o,p,r,s=this;k=this.mailbox_data.messages[b],e=f({"class":"messages"}),k.length===0&&e.append(f({"class":"none",text:l.t("message.none")}));for(n=0,o=k.length;n<o;n++)j=k[n],i=f({"class":"message hl-on-pressed"}),i.html('<div class="avatar"><img class="imgscale"></div>\n<div class="metadata">\n  <div class="subject"></div>\n  <span class="author"></span>\n  <span class="sent-at"></span>\n</div>'),d=(p=j.from_avatar_url)!=null?p:j.receiver_avatar_url,d?i.find("img").attr("src",g.resolve_url(d)):(i.find("img").remove(),i.find(".avatar").addClass("no-image")),i.find(".author").text((r=j.from)!=null?r:j.receiver),i.find(".sent-at").text(j.sent_at),i.find(".subject").text(j.subject),j.read===!1&&i.addClass("unread"),i.data("message-id",j.id),i.appendTo(e);return e.delegate("div.message","click",function(c){var d,e,f,g,h,j;i=$(c.target).closest("div.message"),f=parseInt(i.data("message-id"));if(i.parents("div.mailbox-inbox").length>0){i.removeClass("unread"),s.mailbox_data.messages.unread--,j=s.mailbox_data.messages.inbox;for(g=0,h=j.length;g<h;g++)e=j[g],e.id===f&&(e.read=!0)}return d=$(window),a["scrollTo"+b]=[d.scrollTop(),d.scrollLeft()],s.layout.open_tab(new q(s.layout,s,b,f))}),h=f({"class":"mailbox-"+b}),h.append(e),this.layout.set_content(h,{title:l.t("mailbox.home."+b)}),m=a["scrollTo"+b],m&&(c=$(window),c.scrollTop(m[0])),!0},a}(),c.mailbox=p,q=function(){function a(a,b,c,d){this.layout=a,this.mailbox_tab=b,this.mailbox_type=c,this.message_id=d}return a.prototype.open=function(){var a=this;return this.layout.show_loading(),g.post("message",{type:"GET",data:{message_id:this.message_id},complete:function(b){return a.message=b,a.generate_view()}})},a.prototype.generate_view=function(){var a,b,c,d=this;return b=f({"class":"message-view"}),b.html('<div class="user">\n  <div class="avatar"><img class="imgscale" /></div>\n  <div class="name"></div>\n</div>\n<div class="subject"></div>\n<div class="body"></div>'),this.mailbox_type==="inbox"?(c=this.message.from,a=this.message.from_avatar_url):(c=this.message.receiver,a=this.message.receiver_avatar_url),a&&b.find(".user img").attr("src",g.resolve_url(a)),b.find(".user .name").text(c),b.find(".subject").text(this.message.subject),b.find(".body").text(this.message.body),$("<a>",{"class":"reply",text:l.t("new_message.reply_action")}).appendTo(f({"class":"actions-bar"}).appendTo(b).click(function(a){var b;return b=function(){return d.mailbox_tab.generate_section_send({initial_subject:d.message.subject.replace(/^(Re: )?/,"Re: "),parent:{id:d.message.id,body:d.message.body,from:d.message.from}})},d.layout.history.push(b),b()})),this.layout.set_content(b,{title:l.t("message.title")})},a}(),w=function(){function a(a,b){this.layout=a,this.post_id=b}return a.prototype.open=function(){var a=this;return this.layout.show_loading(),g.post("post",{type:"GET",data:{permalink:this.post_id},complete:function(b){return a.generate_view(b)}})},a.prototype.generate_view=function(a){var b,c=this;return b=f({"class":"post-view"}),b.html('\n<div class="head">\n  <div class="avatar"><img class="imgscale"></div>\n  <div class="data">\n    <div class="title"></div>\n    <div class="author"></div>\n    <div class="date"></div>\n  </div>\n</div>\n<div class="body"></div>'),b.find(".avatar img").attr("src",g.resolve_url(a.author_avatar_url)),b.find(".title").text(a.title),b.find(".author").text(a.author),b.find(".body").html(a.body),b.find(".date").text(a.published_at),b.find(".body").find("img").each(function(){if(this.src.indexOf("file://")===0)return this.src=g.resolve_url(this.src.replace("file://",""))}),b.append(e.comments_box(a.comments,{token_id:a.token_id,title:a.title},this.layout,function(){return c.open()})),this.layout.set_content(b,{title:l.t("blogs.post")})},a}(),d=function(){function a(a,b){this.layout=a,this.page=b,this.page==null&&(this.page=1)}return a.prototype.open=function(){var a=this;return this.layout.show_loading(),g.post("posts",{type:"GET",data:{page:this.page},complete:function(b){return a.generate_posts(b)}})},a.prototype.generate_posts=function(b){var c,d,e,h,i,j,k,m,n=this;d=f({"class":"posts-index"}),h=s.render({has_next_page:b.has_next_page,has_prev_page:b.has_prev_page,page:this.page,handler:function(b,c){return n.layout.set_content(f()),n.layout.open_tab(new a(n.layout,b))}}),h.appendTo(d),m=b.posts;for(j=0,k=m.length;j<k;j++)i=m[j],e=f({"class":"post hl-on-pressed"}),e.data("post-id",i.token_id),e.data("post-permalink",i.permalink),e.data("post-title",i.title),e.appendTo(d),e.html('<div class="avatar"><img class="imgscale"></div>\n<div class="data">\n  <div class="title"></div>\n  <div class="author"></div>\n  <div class="date"></div>\n  <div class="comments"></div>\n</div>'),e.find(".avatar img").attr("src",g.resolve_url(i.author_avatar_url)),e.find(".title").text(i.title),e.find(".author").text(i.author),e.find(".date").text(i.published_at),e.find(".comments").text(l.count("comments.count",i.comments_count));return d.delegate(".post","click",function(b){var c;return c=$(window),a.scrollTo=[c.scrollTop(),c.scrollLeft()],n.layout.open_tab(new w(n.layout,$(b.target).closest(".post").data("post-permalink")))}),h.clone(!0).appendTo(d),this.layout.set_content(d,{title:l.t("blogs.title")}),a.scrollTo&&this.layout.history.is_returning()&&(c=$(window),c.scrollTop(a.scrollTo[0]),a.scrollTo=null),!0},a}(),c.blogs=d,v=function(){function b(a){this.layout=a}var a;return a=["user_albums","user_pictures","all_pictures"],Platform.phoneGap&&a.push("camera"),b.prototype.has_detailed_background=function(){return!0},b.prototype.open=function(){var b,c,d,e,g=this;b=f({"class":"pictures-home"});for(d=0,e=a.length;d<e;d++)c=a[d],$("<a>",{"class":"section hl-on-pressed",text:l.t("pictures.home."+c),data:{section:c}}).appendTo(b);return b.delegate("a.section","click",function(a){return g.open_section
($(a.target).data("section"))}),this.layout.set_content(b,{title:l.t("menu.pictures")})},b.prototype.open_section=function(a){var b,c=this;return this.layout.history.push(function(){return c.layout.open_tab(c),c.open_section(a)}),typeof this[b="generate_section_"+a]=="function"?this[b]():void 0},b.prototype.generate_section_user_pictures=function(){return this.search(l.t("pictures.home.user_pictures"),{source:"owned"})},b.prototype.generate_section_all_pictures=function(){return this.search(l.t("pictures.home.all_pictures"),{source:"all"})},b.prototype.generate_section_user_albums=function(){var a=this;return this.layout.set_content(f()),g.post("albums",{type:"GET",complete:function(b){var c,d,e,g;d=f({"class":"albums-index"}),b.length===0&&(d=f({"class":"none",text:l.t("pictures.album.none")}));for(e=0,g=b.length;e<g;e++)c=b[e],f({"class":"item",text:""+c.title+" ("+l.count("pictures.count",c.items_count)+")",data:{albumId:c.id,albumTitle:c.title}}).appendTo(d);return d.delegate(".item","click",function(b){var c,d;return c=$(b.target).data("albumId"),d=$(b.target).data("albumTitle"),a.search(l.t("pictures.album.title"),{source:"album",album_id:c})}),a.layout.set_content(d,{title:l.t("pictures.home.user_albums")})}})},b.prototype.generate_section_camera=function(){var a=this;return navigator.camera.getPicture(function(b){return a.upload_picture(b)},function(a){return alert(a)},{destinationType:Camera.DestinationType.FILE_URI})},b.prototype.upload_picture=function(a){return PhoneGap.exec(function(){return 0},function(){return 0},"UploadPicture","upload",[g.method_url("pictures/upload"),g.current_key,a],!0),g.clear_cache(),!0},b.prototype.search=function(a,b){var c=this;return this.layout.set_content(f()),g.post("pictures",{type:"GET",data:b,complete:function(d){return c.show_response(a,d,b)}})},b.prototype.show_response=function(a,c,d){var e,h,i,j,k,m,n,o=this;this.page_data=c,h=f({"class":"pictures-index"}),s.render({has_next_page:c.has_next_page,has_prev_page:c.has_prev_page,page:c.page,handler:function(b,c){var e;return e=function(){return d.page=b,o.search(a,d)},o.layout.history.push(e),e()}}).appendTo(h),k=f({"class":"pictures"}),c.results.length===0&&h.append(f({"class":"none",text:l.t("pictures.none")})),n=c.results;for(i=0,m=n.length;i<m;i++)j=n[i],f({"class":"gallery-item"}).append($("<img>",{"class":"imgscale",src:g.resolve_url(j.thumb_url)})).appendTo(k).data("picture-id",j.id);h.delegate("div.gallery-item","click",function(a){var d,e;return e=$(a.target).closest(".gallery-item").data("picture-id"),d=$(window),b.scrollTo=[d.scrollTop(),d.scrollLeft()],o.layout.open_tab(new u(o.layout,e,c.results))}),h.append(k),this.layout.set_content(h,{title:a});if(u.scrollTo&&this.layout.history.is_returning())return e=$(window),e.scrollTop(u.scrollTo[0]),u.scrollTo=null},b}(),c.pictures=v,u=function(){function a(a,b,c){this.layout=a,this.picture_id=b,this.pictures_list=c}return a.prototype.open=function(){var a=this;return this.layout.show_loading(),g.post("picture",{type:"GET",data:{id:this.picture_id},complete:function(b){return a.generate_view(b)}})},a.prototype.generate_view=function(a){var b,c,d,h,i,j,k,m,n,o,p,q,r=this;d=f({"class":"picture-view"}),d.html('<div class="head">\n  <div class="avatar"><img class="imgscale"></div>\n  <div class="data">\n    <div class="title"></div>\n    <div class="author"></div>\n    <div class="date"></div>\n  </div>\n</div>\n<div class="picture-wrapper">\n  <img class="main-picture" />\n</div>'),i=d.find(".avatar img"),i.attr("src",g.resolve_url(a.author_avatar_url)),d.find(".title").text(a.title),d.find(".author").text(a.author),d.find(".main-picture").attr("src",g.resolve_url(a.image_url)),d.find(".date").text(a.published_at);if(this.pictures_list){n=-1,q=this.pictures_list;for(h=0,p=q.length;h<p;h++){k=q[h];if(k.id===this.picture_id){n=h;break}}n>=0&&(m=f({"class":"pagination"}),m.appendTo(d),b=function(a,b){var c;c=f({"class":""+b+"-picture"}).appendTo(m),b==="prev"&&c.append($("<span>",{text:"<"})),$("<img>",{data:{picture:a.id},src:g.resolve_url(a.thumb_url)}).appendTo(c);if(b==="next")return c.append($("<span>",{text:">"}))},(j=this.pictures_list[n+1])&&b(j,"next"),n>0&&(o=this.pictures_list[n-1])&&b(o,"prev"),m.delegate("img","click",function(a){return r.picture_id=$(a.target).data("picture"),d.remove(),r.open()}))}return d.append(e.comments_box(a.comments,{token_id:a.token_id,title:a.title},this.layout,function(){return r.open()})),this.layout.set_content(d,{title:l.t("pictures.show.title")}),c=function(){if(d.is(":visible"))return $("#bottom-banner.fixed").removeClass("fixed"),setTimeout(c,100)},setTimeout(c,200),!0},a}(),r=function(){function a(a,b){this.layout=a,this.since=b}return a.prototype.open=function(){var a=this;return this.layout.show_loading(),g.post("news",{type:"GET",data:{since:this.since},complete:function(b){return a.generate(b)}})},a.prototype.generate=function(b){var c,d,e,h,i,j,k,m,n,o,q,r,s,t,u,v=this;e=f({"class":"news-section"}),b.invitations_count>0&&$("<a>",{"class":"notification-count",text:l.count("news.notifications.invitations",b.invitations_count),click:function(){return v.layout.open_tab(new p(v.layout,"invitations"))}}).appendTo(e),b.messages_count>0&&$("<a>",{"class":"notification-count",text:l.count("news.notifications.messages",b.messages_count),click:function(){return v.layout.open_tab(new p(v.layout,"inbox"))}}).appendTo(e),k=f({"class":"time-selector"}),k.appendTo(e),j=$("<select>"),j.appendTo(k),s=[["last","last"],["day",86400],["twodays",172800],["ultima_semana",604800],["ultimo_mes",2592e3]];for(n=0,q=s.length;n<q;n++)t=s[n],i=t[0],m=t[1],j.append($("<option>",{value:m,text:l.t("news.times."+i)}));j.val(this.since),j.change(function(){return v.layout.open_tab(new a(v.layout,j.val()))}),b.timeline.length===0&&e.append(f({"class":"none",text:l.t("news.none")})),u=b.timeline;for(o=0,r=u.length;o<r;o++)h=u[o],d=f({"class":"timeline-item hl-on-pressed"}),d.html('<div class="avatar"><img class="imgscale"></div>\n<div class="data">\n  <div>\n    <span class="login"></span> - <span class="author"></span>\n  </div>\n  <div class="published-at"></div>\n  <div class="content"></div>\n</div>'),d.find("img").attr("src",g.resolve_url(h.author_avatar_url)),d.find(".login").text(h.author_login),d.find(".author").text(h.author),d.find(".published-at").text(h.published_at),d.find(".content").text(h.content),d.data("url",h.url),d.appendTo(e);e.delegate(".timeline-item","click",function(a){var b;if(b=$(a.target).closest(".timeline-item").data("url"))return v.open_link(b)}),this.layout.set_content(e,{title:l.t("menu.news")});if(a.scrollTo&&this.layout.history.is_returning())return c=$(window),c.scrollTop(a.scrollTo[0]),a.scrollTo=!1},a.prototype.open_link=function(b){var c,d;return c=$(window),a.scrollTo=[c.scrollTop(),c.scrollLeft()],(d=/\/post\/([^/]+)$/.exec(b))?this.layout.open_tab(new w(this.layout,d[1])):(d=/\/foto.*\/([^/]+)$/.exec(b))?this.layout.open_tab(new u(this.layout,d[1])):location.href=b},a}(),c.news=r,a=function(){function a(a){this.layout=a}return a.prototype.open=function(){var a,b,c,d,e,g,h,i,j=this;c=f({"class":"alerts-settings"}),e=f({"class":"items"}).appendTo(c),i=["sound","lights","vibrate"];for(g=0,h=i.length;g<h;g++)d=i[g],b="alerts-settings-item-"+d,a=f({"class":"item"}).appendTo(e),a.append($("<input>",{"class":"widget",type:"checkbox",id:b,name:d})),a.append($("<label>",{text:l.t("alerts.items."+d),"for":b}));return this.layout.set_content(c,{title:l.t("alerts.title")}),PhoneGap.exec(function(a){var b,c,d;for(c in a){if(!z.call(a,c))continue;b=a[c],d=c.replace(/^use/,"").toLowerCase(),$(".alerts-settings input.widget[name="+d+"]").get(0).checked=b}},function(){return 0},"AlertsSettingsManager","get",[],!0),this.auto_styles(),c.delegate(".widget","change",function(a){return j.set_config(a.target.name,a.target.checked)})},a.prototype.set_config=function(a,b){var c;return c="use"+a.charAt(0).toUpperCase()+a.slice(1),PhoneGap.exec(function(){return 0},function(){return 0},"AlertsSettingsManager","set",[c,b],!0),this.auto_styles()},a.prototype.auto_styles=function(){var a,b,c,d,e,f;e=$(".alerts-settings .item"),f=[];for(c=0,d=e.length;c<d;c++)b=e[c],b=$(b),a=b.find("input.widget").get(0),a.checked?f.push(b.addClass("checked")):f.push(b.removeClass("checked"));return f},a}(),c.alerts=a,o=function(){function a(a){this.layout=a}return a.prototype.has_detailed_background=function(){return!1},a.prototype.open=function(){this.layout.app.log_out()},a}(),c.logout=o,f=function(){var a;return a=1<=arguments.length?A.call(arguments,0):[],$.apply(null,["<div>"].concat(A.call(a)))},b=function(){function a(){this.box=$(document.body),this.check_user()}return a.prototype.log_out=function(){Platform.phoneGap&&PhoneGap.exec(function(){return 0},function(){return 0},"ApiKeyManager","set",[""],!0),window.localStorage.clear(),this.layout.history.length=0,this.check_user()},a.prototype.check_user=function(){var a,b,c,d=this;a=window.localStorage.getItem("api_key");if(a){this.set_api_key(a);return}return b=window.localStorage.getItem("user_name"),c=window.localStorage.getItem("user_password"),b&&c?g.post("api_key",{async:!0,data:{user:b,password:c},error:function(){return alert(l.t("errors.connection")),navigator.device.exitApp()},complete:function(a){return a.is_valid?d.set_api_key(a.api_key):d.ask_user(!0)}}):this.ask_user(!1)},a.prototype.set_api_key=function(a){return g.current_key=a,window.localStorage.setItem("api_key",a),Platform.phoneGap&&PhoneGap.exec(function(){return 0},function(){return 0},"ApiKeyManager","set",[g.method_url("mailbox/short")+"?api_key="+encodeURIComponent(a)],!0),this.start()},a.prototype.ask_user=function(a){var b,c=this;return this.box.empty(),b=f({id:"login-dialog",height:$(window).height()}),$("<img>",{src:"images/logo.png"}).appendTo(f({"class":"header"}).appendTo(b)),a&&f({"class":"error",text:l.t("login.invalid_data")}).appendTo(b),$("<input>",{id:"user-name-field",placeholder:l.t("login.user_name")}).appendTo(f({"class":"form-field"}).appendTo(b)),$("<input>",{id:"user-password-field",placeholder:l.t("login.user_password"),type:"password"}).appendTo(f({"class":"form-field"}).appendTo(b)),$("<button>",{text:l.t("login.button_ok")}).click(function(a){return $("#login-dialog .error, #login-dialog input, #login-dialog button").hide(),f({text:l.t("login.indicator"),id:"indicator-text"}).appendTo(b),window.localStorage.setItem("user_name",$("#user-name-field").val()),window.localStorage.setItem("user_password",$("#user-password-field").val()),c.check_user()}).appendTo(b),$("<br>").appendTo(b),$("<button>",{"class":"forgot",text:l.t("login.forgot_password")}).click(function(a){return $("img, #login-dialog .error, #login-dialog input, #login-dialog button").hide(),h.render(b)}).appendTo(b),this.box.append(b)},a.prototype.start=function(){return this.box.empty(),this.layout=new m(this),this.layout.generate()},a}(),window.initApp=function(){var a;return a=$(document.body),$(window).width()<=320&&a.addClass("small-screen"),Platform.iOS&&a.addClass("iphone"),Platform.android&&a.addClass("android"),a.bind("touchstart",function(a){return $(a.target).parents().andSelf().filter(".hl-on-pressed").addClass("pressed")}),a.bind("touchend touchcancel touchmove",function(a){return $(a.target).parents().andSelf().filter(".hl-on-pressed").removeClass("pressed")}),window.App=new b},h={render:function(a){var b,c,d,e,h,i,j,k=this;return b={ready:!1},c=!1,e=null,i=function(){if(b.ready&&c)return $.post(g.resolve_url(b.url),{authenticity_token:b.authenticity_token,email:c},function(a){var b,c,f;return f=a.indexOf('<div class="error">'),f===-1?e.text(l.t("forgot_password.email_sent")):(b=a.indexOf("</div>",f),c=a.substr(f+19,b-f-19).replace(/^\s*/,"").replace(/\s*$/,""),alert(c),e.text(c),j.show(),d.show(),h.show())})},$.get(g.resolve_url("/reset_password"),function(a){var c,d,e,g,h,j,k,l;e=0,g=f();for(;;){h=a.indexOf("<form",e),c=a.indexOf("</form>",h),e=c+7;if(h===-1||c===-1)break;g.html(a.substr(h,c-h+7)),l=g.find("form");for(j=0,k=l.length;j<k;j++){d=l[j];if(d.action.indexOf("reset_password")!==-1){b={ready:!0,url:d.action,authenticity_token:$(d).find("input[name=authenticity_token]").val()},i();return}}}}),j=f({"class":"forgot-title",text:l.t("forgot_password.title")}).appendTo(a),e=f({"class":"forgot-help",text:l.t("forgot_password.help")}).appendTo(a),d=$("<input>",{placeholder:"E-Mail",id:"forgot-email"}).appendTo(a),$("<br>").appendTo(a),h=$("<button>",{text:l.t("login.button_ok")}).click(function(a){c=d.val();if(!/\S+@\S+\.\S+/.exec(c)){c=!1,alert(l.t("forgot_password.no_email"));return}return j.hide(),d.hide(),h.hide(),e.text(l.t("forgot_password.sending_request")),i()}).appendTo(a)}}})).call(this);

window.Platform = (function()  {
  var matchHttp = !!(/^http.*/.exec(location.protocol));
  var matchIPhone = !!(/iPhone/.exec(navigator.userAgent));
  var matchAndroid = !!(/Android/.exec(navigator.userAgent));

  return {
    android:  matchAndroid,
    iOS:      matchIPhone,
    web:      matchHttp,
    phoneGap: !matchHttp
  }
})();

