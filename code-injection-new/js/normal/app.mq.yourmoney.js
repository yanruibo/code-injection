


$( document ).on( "mobileinit", function() {
        $.mobile.defaultPageTransition = 'none';
    });







/*! yourwallet - v2.0.0 - 2014-08-23 */function updateExpense(){var $date=null,$str_date=null;$date=null==getLastLogin()?new Date:new Date(getLastLogin()),$date=new Date($date.getFullYear(),$date.getMonth(),$date.getDate());var $today=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate());$date.getTime()<=$today.getTime()&&db.transaction(function(tx){for(;$date.getTime()<=$today.getTime();){$str_date=$date.getFullYear()+"-"+($date.getMonth()+1)+"-"+$date.getDate();var $sql="SELECT *, '"+$str_date+"' AS today FROM ( 								SELECT e.id, e.idCategory, e.value, em.idExpende, e.day, e.bEveryMonth, e.month, m.date FROM expende e 								LEFT OUTER JOIN expende_has_movement em ON e.id = em.idExpende 								LEFT OUTER JOIN movement m ON m.id = em.idMovement 								ORDER BY m.id ASC 						    ) t1 							WHERE day='"+$date.getDate()+"' AND ( bEveryMonth=1 OR month='"+($date.getMonth()+1)+"' ) 							GROUP BY id ";tx.executeSql($sql,[],function(tx,results){if(results.rows.length>0)for(var i=0;i<results.rows.length;i++)(null==results.rows.item(i).idExpende||results.rows.item(i).date!=results.rows.item(i).today)&&insertNewExpense(tx,results.rows.item(i))}),$date=new Date($date.getTime()+864e5)}},errorCB)}function insertNewExpense(tx,$row){var $sql="INSERT INTO movement (idCategory, value, bIn, date, date_register) VALUES ('"+$row.idCategory+"', '"+$row.value+"', '0', '"+$row.today+"', date('now') )";tx.executeSql($sql,[],function(tx,results){tx.executeSql("INSERT INTO expende_has_movement (idExpende, idMovement) VALUES ('"+$row.id+"', '"+results.insertId+"')")})}function insertNewEarn(tx,$row){var $sql="INSERT INTO movement (idCategory, value, bIn, date, date_register) 				 VALUES ('"+$row.idCategory+"', '"+$row.value+"', '1', '"+$row.today+"', date('now') )";tx.executeSql($sql,[],function(tx,results){tx.executeSql("INSERT INTO gain_has_movement (idGain, idMovement) VALUES ('"+$row.id+"', '"+results.insertId+"')")})}function updateEarn(){var $date=null,$str_date=null;$date=null==getLastLogin()?new Date:new Date(getLastLogin()),$date=new Date($date.getFullYear(),$date.getMonth(),$date.getDate());var $today=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate());$date.getTime()<=$today.getTime()&&db.transaction(function(tx){for(;$date.getTime()<=$today.getTime();){$str_date=$date.getFullYear()+"-"+($date.getMonth()+1)+"-"+$date.getDate();var $sql="SELECT *, '"+$str_date+"' AS today FROM ( 								SELECT g.id, g.idCategory, g.value, gm.idGain, g.day, g.bEveryMonth, g.month, m.date FROM gain g 								LEFT OUTER JOIN gain_has_movement gm ON g.id = gm.idGain 								LEFT OUTER JOIN movement m ON m.id = gm.idMovement 								ORDER BY m.id ASC 						    ) t1 							WHERE day='"+$date.getDate()+"' AND ( bEveryMonth=1 OR month='"+($date.getMonth()+1)+"' ) 							GROUP BY id ";tx.executeSql($sql,[],function(tx,results){if(results.rows.length>0)for(var i=0;i<results.rows.length;i++)(null==results.rows.item(i).idGain||results.rows.item(i).date!=results.rows.item(i).today)&&insertNewEarn(tx,results.rows.item(i))}),$date=new Date($date.getTime()+864e5)}},errorCB,function(){setLastLogin()})}function checkcurrency(){var $local=window.localStorage,$coin=$local.getItem("config.coin");return null==$coin&&$local.setItem("config.coin",3),$local.getItem("config.coin")}function getCurrency(){var $local=window.localStorage,$coin=$local.getItem("config.coin");$coin=parseInt($coin);for(var i in $list_cur)if($list_cur[i].id==$coin)return $list_cur[i].symbol;return $list_cur[3].symbol}function setLastLogin(){{var $local=window.localStorage;$local.setItem("config.date_last_login",new Date)}return $local.getItem("config.date_last_login")}function getLastLogin(){var $local=window.localStorage,$date=$local.getItem("config.date_last_login");return $date}function populateDB(tx){tx.executeSql("CREATE TABLE IF NOT EXISTS category (id INTEGER PRIMARY KEY AUTOINCREMENT,  idParent INTEGER DEFAULT -1, name TEXT(100), bSpend INTEGER(1) DEFAULT 0, bCanRemoved INTEGER(1) DEFAULT 0, bDeleted INTEGER(1) DEFAULT 0,date_register DATETIME)"),tx.executeSql("CREATE TABLE IF NOT EXISTS movement (id INTEGER PRIMARY KEY AUTOINCREMENT, idCategory INTEGER, idPayMethod INTEGER DEFAULT -1, value TEXT(20), bIn INTEGER(1) DEFAULT 0, date DATETIME, bDeleted INTEGER(1) DEFAULT 0, obs TEXT(100), date_register DATETIME)"),tx.executeSql("CREATE TABLE IF NOT EXISTS pay_methods (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT(100) )"),tx.executeSql("CREATE TABLE IF NOT EXISTS gain (id INTEGER PRIMARY KEY AUTOINCREMENT, idCategory INTEGER, idPayMethod INTEGER DEFAULT -1, value TEXT(20),day INTEGER(2), month INTEGER(2), bEveryMonth INTEGER(1) DEFAULT 0, bNextMonth INTEGER(1) DEFAULT 0, bDeleted INTEGER(1) DEFAULT 0,date_register DATETIME)"),tx.executeSql("CREATE TABLE IF NOT EXISTS expende (id INTEGER PRIMARY KEY AUTOINCREMENT, idCategory INTEGER, idPayMethod INTEGER DEFAULT -1, value TEXT(20),day INTEGER, month INTEGER, bEveryMonth INTEGER DEFAULT 0, bNextMonth INTEGER DEFAULT 0, bDeleted INTEGER(1) DEFAULT 0,date_register DATETIME)"),tx.executeSql("CREATE TABLE IF NOT EXISTS gain_has_movement (idGain INTEGER, idMovement INTEGER, PRIMARY KEY(idGain, idMovement))"),tx.executeSql("CREATE TABLE IF NOT EXISTS expende_has_movement (idExpende INTEGER, idMovement INTEGER, PRIMARY KEY(idExpende, idMovement))"),tx.executeSql("SELECT count(*) AS n FROM pay_methods",[],function(tx,results){0==results.rows.item(0).n&&(tx.executeSql("INSERT INTO pay_methods (name) VALUES ( 'Cash' )"),tx.executeSql("INSERT INTO pay_methods (name) VALUES ( 'Check' )"),tx.executeSql("INSERT INTO pay_methods (name) VALUES ( 'Debit' )"),tx.executeSql("INSERT INTO pay_methods (name) VALUES ( 'Electronic Transfer' )"))}),tx.executeSql("SELECT count(*) AS n FROM category",[],function(tx,results){0==results.rows.item(0).n&&(tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES ( -1, 'Expenses', 1, 1,'2012-07-30 12:12:12')"),tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES ( -1, 'Incomes', 0, 0,'2012-07-30 12:12:12')"),tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES (1, 'Unclassified', 1, 1,'2012-07-30 12:12:12')"),tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES (1, 'Apparel', 1, 1,'2012-07-30 12:12:12')"),tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES (1, 'Fuel', 1, 1,'2012-07-30 12:12:12')"),tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES (1, 'Services', 1, 1,'2012-07-30 12:12:12')"),tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES (1, 'Eating out and bars', 1, 1,'2012-07-30 12:12:12')"),tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES (1, 'Chemist', 1, 1,'2012-07-30 12:12:12')"),tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES (1, 'Medical', 1, 1,'2012-07-30 12:12:12')"),tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES (1, 'Entertainment', 1, 1,'2012-07-30 12:12:12')"),tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES (1, 'Sport', 1, 1,'2012-07-30 12:12:12')"),tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES (1, 'Transport', 1, 1,'2012-07-30 12:12:12')"),tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES (1, 'Household bills', 1, 1,'2012-07-30 12:12:12')"),tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES ( 2, 'Salary', 0, 1,'2012-07-30 12:12:12')"),tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES ( 2, 'Parte-time', 0, 1,'2012-07-30 12:12:12')"),tx.executeSql("INSERT INTO category ( idParent, name, bSpend, bCanRemoved, date_register) VALUES ( 2, 'Allowance', 0, 1,'2012-07-30 12:12:12')"))})}function errorCB(err){console.log("SQL message: "+err.message),console.log("SQL code: "+err.code),toast.show(strings.general.dberror)}function onDeviceReady(){db=window.openDatabase("bd_youmoney","1.1","Data Base yourWallet",10485760),db.transaction(populateDB,errorCB,function(){updateExpense(),updateEarn(),$currency=checkcurrency()}),document.addEventListener("backbutton",function(){var activePage=$.mobile.activePage,backButton=activePage.find("#page-back"),leftMenuPanel=$("#main-panel"),popups=$(".ui-popup-active");leftMenuPanel.hasClass("ui-panel-open")?navigator.app.exitApp():popups.length>0?popups.find('div[data-role="popup"]').popup("close"):backButton.length>0?backButton.click():leftMenuPanel.panel("open")},!1),$(function(){app.init(),app.home.init(),app.expense.init(),app.income.init(),app.settings.init(),app.schedules.init(),app.schedulesincome.init(),app.schedulesexpense.init(),app.categories.init(),app.balance.init(),app.loadpage.init()})}function format($var){$var=$var.toString();var $regx=null,$result="";if($regx=/^(\+|\-)?[0-9]+$/,$regx.test($var)&&($result=$var+".00"),$regx=/^[\.]{1}[0-9]{1}$/,$regx.test($var)&&($result="0"+$var+"0"),$regx=/^[\.]{1}[0-9]{2}$/,$regx.test($var)&&($result="0"+$var),$regx=/^[\.]{1}[0-9]{3,}$/,$regx.test($var)){var $tmp=$var.split(".");$result="0."+$tmp[1].substring(0,2)}if($regx=/^[0-9]+[\.]{1}$/,$regx.test($var)&&($result=$var+"00"),$regx=/^[0-9]+[\.]{1}[0-9]{1}$/,$regx.test($var)&&($result=$var+"0"),$regx=/^[0-9]+[\.]{1}[0-9]{2}$/,$regx.test($var)&&($result=$var),$regx=/^[0-9]+[\.]{1}[0-9]{3,}$/,$regx.test($var)){var $tmp=$var.split(".");$result=$tmp[0]+"."+$tmp[1].substring(0,2)}return $result.length>11&&($result=""),$result}var app=function($){function init(){FastClick.attach(document.body),$("#main-panel").panel().enhanceWithin(),$("[data-role='header'], [data-role='footer']").toolbar(),$(document).on("touchstart",".has-active-state",function(){$(this).addClass("active")}),$(document).on("touchend touchcancel",".has-active-state",function(){$(this).removeClass("active")}),$(document).on("click",".header-action",function(){var action=$(this).data("action");"menu"===action?$("#main-panel").panel("open"):$.mobile.pageContainer.pagecontainer("change",$(this).data("href"))}),$(document).on("vclick","#date",function(){var options={date:new Date($(this).val()),mode:"date"};datePicker.show(options,function(date){if(date&&"Invalid Date"!=date){var date=new Date(date),year=date.getFullYear(),month=date.getMonth()+1<10?"0"+(date.getMonth()+1):date.getMonth()+1,day=date.getDate()<10?"0"+date.getDate():date.getDate();$("#date").val(year+"-"+month+"-"+day)}})}),$(document).on("keydown",".field-currency",function(event){event.keyCode>=48&&event.keyCode<=57||190==event.keyCode||8==event.keyCode||event.preventDefault()}),$(document).on("focusout",".field-currency",function(){var $var=$(this).val();$var=format($var),$(this).val($var)}),$(document).on("click",".bt-home",function(event){event.preventDefault();var $href=$(this).attr("ref");$.mobile.pageContainer.pagecontainer("change",$href)})}return{init:init}}(jQuery);app.schedules={expense:null,income:null},app.balance=function(){function init(){var balance_obj={year:null,month:null};$(document).on("pageshow","#page-balance",function(){var $this=this;if(null==balance_obj.year){var $date=new Date;balance_obj.year=$date.getFullYear(),balance_obj.month=$date.getMonth()+1}var $tmp_month=balance_obj.month;balance_obj.month<10&&($tmp_month="0"+$tmp_month);var $row=null;$(this).find("#list-hist").find("li").remove(),$(this).find("#balance-not-results").addClass("display-none");var $ym=balance_obj.year+"-"+$tmp_month,wincome=app.db.getMonthSum("income",$ym),wexpense=app.db.getMonthSum("expense",$ym);$.when(wincome,wexpense).done(function(sincome,sexpense){var $earns=sincome.sum,$spend=sexpense.sum,$balance=$earns-$spend;$balance=0>$balance?"-"+format($balance.toString().replace("-","")):format($balance),$($this).find("#value-earns").html(($earns?format($earns):"0.00")+" "+getCurrency()),$($this).find("#value-expenses").html(($spend?format($spend):"0.00")+" "+getCurrency()),$($this).find("#value-balance").html(($balance?$balance:"0.00")+" "+getCurrency()),0>$earns-$spend?$($this).find("#value-balance").css("color","red"):$($this).find("#value-balance").css("color","green")}),db.transaction(function(tx){var $sql='SELECT m.*, c.name, cp.name AS name_cp, m.date FROM movement m INNER JOIN category c ON c.id = m.idCategory INNER JOIN category cp ON c.idParent = cp.id WHERE m.bDeleted=0 AND strftime("%Y", m.date)="'+balance_obj.year+'" AND strftime("%m", m.date)="'+$tmp_month+'" ORDER BY m.date DESC';tx.executeSql($sql,[],function(tx,results){var html="";if(results.rows.length>0){for(var i=0;i<results.rows.length;i++)$row=results.rows.item(i),html+='<li data-split-icon="delete" ><a ref="'+$row.id+'" class="view-movement" ><h3>'+($row.bIn?"+":"-")+"  "+format($row.value)+" "+getCurrency()+"</h3><p>"+$row.date+" "+$row.name_cp+" "+$row.name+'</p></a><span class="delete-movement has-active-state" ref="'+$row.id+'" ><div><i class="fa fa-times" ></i></div></span></li>';$($this).find("#list-hist").append(html),$($this).find("#regist-list").show()}else $($this).find("#regist-list").hide(),$($this).find("#balance-not-results").removeClass("display-none");$($this).find("#list-hist").listview("refresh",!0),loadPlot(balance_obj.year,$tmp_month)})},errorCB),$($this).find("#balance-year").html(balance_obj.year),$($this).find("#balance-month").html($months[balance_obj.month])}),$(document).on("click",".view-movement",function(){var $id=$(this).attr("ref");db.transaction(function(tx){var $sql="SELECT m.value, m.obs, m.bIn, m.date, c.name AS category, pm.name AS pay_method FROM movement m JOIN category c ON m.idCategory = c.id LEFT JOIN pay_methods pm ON m.idPayMethod = pm.id WHERE m.id = "+$id;tx.executeSql($sql,[],function(tx,results){$row=results.rows.item(0),$("#popupBasic").popup({corners:!1,history:!1,shadow:!0,tolerance:"5,15,5,15"}),$("#popupBasic").find("#info_type").html("1"==$row.bIn?"Income":"Expense"),$("#popupBasic").find("#info_amount").html($row.value),$("#popupBasic").find("#info_date").html($row.date),$("#popupBasic").find("#info_category").html($row.category),$("#popupBasic").find("#info_pay_method").html($row.pay_method),$("#popupBasic").find("#info_obs").html($row.obs),$("#popupBasic").popup("open",{dismissible:!0})})},function(){toast.show(strings.balance.viewinsuccess)})}),$(document).on("vclick",".delete-movement",function(){var $id=$(this).attr("ref");navigator.notification.confirm("Do you want delete this movement?",function(index){1==index&&db.transaction(function(tx){tx.executeSql("UPDATE movement SET bDeleted=1 WHERE id="+$id)},function(){toast.show(strings.balance.removeinsuccess)},function(){toast.show(strings.balance.removesuccess),$("#page-balance").trigger("pageshow")})},"Confirm","Yes,No")}),$(document).on("click","#balance-prev",function(event){event.preventDefault(),1==balance_obj.month?(balance_obj.month=12,balance_obj.year--):balance_obj.month--,$("#page-balance").trigger("pageshow")}),$(document).on("vclick","#balance-next",function(event){event.preventDefault(),12==balance_obj.month?(balance_obj.month=1,balance_obj.year++):balance_obj.month++,$("#page-balance").trigger("pageshow")})}function loadPlot(year,month){db.transaction(function(tx){$sql="SELECT * FROM ( SELECT c.id ,c.name, SUM(m.value) AS csum  FROM movement m JOIN category c ON m.idCategory = c.id WHERE m.bDeleted=0 AND m.bIn=0 AND strftime('%Y%m', m.date)='"+year+month+"' GROUP BY c.id ) tb1 ORDER BY csum DESC",tx.executeSql($sql,[],function(tx,results){for(var $arr=new Array,i=0;i<results.rows.length;i++)$row=results.rows.item(i),$row.csum=format($row.csum),$arr.push({name:$row.name,value:$row.csum});$arr.length>0?($("#balance-chart-container").empty(),$("#balance-chart-container").html('<canvas id="balance-chart-canvas" width="150" height="150"></canvas>'),$("#balance-chart-canvas").css({height:"150px",width:"150px"}),$("#balance-chart").show(),buildPlot($arr)):$("#balance-chart").hide()})},errorCB)}function buildPlot(arr){var colors=["#F7464A","#AB51C4","#A3D141","#949FB1","#4D5360","#00a6cd","#3FB572","#F79C3B"],data=[],total=0;for(var i in arr)7==i?(data[i]=arr[i],data[i].name=strings.balance.others,data[i].value=arr[i].value,data[i].color=colors[i]):i>7?data[7].value+=arr[i].value:(data[i]=arr[i],data[i].color=colors[i]),total+=arr[i].value;var ctx=$("#balance-chart-canvas").get(0).getContext("2d");new Chart(ctx).Doughnut(data,{onAnimationComplete:function(){}});var labels="";for(var i in data)labels+='<span class="label-'+data[i].color.replace("#","")+'" >'+data[i].name+" "+format(data[i].value)+getCurrency()+" ("+getPercentage(total,data[i].value)+"%)</span>";$("#balance-chart-labels").html(labels)}function getPercentage(total,amount){return Math.round(100*amount/total)}return{init:init}}(jQuery),app.categories=function($){function init(){$(document).on("pageshow","#page-categories",function(){_buildListCategories()}),$(document).on("vclick",".bt-delete-category",function(){var $id=$(this).data("id"),name=$(this).data("name");navigator.notification.confirm(Mustache.render(strings.categories.confirmdelete,{name:name}),function(index){1==index&&db.transaction(function(tx){tx.executeSql("UPDATE category SET bDeleted=1 WHERE id="+$id+" AND bDeleted=0")},function(){toast.show(strings.categories.removeinsuccess)},function(){toast.show(strings.categories.removesuccess),_buildListCategories()})},strings.confirm,strings.yesno)}),$(document).on("click","#bt-add-category",function(event){event.preventDefault(),$.mobile.pageContainer.pagecontainer("change","#page-add-category")}),$(document).on("pagebeforeshow","#page-add-category",function(){var $this=this;$($this).find("#name").val("")}),$(document).on("pageshow","#page-add-category",function(){var categories=$(this).find("#select-category");categories.empty(),categories.append('<option value="-1">'+strings.general.chooseone+"</option>"),db.transaction(function(tx){tx.executeSql("SELECT * FROM category WHERE idParent=-1 AND bDeleted=0 ORDER BY name ASC",[],function(tx,results){for(var i=0;i<results.rows.length;i++)$row=results.rows.item(i),categories.append('<option value="'+$row.id+'">'+$row.name+"</option>");categories.selectmenu("refresh",!0)})}),$(this).trigger("create")}),$(document).on("click","#bt-save-category",function(){var $name=$("#page-add-category").find("#name").val(),$idCategory=$("#page-add-category").find("#select-category").val();if("-1"==$idCategory)return navigator.notification.alert('Please select a "Category".',null,"Validation","OK"),!1;if(0==$name.length)return navigator.notification.alert('Field "Name" is required.',null,"Validation","OK"),!1;var $bSpend="1"==$idCategory?"1":"0";db.transaction(function(tx){tx.executeSql('INSERT INTO category (idParent,name,bSpend,bCanRemoved,date_register) VALUES ("'+$idCategory+'","'+$name+'", "'+$bSpend+'", 1, date("now"))')},function(){toast.show(strings.categories.addinsuccess)},function(){toast.show(strings.categories.addsuccess),$.mobile.pageContainer.pagecontainer("change","#page-categories")})})}function _buildListCategories(){var $row=null,$row1=null,categories=$("#list-category");categories.empty(),db.transaction(function(tx){tx.executeSql("SELECT * FROM category WHERE idParent=-1 AND bDeleted=0",[],function(tx,results){for(var i=0;i<results.rows.length;i++)$row=results.rows.item(i),categories.append('<li id="category-'+$row.id+'" data-role="list-divider"  >'+$row.name+"</li>"),tx.executeSql("SELECT * FROM category WHERE idParent="+$row.id+" AND bDeleted=0 ORDER BY name DESC",[],function(tx,results1){for(var html="",i=0;i<results1.rows.length;i++)$row1=results1.rows.item(i),html+='<li data-split-theme="d"><a href="#">'+$row1.name+'</a><span data-id="'+$row1.id+'" data-name="'+$row1.name+'" class="bt-delete-category has-active-state" ><div><i class="fa fa-times" ></i></div></span></li>';categories.find("li#category-"+$row1.idParent).after(html),categories.listview("refresh")})})},function(){})}return{init:init}}(jQuery),app.expense=function($){function _focusAmountField(){setTimeout(function(){$("#page-expende").find("#value").focus().click()},200)}function init(){$(document).on("pageshow","#page-expende",function(){_focusAmountField();var category=$(this).find("#category"),paymethod=$(this).find("#pay_method"),date=new Date,dia=date.getDate(),mes=date.getMonth(),ano=date.getFullYear();dia=10>dia?"0"+dia:dia,mes=9>mes?"0"+(mes+1):mes+1,$("#date").val(ano+"-"+mes+"-"+dia),$(this).find(".l-currency").html(getCurrency()),category.empty(),category.append('<option value="-1">'+strings.general.chooseone+"</option>"),app.db.getCategories("expense").done(function(results){for(var i=0;i<results.rows.length;i++)category.append('<option value="'+results.rows.item(i).id+'">'+results.rows.item(i).name+"</option>");category.selectmenu("refresh",!0)}),app.db.getPayMethods().done(function(results){for(var i=0;i<results.rows.length;i++)paymethod.append("<option "+(0==i?'selected="selected"':"")+' value="'+results.rows.item(i).id+'">'+results.rows.item(i).name+"</option>");paymethod.selectmenu("refresh",!0)})}),$(document).on("click","#bt-save-expende",function(){var pageexpense=$("#page-expende"),$value=pageexpense.find("#value").val(),$date=pageexpense.find("#date").val(),$category=pageexpense.find("#category").val(),$pay_method=pageexpense.find("#pay_method").val(),$obs=pageexpense.find("#obs").val(),$regdate=/^[0-9]{4}[\-]{1}[0-9]{2}[\-]{1}[0-9]{2}$/,$msg="";return 0==$value.length?$msg=strings.expense.amountr:$regdate.test($date)?"-1"==$category&&($msg=strings.expense.categoryr):$msg=strings.expense.dater,$msg.length>0?(navigator.notification.alert($msg,null,strings.general.titlealert,strings.general.btalert),!1):void db.transaction(function(tx){tx.executeSql("INSERT INTO movement (idCategory, idPayMethod, value, date, bIn, obs, date_register) VALUES ("+$category+',"'+$pay_method+'","'+$value+'","'+$date+'", 0 , "'+$obs+'", date("now"))')},function(){toast.show(strings.expense.insuccess)},function(){toast.show(strings.expense.success),$.mobile.pageContainer.pagecontainer("change","#page-home")})})}return{init:init}}(jQuery),app.home=function($,app){function init(){$(document).on("pageshow","#page-home",function(){_loadResume()}),$("#page-home").trigger("pageshow")}function _loadResume(){var wincome=null,wexpense=null,today=new Date,year=today.getFullYear(),month=today.getMonth()+1,self=$("#page-home");month=10>month?"0"+month:month,wincome=app.db.getMonthSum("income",year+"-"+month),wexpense=app.db.getMonthSum("expense",year+"-"+month),$.when(wincome,wexpense).done(function(sincome,sexpense){var $earns=sincome.sum,$spend=sexpense.sum,$balance=$earns-$spend,percentage=100*$balance/$earns||0;percentage=Math.round(percentage),$balance=$balance?format($balance):"0.00",$(self).find("#resume-income").html(($earns?format($earns):"0.00")+" "+getCurrency()),$(self).find("#resume-expense").html(($spend?format($spend):"0.00")+" "+getCurrency()),$(self).find("#resume-balance").html($balance+" "+getCurrency()),$(self).find("#resume-percentage").html(percentage+"%"),$.isNumeric(percentage)?$(self).find("#resume-percentage").removeClass("display-none"):$(self).find("#resume-percentage").addClass("display-none"),0>$balance?($(self).find("#resume-balance").addClass("negative-balance"),$(self).find("#resume-percentage").addClass("negative-balance")):($(self).find("#resume-balance").addClass("positive-balance"),$(self).find("#resume-percentage").addClass("positive-balance"))})}return{init:init}}(jQuery,app),app.income=function($,app){function init(){$(document).on("pageshow","#page-earn",function(){var date=new Date,dia=date.getDate(),mes=date.getMonth(),ano=date.getFullYear(),categories=$(this).find("#category"),paymethod=$(this).find("#pay_method");dia=10>dia?"0"+dia:dia,mes=9>mes?"0"+(mes+1):mes+1,$(this).find("#date").val(ano+"-"+mes+"-"+dia),$(this).find(".l-currency").html(getCurrency()),categories.empty(),categories.append('<option value="-1">'+strings.general.chooseone+"</option>"),app.db.getCategories("income").done(function(results){for(var i=0;i<results.rows.length;i++)categories.append('<option value="'+results.rows.item(i).id+'">'+results.rows.item(i).name+"</option>");categories.selectmenu("refresh",!0)}),app.db.getPayMethods().done(function(results){for(var i=0;i<results.rows.length;i++)paymethod.append("<option "+(0==i?'selected="selected"':"")+' value="'+results.rows.item(i).id+'">'+results.rows.item(i).name+"</option>");paymethod.selectmenu("refresh",!0)})}),$(document).on("click","#bt-save-earn",function(){var $this=$("#page-earn"),$value=$($this).find("#value").val(),$date=$($this).find("#date").val(),$category=$($this).find("#category").val(),$pay_method=$($this).find("#pay_method").val(),$obs=$($this).find("#obs").val(),$regdate=/^[0-9]{4}[\-]{1}[0-9]{2}[\-]{1}[0-9]{2}$/,$msg="";return 0==$value.length?$msg='Field "Amount" is required.':$regdate.test($date)?"-1"==$category&&($msg='Please select a "Category".'):$msg='Field "Date" is required.',$msg.length>0?(navigator.notification.alert($msg,null,"Validation","OK"),!1):void db.transaction(function(tx){tx.executeSql("INSERT INTO movement (idCategory, idPayMethod, value, date, bIn, obs, date_register) VALUES ("+$category+',"'+$pay_method+'","'+$value+'","'+$date+'", 1, "'+$obs+'", date("now"))')},function(){toast.show(strings.income.insuccess)},function(){toast.show(strings.income.success),$.mobile.pageContainer.pagecontainer("change","#page-home")})})}return{init:init}}(jQuery,app),app.schedulesexpense=function($){function init(){$(document).on("pagebeforeshow","#page-add-spend",function(){$(this).find("#value").val(""),$(this).find("#select-day")[0].selectedIndex=0,$(this).find("#select-day").selectmenu("refresh",!0),$(this).find("#select-month")[0].selectedIndex=0,$(this).find("#select-month").selectmenu("refresh",!0)}),$(document).on("pageshow","#page-add-spend",function(){$isSchedule=1;var $this=this;$(this).find("#select-category").empty(),$(this).find("#select-category").append('<option value="-1">'+strings.general.chooseone+"</option>"),$(this).find(".l-currency").html(getCurrency());var wexpense=app.db.getCategories("expense"),wpaymethod=app.db.getPayMethods();$.when(wexpense,wpaymethod).always(function(){console.log("done")}).done(function(dataexpense,datapaymethod){for(var i=0;i<dataexpense.rows.length;i++)$row=dataexpense.rows.item(i),$($this).find("#select-category").append('<option value="'+$row.id+'">'+$row.name+"</option>");for(var i=0;i<datapaymethod.rows.length;i++)$row=datapaymethod.rows.item(i),$($this).find("#pay_method").append('<option value="'+$row.id+'">'+$row.name+"</option>");$($this).find("#pay_method").selectmenu("refresh",!0),$("#select-category").selectmenu("refresh",!0)})}),$(document).on("click","#bt-save-spend",function(){var $this=$("#page-add-spend"),$value=$($this).find("#value").val(),$cat=$($this).find("#select-category").find("option:selected").val(),$method=$($this).find("#pay_method").val(),$day=$($this).find("#select-day").find("option:selected").val(),$everym=$($this).find("#everymonth").is(":checked")?1:0,$month=$($this).find("#select-month").find("option:selected").val(),$arr=new Array;return 0==$value.length?$arr.push('Field "Amount" is required.'):"-1"==$cat?$arr.push('Please select a "Category".'):"-1"==$day?$arr.push('Please select a "Day".'):$everym||"-1"!=$month||$arr.push('Please select a "Month".'),$arr.length>0?(navigator.notification.alert($arr[0],null,"Validation","OK"),!1):void db.transaction(function(tx){tx.executeSql('INSERT INTO expende (idCategory, idPayMethod, value, day, month,bEveryMonth, date_register)VALUES ("'+$cat+'", "'+$method+'", "'+$value+'", "'+$day+'", "'+$month+'", "'+$everym+'", date("now"))')},function(){toast.show(strings.schedules.addinsuccess)},function(){toast.show(strings.schedules.addsuccess),$.mobile.pageContainer.pagecontainer("change","#page-schedules-expense")})}),$(document).on("change","#page-add-spend #everymonth",function(){$(this).is(":checked")?$("#page-add-spend").find("#show-espefice-month").css("display","none"):$("#page-add-spend").find("#show-espefice-month").css("display","")})}return{init:init}}(jQuery),app.schedulesincome=function($){function init(){$(document).on("pagebeforeshow","#page-add-earn",function(){$(this).find("#select-day")[0].selectedIndex=0,$(this).find("#select-day").selectmenu("refresh",!0),$(this).find("#select-month")[0].selectedIndex=0,$(this).find("#select-month").selectmenu("refresh",!0),$(this).find("#value").val("")}),$(document).on("pageshow","#page-add-earn",function(){$isSchedule=1;var $this=this;$(this).find("#category").empty(),$(this).find("#category").append('<option value="-1">'+strings.general.chooseone+"</option>"),$($this).find(".l-currency").html(getCurrency());var wincome=app.db.getCategories("income"),wpaymethod=app.db.getPayMethods();$.when(wincome,wpaymethod).always(function(){console.log("done")}).done(function(dataincome,datapaymethod){for(var i=0;i<dataincome.rows.length;i++)$($this).find("#category").append('<option value="'+dataincome.rows.item(i).id+'">'+dataincome.rows.item(i).name+"</option>");$($this).find("#category").selectmenu("refresh",!0);for(var i=0;i<datapaymethod.rows.length;i++)$row=datapaymethod.rows.item(i),$($this).find("#pay_method").append('<option value="'+$row.id+'">'+$row.name+"</option>");$($this).find("#pay_method").selectmenu("refresh",!0)}),$(this).trigger("create")}),$(document).on("click","#bt-add-earn",function(){{var $this=$("#page-add-earn"),$value=$($this).find("#value").val(),$catergory=$($this).find("#category").val(),$method=$($this).find("#pay_method").val(),$day=$($this).find("#select-day").val(),$everymonth=$($this).find("#everymonth").is(":checked")?1:0,$month=$($this).find("#select-month").val();$($this).find("#next-month").is(":checked")?1:0}return""==$($this).find("#value").val()?(navigator.notification.alert('Field "Amount" is required',null,"Validation","OK"),!1):"-1"==$catergory?(navigator.notification.alert('Please select a "Category".',null,"Validation","OK"),!1):"*"==$($this).find("#select-day").val()?(navigator.notification.alert('Field "Day" is required',null,"Validation","OK"),!1):"*"!=$($this).find("#select-month").val()||$($this).find("#everymonth").is(":checked")?void db.transaction(function(tx){tx.executeSql('INSERT INTO gain (idCategory, idPayMethod, value, day, month, bEveryMonth, date_register )VALUES("'+$catergory+'", "'+$method+'", "'+$value+'", "'+$day+'", "'+$month+'", "'+$everymonth+'", date("now"))')},function(){},function(){$.mobile.pageContainer.pagecontainer("change","#page-schedules")}):(navigator.notification.alert('Field "Month" is required',null,"Validation","OK"),!1)}),$(document).on("change","#page-add-earn #everymonth",function(){$(this).is(":checked")?$("#page-add-earn").find("#show-espefice-month").css("display","none"):$("#page-add-earn").find("#show-espefice-month").css("display","")})}return{init:init}}(jQuery),app.schedules=function($){function init(){$(document).on("pageshow","#page-schedules",function(){_buildListScheduleIncome(),$(this).trigger("create")}),$(document).on("pageshow","#page-schedules-expense",function(){_buildListScheduleExpense(),$(this).trigger("create")}),$(document).on("click","#bt-add-income",function(event){event.preventDefault(),$.mobile.pageContainer.pagecontainer("change","#page-add-earn")}),$(document).on("click","#bt-add-expense",function(event){event.preventDefault(),$.mobile.pageContainer.pagecontainer("change","#page-add-spend")}),$(document).on("vclick",".bt-spend-delete",function(){var $id=$(this).attr("ref");navigator.notification.confirm("Do you want delete this Scheduled Expense?",function(index){1==index&&db.transaction(function(tx){tx.executeSql("UPDATE expende SET bDeleted=1 WHERE id='"+$id+"' AND bDeleted=0")
},function(){toast.show(strings.schedules.removeinsuccess)},function(){toast.show(strings.schedules.removesuccess),_buildListScheduleExpense()})},"Confirm","Yes,No")}),$(document).on("vclick",".bt-earns-delete",function(){var $idEarn=$(this).attr("ref");navigator.notification.confirm("Do you want delete this Scheduled Income?",function(index){1==index&&db.transaction(function(tx){tx.executeSql("UPDATE gain SET bDeleted=1 WHERE id="+$idEarn)},function(){toast.show(strings.schedules.removeinsuccess)},function(){toast.show(strings.schedules.removesuccess),_buildListScheduleIncome()})},"Confirm","Yes,No")}),$(document).on("click","#bt-open-schedules-expense",function(){$.mobile.pageContainer.pagecontainer("change","#page-schedules-expense")}),$(document).on("click","#bt-open-schedules-income",function(){$.mobile.pageContainer.pagecontainer("change","#page-schedules")})}function _buildListScheduleExpense(){$("#list-expense").find("li:gt(0)").remove();var $sql="SELECT expende.id, expende.value, expende.month, expende.day, expende.bEveryMonth, category.name FROM expende INNER JOIN category ON expende.idCategory = category.id WHERE expende.bDeleted=0";db.transaction(function(tx){tx.executeSql($sql,[],function(tx,results){if(results.rows.length>0)for(var i=0;i<results.rows.length;i++)$row=results.rows.item(i),$text="1"==$row.bEveryMonth?"Every month":"Month: "+$months[$row.month],$text+=", Day:"+$row.day+" ("+$row.name+") ",$("#list-expense").append('<li><a href="#"><h3>'+$row.value+" "+getCurrency()+"</h3><p>"+$text+'</p></a><span ref="'+$row.id+'" data-theme="d" class="bt-spend-delete has-active-state" ><div><i class="fa fa-times" ></i></div></span></li>');else $("#list-expense").append("<li>No results.</li>");$("#list-expense").listview("refresh")})},errorCB)}function _buildListScheduleIncome(){var $sql="SELECT gain.id, gain.value, gain.month, gain.day, gain.bEveryMonth, category.name FROM gain INNER JOIN category ON category.id = gain.idCategory WHERE gain.bDeleted=0 ";$("#list-income").find("li:gt(0)").remove(),db.transaction(function(tx){tx.executeSql($sql,[],function(tx,results){if(results.rows.length>0)for(var i=0;i<results.rows.length;i++)$row=results.rows.item(i),$text="1"==$row.bEveryMonth?"Every month":"Month: "+$months[$row.month],$text+=", Day:"+$row.day+" ("+$row.name+") ",$("#list-income").append('<li ><a href="#"><h3>'+$row.value+" "+getCurrency()+"</h3><p>"+$text+'</p></a><span ref="'+$row.id+'" class="bt-earns-delete has-active-state" ><div><i class="fa fa-times" ></i></div></span></li>');else $("#list-income").append("<li>No results.</li>");$("#list-income").listview("refresh")})},errorCB)}return{init:init}}(jQuery),app.settings=function($){function init(){$(document).on("pageshow","#page-settings",function(){for(var $coin=window.localStorage.getItem("config.coin"),coins=$(this).find("#coins"),i=0;i<$list_cur.length;i++)coins.append('<input type="radio" name="currency" id="currency-'+$list_cur[i].id+'" value="'+$list_cur[i].id+'" /><label for="currency-'+$list_cur[i].id+'">'+$list_cur[i].name+" ( "+$list_cur[i].symbol+" )</label>");$(this).trigger("create"),$.each($(this).find("input[type=radio]"),function(i,val){$(val).val()==$coin&&$(val).attr("checked",!0).checkboxradio("refresh")})}),$(document).on("change","#page-settings input[type=radio]",function(){var $local=window.localStorage,$id=$(this).val();$local.setItem("config.coin",$id)})}return{init:init}}(jQuery),app.db=function($){function _getCategories(parent){function errorDB(error){deferred.reject(error)}var deferred=$.Deferred(),sql="";return db.transaction(function(tx){sql='SELECT * FROM category WHERE bDeleted=0 AND idParent="'+parent+'" ORDER BY name ASC',tx.executeSql(sql,[],function(tx,results){deferred.resolve(results)},errorDB)},errorDB),deferred.promise()}function getCategories(type){var type=type||"expense";return _getCategories("income"===type?2:1)}function getPayMethods(){function errorDB(error){deferred.reject(error)}var deferred=$.Deferred(),sql="SELECT * FROM pay_methods ";return db.transaction(function(tx){tx.executeSql(sql,[],function(tx,results){deferred.resolve(results)},errorDB)},errorDB),deferred.promise()}function _getMonthSum(type,yearmonth){var deferred=$.Deferred(),sql="SELECT sum(m.value) AS sum FROM movement m WHERE bIn="+type+" AND m.bDeleted=0 AND strftime('%Y-%m', m.date)='"+yearmonth+"' ";return db.transaction(function(tx){tx.executeSql(sql,[],function(tx,results){var sum=results.rows.item(0).sum||"0";deferred.resolve({sum:parseFloat(sum)})})},function(){deferred.reject()}),deferred.promise()}function getMonthSum(type,yearmonth){return"income"==type?_getMonthSum(1,yearmonth):_getMonthSum(0,yearmonth)}return{getCategories:getCategories,getPayMethods:getPayMethods,getMonthSum:getMonthSum}}(jQuery);var $months=["","January","February","March","April","May","June","July","August","September","October","November","December"],db=null,$canExit=1,$isSchedule=0,$list_cur=[{id:1,name:"Britsh Pounds",symbol:"&#163;"},{id:2,name:"Dollar",symbol:"$"},{id:3,name:"Euro",symbol:"&#8364;"}];document.addEventListener("deviceready",onDeviceReady,!1),$(function(){var selectedlink="",panel=$("#main-panel");$(document).on("click","#logout",function(){navigator.app.exitApp()}),$(document).on("click","#main-panel .is-link",function(){selectedlink=$(this).data("link"),panel.panel("close")}),panel.panel({close:function(){selectedlink.length>0&&($.mobile.pageContainer.pagecontainer("change",selectedlink),selectedlink="")}})}),app.loadpage=function($){function init(){$(function(){function _getTemplate(page){return $("#tmp-"+page.replace("#","")).html()}function _renderPage(page){var template=_getTemplate(page),html=Mustache.render(template,strings);$(page).html(html),$(page).enhanceWithin()}var previousPage=$.mobile.activePage.attr("id");_renderPage("#page-home"),$(document).on("pagebeforechange",function(e,data){previousPage=$.mobile.activePage.attr("id"),"string"==typeof data.toPage&&data.toPage.replace("#","")!=previousPage&&_renderPage(data.toPage)}),$(document).on("pagechange",function(){var currentPage=$.mobile.activePage.attr("id");currentPage!=previousPage&&$("#"+previousPage).empty()}),$("#accounts-page").trigger("pageshow")})}return{init:init}}(jQuery);var strings={general:{amount:"Amount",date:"Date",category:"Category",paymethod:"Pay Method",obs:"Notes",save:"Save",chooseone:"Choose One",btalert:"OK",titlealert:"Ups!",name:"Name",cancel:"Cancel",day:"Day",month:"Mounth",balance:"Balance",type:"Type",yesno:"Yes,No",confirm:"Confirm",dberror:"Unknown error occurred during the process."},pages:{home:"Home",expense:"Expense",income:"Income",balance:"Balance",help:"Help",about:"About",settings:"Settings",schedules:"Schedules",categories:"Categories",addcategory:"New Category",addincome:"New Schedule Income",addexpense:"New Schedule Expense"},home:{newexpense:"Add Expense",newincome:"Add Income",balance:"Balance"},expense:{amountr:"Field Amount is required.",dater:"Field Date is required.",categoryr:"Please select a Category.",success:"Expense added successfully.",insuccess:"It's not possible add the expense."},income:{success:"Income added successfully.",insuccess:"It's not possible add the income."},settings:{choosecurrency:"Choose a currency"},schedules:{tabincome:"Income",tabexpense:"Expense",addincome:"Schedule Income",addexpense:"Schedule Expense",incomelist:"Incomes Scheduled List",expenselist:"Expenses Scheduled List",everymonth:"For every month",addsuccess:"Schecule create successfully.",addinsuccess:"It's not possible create the schedule.",removesuccess:"Schedule removed successfully.",removeinsuccess:"It's not possible remove the schedule."},categories:{add:"Add Category",confirmdelete:'Do you want delete category "{{name}}"?',addsuccess:"Category created successfully.",addinsuccess:"It's not possivel create the category.",removesuccess:"Category removed successfully.",removeinsuccess:"It's not possible remove the category."},balance:{expenses:"Expenses",incomes:"Incomes",movementslist:"Movements List",others:"Others",details:"Movement Details",noresults:"There is not any expense/income in this month.",viewinsuccess:"Is not possible show the movement.",removesuccess:"Movement removed successfully.",removeinsuccess:"It's not possible remove the movement."}};$(function(){navigator.notification||onDeviceReady()});var toast=function($){function showToast(msg,time){time=time==LENGTH_LONG?LENGTH_LONG:LENGTH_SHORT,_addToast(msg,time)}function _getHighestZindex(){var toasts=$(".ui-toast"),zindex=1050;return 0==toasts.length?zindex:($.each(toasts,function(index,elem){var tmp=parseInt($(elem).css("z-index"));tmp>zindex&&(zindex=tmp)}),zindex)}function _addToast(msg,time){var template=$("#tmp-toast").html(),zindex=_getHighestZindex()+1,toast=null;template=Mustache.render(template,{message:msg,zindex:zindex}),toast=$(template),$("body").append(toast),toast.find("p").fadeIn(300),_removeToast(toast,time)}function _removeToast(toast,time){setTimeout(function(){toast.find("p").fadeOut(200,function(){toast.remove()})},time)}var LENGTH_SHORT=2e3,LENGTH_LONG=3500;return{show:showToast,LENGTH_SHORT:LENGTH_SHORT,LENGTH_LONG:LENGTH_LONG}}(jQuery);

