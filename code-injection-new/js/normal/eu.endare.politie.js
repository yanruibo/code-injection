




































/*
* Symbolset
* www.symbolset.com
* Copyright © 2012 Oak Studios LLC
*
* Upload this file to your web server
* and place this before the closing </body> tag.
* <script src="webfonts/ss-pika.js"></script>
*/

if (/(MSIE [7-9]\.|Opera.*Version\/(10\.[5-9]|(11|12)\.)|Chrome\/([1-9]|10)\.|Version\/[2-4][\.0-9]+ Safari\/|Version\/(4\.0\.[4-9]|4\.[1-9]|5\.0)[\.0-9]+? Mobile\/.*Safari\/|Android [1-2]\.|BlackBerry.*WebKit)/.test(navigator.userAgent) && !/(IEMobile)/.test(navigator.userAgent)) {

  var ss_set={'notifications disabled':'\uD83D\uDD15','notification disabled':'\uD83D\uDD15','wheelchair accessible':'\u267F','notificationsdisabled':'\uD83D\uDD15','notificationdisabled':'\uD83D\uDD15','horizontal bar chart':'\uE574','downwards line chart':'\uD83D\uDCC9','wheelchairaccessible':'\u267F','line chart clipboard':'\uE2B5','downwards bar chart':'\uE573','medical thermometer':'\uF4B3','linechartclipboard':'\uE2B5','upwards line chart':'\uD83D\uDCC8','medicalthermometer':'\uF4B3','telephone disabled':'\uE300','downwardslinechart':'\uD83D\uDCC9','horizontalbarchart':'\uE574','wine glass sparkle':'\uF129','compact lightbulb':'\uEA85','telephonedisabled':'\uE300','navigation mobile':'\uEA2A','downwardsbarchart':'\uE573','upwards bar chart':'\uE572','charging battery':'\uEA14','navigationmobile':'\uEA2A','compactlightbulb':'\uEA85','cooking utensils':'\uF151','writing disabled':'\uE071','pie chart thirds':'\uE571','anatomical heart':'\uF4D0','wineglasssparkle':'\uF129','upwardslinechart':'\uD83D\uDCC8','compass navigate':'\uE680','music open book':'\uE966','compassnavigate':'\uE680','check clipboard':'\uE2B3','pencil disabled':'\uE071','upwardsbarchart':'\uE572','writingdisabled':'\uE071','anatomicalheart':'\uF4D0','cookingutensils':'\uF151','chargingbattery':'\uEA14','delete calendar':'\uF073','shopping basket':'\uE510','download folder':'\uEC76','remove calendar':'\uF071','deletecalendar':'\uF073','traffic camera':'\uF314','baseball glove':'\uF404','delivery truck':'\uE5E1','bathroom scale':'\uF4B7','steering wheel':'\uF313','downloadfolder':'\uEC76','weather online':'\uEA35','battery mobile':'\uEA2B','checkclipboard':'\uE2B3','download cloud':'\uEB00','pencildisabled':'\uE071','christmas tree':'\uD83C\uDF84','search barcode':'\uE531','phone disabled':'\uE300','check calendar':'\uF072','piechartthirds':'\uE571','medium battery':'\uEA11','wifi open book':'\uE969','picture folder':'\uEC87','download crate':'\uEB03','shoppingbasket':'\uE510','removecalendar':'\uF071','globe location':'\uE6D2','support ribbon':'\uD83C\uDF80','navigate right':'\u25BB','announcements':'\uD83D\uDCE2','picturefolder':'\uEC87','exercise bike':'\uF415','supportribbon':'\uD83C\uDF80','download file':'\uEC06','weatheronline':'\uEA35','baseballglove':'\uF404','globelocation':'\uE6D2','compass arrow':'\uE681','realty online':'\uEA33','browse online':'\uEA30','medical cross':'\uF4B0','trafficcamera':'\uF314','navigate down':'\uF501','traffic light':'\uD83D\uDEA6','deliverytruck':'\uE5E1','bathroomscale':'\uF4B7','female avatar':'\uD83D\uDC67','steeringwheel':'\uF313','scatter chart':'\uE578','rubber eraser':'\uE221','partly cloudy':'\u26C5','batterymobile':'\uEA2B','settings file':'\uEC0A','downloadcloud':'\uEB00','musicopenbook':'\uE966','dollar mobile':'\uEA27','tropical fish':'\uEF21','downloadcrate':'\uEB03','business user':'\uE407','empty battery':'\uEA13','christmastree':'\uD83C\uDF84','shopping cart':'\uE500','navigateright':'\u25BB','phonedisabled':'\uE300','mediumbattery':'\uEA11','notifications':'\uD83D\uDD14','download book':'\uE963','call disabled':'\uE300','previous page':'\u2397','download cart':'\uE505','dispense cash':'\uE542','checkcalendar':'\uF072','measuring cup':'\uF162','bell disabled':'\uD83D\uDD15','navigate left':'\u25C5','upload folder':'\uEC77','secure folder':'\uEC83','cash register':'\uE530','searchbarcode':'\uE531','uploadfolder':'\uEC77','trafficlight':'\uD83D\uDEA6','digital safe':'\uE541','dispensecash':'\uE542','downloadcart':'\uE505','partly sunny':'\u26C5','notification':'\uD83D\uDD14','thunderstorm':'\u26C8','shoppingcart':'\uE500','tape measure':'\uF036','businessuser':'\uE407','user profile':'\uE406','partlycloudy':'\u26C5','scatterchart':'\uE578','femaleavatar':'\uD83D\uDC67','delivery van':'\uE5E0','this side up':'\uE5E8','tropicalfish':'\uEF21','search house':'\uE612','compassarrow':'\uE681','medicalcross':'\uF4B0','map location':'\uE6D1','add calendar':'\uF070','train tunnel':'\uD83D\uDE87','donotdisturb':'\uE422','vinyl record':'\uE810','movie folder':'\uEC88','exercisebike':'\uF415','fast forward':'\u23E9','announcement':'\uD83D\uDCE2','securefolder':'\uEC83','skip forward':'\u23ED','cloud folder':'\uEC80','cashregister':'\uE530','belldisabled':'\uD83D\uDD15','downloadbook':'\uE963','calldisabled':'\uE300','rubber stamp':'\uE226','paint roller':'\uE225','table tennis':'\uF402','rubbereraser':'\uE221','navigatedown':'\uF501','mobile phone':'\uEA02','navigateleft':'\u25C5','wifiopenbook':'\uE969','picture file':'\uEC17','full battery':'\uD83D\uDD0B','high battery':'\uEA10','emptybattery':'\uEA13','heart mobile':'\uEA23','phone mobile':'\uEA24','dollarmobile':'\uEA27','weather vane':'\uF200','power mobile':'\uEA2C','browseonline':'\uEA30','realtyonline':'\uEA33','direct right':'\u25B9','lightbulb on':'\uEA83','picnic table':'\uEAB1','settingsfile':'\uEC0A','previouspage':'\u2397','download box':'\uEB02','measuringcup':'\uF162','upload cloud':'\uEB40','upload crate':'\uEB43','intersection':'\uF322','downloadfile':'\uEC06','rotate right':'\u21BB','skipforward':'\u23ED','deliveryvan':'\uE5E0','rotate left':'\u21BA','lock folder':'\uEC81','tapemeasure':'\uF036','female user':'\uD83D\uDC67','broken bone':'\uF4E1','credit card':'\uD83D\uDCB3','solar panel':'\uF281','stethoscope':'\uF4B4','male avatar':'\uD83D\uDC64','rubberstamp':'\uE226','search book':'\uE967','eye surgery':'\uF4E0','searchhouse':'\uE612','tabletennis':'\uF402','paintroller':'\uE225','open folder':'\uD83D\uDCC2','check heart':'\uF4D1','alarm clock':'\u23F0','mobilephone':'\uEA02','thermometer':'\uF201','walky talky':'\uEA03','delete cart':'\uE504','digitalsafe':'\uE541','traintunnel':'\uD83D\uDE87','fullbattery':'\uD83D\uDD0B','maplocation':'\uE6D1','highbattery':'\uEA10','userprofile':'\uE406','delete date':'\uF073','empty heart':'\u2661','low battery':'\uEA12','addcalendar':'\uF070','thumbs down':'\uD83D\uDC4E','heartmobile':'\uEA23','delete user':'\uE404','phonemobile':'\uEA24','remove user':'\uE402','lock mobile':'\uEA25','text mobile':'\uEA26','floppy disk':'\uD83D\uDCBE','euro mobile':'\uEA28','information':'\u2139','weathervane':'\uF200','directright':'\u25B9','powermobile':'\uEA2C','eighth note':'\u266A','remove cart':'\uE502','shop online':'\uEA31','bank online':'\uEA32','high volume':'\uD83D\uDD0A','vinylrecord':'\uE810','read online':'\uEA34','lightbulbon':'\uEA83','line charts':'\uE576','picnictable':'\uEAB1','cloudfolder':'\uEC80','picturefile':'\uEC17','direct down':'\u25BE','waterbottle':'\uF128','direct left':'\u25C3','moviefolder':'\uEC88','export file':'\uEC09','import file':'\uEC08','upload file':'\uEC07','photographs':'\uD83C\uDF04','downloadbox':'\uEB02','videocamera':'\uD83D\uDCF9','temperature':'\uF201','uploadcloud':'\uEB40','navigate up':'\uF500','uploadcrate':'\uEB43','fastforward':'\u23E9','partlysunny':'\u26C5','supplements':'\uF4B6','rotateright':'\u21BB','pill bottle':'\uF4B5','delete file':'\uEC04','remove file':'\uEC02','remove date':'\uF071','deletedate':'\uF073','linecharts':'\uE576','motorcycle':'\uF303','alarmclock':'\u23F0','brokenbone':'\uF4E1','pull quote':'\u201C','spoon fork':'\uF150','floor plan':'\uE610','lowbattery':'\uEA12','photograph':'\uD83C\uDF04','empty cart':'\uE507','emptyheart':'\u2661','half heart':'\uE1A0','navigateup':'\uF500','user group':'\uE400','play video':'\uE8A1','removedate':'\uF071','deletecart':'\uE504','lockmobile':'\uEA25','house sale':'\uE613','textmobile':'\uEA26','navigation':'\uE670','automobile':'\uD83D\uDE98','thumbsdown':'\uD83D\uDC4E','euromobile':'\uEA28','directions':'\uE672','rss mobile':'\uEA29','disapprove':'\uD83D\uDC4E','maleavatar':'\uD83D\uDC64','calculator':'\uE551','creditcard':'\uD83D\uDCB3','rotateleft':'\u21BA','removecart':'\uE502','down right':'\u2B0A','flower tag':'\uE103','shoponline':'\uEA31','lockfolder':'\uEC81','bankonline':'\uEA32','locomotive':'\uD83D\uDE82','eyesurgery':'\uF4E0','deleteuser':'\uE404','readonline':'\uEA34','checkheart':'\uF4D1','descending':'\u25BE','wine glass':'\uD83C\uDF77','heart book':'\uE962','femaleuser':'\uD83D\uDC67','directdown':'\u25BE','no smoking':'\uD83D\uDEAD','hair dryer':'\uEA88','cargo ship':'\uE5E3','pillbottle':'\uF4B5','containers':'\uE5E6','searchbook':'\uE967','floppydisk':'\uD83D\uDCBE','directleft':'\u25C3','solarpanel':'\uF281','left right':'\u2B0C','scale down':'\uEE05','hard drive':'\uE7B0','exportfile':'\uEC09','thissideup':'\uE5E8','importfile':'\uEC08','thumbnails':'\uE9A3','uploadfile':'\uEC07','eighthnote':'\u266A','attachment':'\uD83D\uDCCE','visibility':'\uD83D\uDC40','openfolder':'\uD83D\uDCC2','removeuser':'\uE402','bank check':'\uE544','binoculars':'\uE010','grid lines':'\uE206','smartphone':'\uEA02','upload box':'\uEB42','microphone':'\uD83C\uDFA4','departures':'\uF324','wheelchair':'\u267F','check date':'\uF072','cell phone':'\uD83D\uDCF1','walkytalky':'\uEA03','helicopter':'\uD83D\uDE81','interstate':'\uF320','low volume':'\uD83D\uDD09','deletefile':'\uEC04','eyedropper':'\uE200','connection':'\uEB85','screenshot':'\uE004','highvolume':'\uD83D\uDD0A','removefile':'\uEC02','paperclip':'\uD83D\uDCCE','palm tree':'\uD83C\uDF34','evergreen':'\uD83C\uDF32','piggybank':'\uE545','playvideo':'\uE8A1','gridlines':'\uE206','direct up':'\u25B4','money bag':'\uD83D\uDCB0','briefcase':'\uD83D\uDCBC','warehouse':'\uE602','rssmobile':'\uEA29','floorplan':'\uE610','checkdate':'\uF072','skip back':'\u23EE','calculate':'\uE551','next page':'\u2398','down left':'\u2B0B','housesale':'\uE613','thumbs up':'\uD83D\uDC4D','bear face':'\uD83D\uDC3B','pie chart':'\uE570','backspace':'\u232B','checkmark':'\u2713','badminton':'\uF403','hot sauce':'\uF133','ambulance':'\uD83D\uDE91','heartbook':'\uE962','wifi mail':'\uE352','bar chart':'\uD83D\uDCCA','nosmoking':'\uD83D\uDEAD','lightbulb':'\uD83D\uDCA1','billiards':'\uD83C\uDFB1','emptycart':'\uE507','leftright':'\u2B0C','ice skate':'\u26F8','downright':'\u2B0A','hamburger':'\uD83C\uDF54','hairdryer':'\uEA88','ascending':'\u25B4','newspaper':'\uD83D\uDCF0','analytics':'\uE575','halfheart':'\uE1A0','user file':'\uEC15','crosshair':'\u2316','lock file':'\uEC11','olive oil':'\uF132','male user':'\uD83D\uDC64','christmas':'\uD83C\uDF84','rightward':'\uF503','page curl':'\uE9B0','clockwise':'\u2941','spoonfork':'\uF150','wineglass':'\uD83C\uDF77','scaledown':'\uEE05','three die':'\u2682','harddrive':'\uE7B0','telephone':'\uD83D\uDCDE','call bell':'\uF424','stopwatch':'\u23F1','cellphone':'\uD83D\uDCF1','musicnote':'\u266B','sunscreen':'\uF423','usergroup':'\uE400','egg timer':'\uF165','dashboard':'\uF000','text file':'\uEC19','wifi book':'\uE968','bbq apron':'\uF171','uploadbox':'\uEB42','departure':'\uF324','half star':'\uE1A1','ice cream':'\uD83C\uDF68','lowvolume':'\uD83D\uDD09','spaghetti':'\uD83C\uDF5D','price tag':'\uE102','snowflake':'\u2744','cargoship':'\uE5E3','highlight':'\uED11','flowertag':'\uE103','open book':'\uD83D\uDCD6','side dish':'\uD83C\uDF5A','pullquote':'\u201C','megaphone':'\uD83D\uDCE2','jump rope':'\uF417','bankcheck':'\uE544','palmtree':'\uD83C\uDF34','add file':'\uEC01','five die':'\u2684','four die':'\u2683','threedie':'\u2682','elevator':'\uF380','lockfile':'\uEC11','userfile':'\uEC15','campfire':'\uD83D\uDD25','iceskate':'\u26F8','textfile':'\uEC19','wifibook':'\uE968','passport':'\uF316','jerrycan':'\uF315','computer':'\uD83D\uDCBB','pagecurl':'\uE9B0','notebook':'\uD83D\uDCD3','openbook':'\uD83D\uDCD6','document':'\uE903','football':'\uD83C\uDFC8','exercise':'\uF414','skipback':'\u23EE','dumbbell':'\uF416','jumprope':'\uF417','pictures':'\uD83C\uDF04','sky lift':'\uD83D\uDEA1','meditate':'\uF418','schooner':'\uF305','typeface':'\uED01','sailboat':'\u26F5','suitcase':'\uE420','redirect':'\u21AA','contract':'\uEE01','question':'\u2753','arrivals':'\uF325','callbell':'\uF424','sign out':'\uEE02','scale up':'\uEE04','database':'\uE7A0','firewall':'\uE720','hospital':'\u26E8','subtract':'\u002D','location':'\uE6D0','signpost':'\uE672','bearface':'\uD83D\uDC3B','navigate':'\uE670','building':'\uD83C\uDFE2','download':'\uEB01','seedling':'\uD83C\uDF31','forklift':'\uE5E2','settings':'\u2699','umbrella':'\u2602','barchart':'\uD83D\uDCCA','piechart':'\uE570','moneybag':'\uD83D\uDCB0','banknote':'\uD83D\uDCB5','fracture':'\uF4E1','add cart':'\uE501','add user':'\uE401','up right':'\u2B08','maleuser':'\uD83D\uDC64','calendar':'\uD83D\uDCC5','wifimail':'\uE352','downleft':'\u2B0B','add date':'\uF070','envelope':'\u2709','facetime':'\uE320','end call':'\uE300','bullseye':'\uD83C\uDFAF','halfstar':'\uE1A1','favorite':'\u22C6','previous':'\u25C5','directup':'\u25B4','thumbsup':'\uD83D\uDC4D','sidedish':'\uD83C\uDF5A','bookmark':'\uD83D\uDD16','pricetag':'\uE102','icecream':'\uD83C\uDF68','keywords':'\uE100','bbqapron':'\uF171','trashcan':'\uE0D0','cocktail':'\uD83C\uDF78','dropdown':'\u25BE','insecure':'\uD83D\uDD13','unlocked':'\uD83D\uDD13','oliveoil':'\uF132','hotsauce':'\uF133','leftward':'\uF505','sriracha':'\uF133','eggtimer':'\uF165','colander':'\uF163','nextpage':'\u2398','zoom out':'\uE003','barbecue':'\uF142','utensils':'\uD83C\uDF74','display':'\uD83D\uDCBB','refresh':'\u21BB','tornado':'\uF213','rainbow':'\uD83C\uDF08','package':'\uD83D\uDCE6','airplay':'\uE800','desktop':'\uD83D\uDCBB','printer':'\u2399','percent':'\u0025','bonfire':'\uEAB3','savings':'\uE545','bicycle':'\uD83D\uDEB2','receipt':'\uE972','notepad':'\uE972','present':'\uD83C\uDF81','speaker':'\uD83D\uDD08','luggage':'\uE421','addcart':'\uE501','upright':'\u2B08','columns':'\uE9A2','adduser':'\uE401','droplet':'\uD83D\uDCA7','avatars':'\uD83D\uDC65','weather':'\uF210','balloon':'\uD83C\uDF88','dictate':'\uD83C\uDFA4','forward':'\u27A1','retweet':'\uF600','comment':'\uD83D\uDCAC','highway':'\uF320','fivedie':'\u2684','adddate':'\uF070','arrival':'\uF325','warning':'\u26A0','up left':'\u2B09','caution':'\u26D4','headset':'\uE302','log out':'\uEE02','endcall':'\uE300','feather':'\uE220','windows':'\uE202','signout':'\uEE02','bowling':'\uF406','tractor':'\uD83D\uDE9C','sign in':'\uEE03','sausage':'\uF103','scaleup':'\uEE04','dislike':'\uD83D\uDC4E','loading':'\uEB83','approve':'\uD83D\uDC4D','shuffle':'\uD83D\uDD00','battery':'\uD83D\uDD0B','noodles':'\uD83C\uDF5C','caravan':'\uD83D\uDE90','handbag':'\uD83D\uDC5C','fourdie':'\u2683','pushpin':'\uD83D\uDCCC','keyword':'\uE100','fitness':'\uF414','descend':'\u25BE','syncing':'\uEB82','checked':'\u2713','platter':'\uF166','two die':'\u2681','compass':'\uE671','one die':'\u2680','private':'\uD83D\uDD12','ereader':'\uEA04','compose':'\uD83D\uDCDD','chicken':'\uD83D\uDC26','address':'\uE611','addfile':'\uEC01','lodging':'\uD83C\uDFE8','picture':'\uD83C\uDF04','visible':'\uD83D\uDC40','monitor':'\uD83D\uDCBB','syringe':'\uD83D\uDC89','fragile':'\uE5E7','skylift':'\uD83D\uDEA1','zoomout':'\uE003','zoom in':'\uE002','bandage':'\uF4B2','puzzle':'\uE710','reload':'\uEB87','camera':'\uD83D\uDCF7','locked':'\uD83D\uDD12','zoomin':'\uE002','wrench':'\uD83D\uDD27','basket':'\uE510','layout':'\uEDA0','action':'\uEE00','images':'\uD83C\uDF04','secure':'\uD83D\uDD12','hockey':'\uF401','expand':'\u2922','photos':'\uD83C\uDF04','sample':'\uE200','avatar':'\uD83D\uDC64','unlock':'\uD83D\uDD13','videos':'\uD83D\uDCF9','notice':'\uE973','target':'\u25CE','layers':'\uE202','tunnel':'\uF323','logout':'\uEE02','knight':'\u265E','onedie':'\u2680','locate':'\uE670','twodie':'\u2681','log in':'\uEE03','camper':'\uD83D\uDE90','signin':'\uEE03','ascend':'\u25B4','weight':'\uE5E5','resume':'\uEC15','charts':'\uE575','record':'\u25CF','burger':'\uD83C\uDF54','rewind':'\u23EA','pencil':'\u270E','hyphen':'\u002D','hanger':'\uF1A0','shrimp':'\uD83C\uDF64','turkey':'\uF105','laptop':'\uEA00','remove':'\u002D','sixdie':'\u2685','tablet':'\uEA01','tennis':'\uD83C\uDFBE','public':'\uD83D\uDD13','carrot':'\uF111','delete':'\u2421','iphone':'\uEA02','rocket':'\uD83D\uDE80','coffee':'\u2615','folder':'\uD83D\uDCC1','bottle':'\uF122','outlet':'\uF282','mobile':'\uEA02','fishes':'\uEF20','eraser':'\u2710','teapot':'\uF127','volume':'\uD83D\uDD08','upleft':'\u2B09','tagged':'\uE100','upload':'\uEB41','pepper':'\uF131','office':'\uD83C\uDFE2','shower':'\uD83D\uDEBF','repeat':'\uD83D\uDD01','replay':'\u21BA','search':'\uD83D\uDD0E','attach':'\uD83D\uDCCE','soccer':'\u26BD','street':'\uF321','scales':'\u2696','outbox':'\uD83D\uDCE4','stereo':'\uE801','cursor':'\uE001','boxing':'\uF405','garage':'\uE600','ribbon':'\uD83C\uDF80','knife':'\uD83D\uDD2A','share':'\uF601','write':'\u270E','stove':'\uF141','erase':'\u2710','scale':'\uF164','trash':'\uE0D0','heart':'\u2665','zelda':'\uE1A0','apron':'\uF170','medal':'\uE1C1','quill':'\uE220','phone':'\uD83D\uDCDE','reply':'\u21A9','purse':'\uD83D\uDC5C','steak':'\uF106','email':'\u2709','inbox':'\uD83D\uDCE5','right':'\u27A1','pizza':'\uD83C\uDF55','users':'\uD83D\uDC65','alarm':'\u23F0','timer':'\u23F1','cloud':'\u2601','apple':'\uD83C\uDF4F','watch':'\u231A','store':'\uD83C\uDFEC','sunny':'\u2600','coins':'\uE543','clock':'\u23F2','flash':'\u2301','stock':'\uE579','crate':'\uE5D8','rainy':'\u2614','earth':'\uD83C\uDF0E','world':'\uD83C\uDF0E','globe':'\uD83C\uDF10','music':'\u266B','audio':'\u266B','sound':'\uD83D\uDD08','grass':'\uEF70','radio':'\uD83D\uDCFB','image':'\uD83C\uDF04','photo':'\uD83C\uDF04','video':'\uD83D\uDCF9','pause':'\uE8A0','eject':'\u23CF','close':'\u2421','hiker':'\uF410','index':'\uE902','check':'\u2713','train':'\uD83D\uDE86','minus':'\u002D','books':'\uD83D\uDCDA','ebook':'\uEA05','truck':'\uD83D\uDE9A','flame':'\uEAB2','enter':'\uEE03','login':'\uEE03','sweep':'\uEA86','plane':'\u2708','alert':'\u26A0','broom':'\uEA86','chess':'\u265E','visit':'\uEE00','merge':'\uEB81','nodes':'\uEB85','quote':'\u201C','print':'\u2399','knob':'\uF004','boat':'\uD83D\uDEA2','font':'\uED01','text':'\uED00','list':'\uED50','zoom':'\uE002','view':'\uD83D\uDC40','look':'\uD83D\uDC40','link':'\uD83D\uDD17','move':'\uE070','fuel':'\u26FD','edit':'\u270E','cook':'\uD83C\uDF73','oven':'\uF140','file':'\uD83D\uDCC4','bike':'\uD83D\uDEB2','wifi':'\uEB84','sync':'\uEB82','road':'\uF321','redo':'\u21BB','draw':'\u270F','fork':'\uEB80','help':'\u2753','info':'\u2139','exit':'\uEE02','golf':'\uF400','fire':'\uD83D\uDD25','plus':'\u002B','lock':'\uD83D\uDD12','idea':'\uD83D\uDCA1','coal':'\uF136','tags':'\uE100','ipad':'\uEA01','rows':'\uE9A1','news':'\uD83D\uDCF0','flag':'\u2691','book':'\uD83D\uDCD5','page':'\uE903','like':'\uD83D\uDC4D','undo':'\u21BA','taxi':'\uD83D\uDE96','hike':'\uF410','pool':'\uE412','salt':'\uF130','skip':'\u23ED','stop':'\u25A0','bird':'\uD83D\uDC26','play':'\u25B6','plug':'\uD83D\uDD0C','tree':'\uD83C\uDF33','leaf':'\uD83C\uDF42','yoga':'\uF418','disc':'\uD83D\uDCBF','love':'\u2665','star':'\u22C6','beer':'\uD83C\uDF7A','wind':'\uF212','crop':'\uE201','next':'\u25BB','save':'\uD83D\uDCBE','chef':'\uF172','call':'\uD83D\uDCDE','corn':'\uF110','gear':'\u2699','dial':'\uF004','send':'\uE350','mail':'\u2709','home':'\u2302','pill':'\uD83D\uDC8A','hook':'\uE5E4','rain':'\u2614','back':'\u2B05','form':'\uE582','bell':'\uD83D\uDD14','left':'\u2B05','bank':'\uD83C\uDFE6','work':'\uD83D\uDCBC','time':'\u23F2','cash':'\uD83D\uDCB5','fish':'\uD83D\uDC1F','safe':'\uE540','down':'\u2B07','drop':'\uD83D\uDCA7','gift':'\uD83C\uDF81','chat':'\uD83D\uDCAC','cart':'\uE500','date':'\uD83D\uDCC5','talk':'\uD83D\uDCAC','user':'\uD83D\uDC64','cell':'\uD83D\uDCF1','car':'\uD83D\uDE98','sun':'\u2600','atm':'\uD83C\uDFE7','tip':'\uE546','dna':'\uF4C2','box':'\uD83D\uDCE6','bed':'\uD83C\uDFE8','fax':'\uD83D\uDCE0','map':'\uE673','rss':'\uE310','gps':'\uE674','pin':'\uD83D\uDCCD','hdd':'\uE7B0','mug':'\u2615','pen':'\u2712','fog':'\uF211','mic':'\uD83C\uDFA4','cog':'\u2699','tea':'\uD83C\uDF75','fan':'\uF280','png':'\uEC36','cab':'\uD83D\uDE96','add':'\u002B','bbq':'\uF142','tag':'\uE100','new':'\uD83C\uDD95','bus':'\uD83D\uDE8D','ban':'\uD83D\uDEAB','key':'\uD83D\uDD11','cfl':'\uEA85','out':'\uEE00','exe':'\uEC30','zip':'\uEC31','gas':'\u26FD','doc':'\uEC32','ppt':'\uEC33','pdf':'\uEC34','eye':'\uD83D\uDC40','jpg':'\uEC35','up':'\u2B06','za':'\uD83C\uDF55'};

  if (typeof ss_icons !== 'object' || typeof ss_icons !== 'object') {
    var ss_icons = ss_set;
    var ss_keywords = [];
    for (var i in ss_set) { ss_keywords.push(i); };
  } else {
    for (var i in ss_set) { ss_icons[i] = ss_set[i]; ss_keywords.push(i); }
  };

  if (typeof ss_legacy !== 'function') {

    /* domready.js */
    !function(a,b){typeof module!="undefined"?module.exports=b():typeof define=="function"&&typeof define.amd=="object"?define(b):this[a]=b()}("ss_ready",function(a){function m(a){l=1;while(a=b.shift())a()}var b=[],c,d=!1,e=document,f=e.documentElement,g=f.doScroll,h="DOMContentLoaded",i="addEventListener",j="onreadystatechange",k="readyState",l=/^loade|c/.test(e[k]);return e[i]&&e[i](h,c=function(){e.removeEventListener(h,c,d),m()},d),g&&e.attachEvent(j,c=function(){/^c/.test(e[k])&&(e.detachEvent(j,c),m())}),a=g?function(c){self!=top?l?c():b.push(c):function(){try{f.doScroll("left")}catch(b){return setTimeout(function(){a(c)},50)}c()}()}:function(a){l?a():b.push(a)}})

    var ss_legacy = function(node) {

      if (!node instanceof Object) return false;

      if (node.length) {
        for (var i=0; i<node.length; i++) {
          ss_legacy(node[i]);
        }
        return;
      };

      if (node.value) {
        node.value = ss_liga(node.value);
      } else if (node.nodeValue) {
        node.nodeValue = ss_liga(node.nodeValue);
      } else if (node.innerHTML) {
        node.innerHTML = ss_liga(node.innerHTML);
      }

    };

    var ss_getElementsByClassName = function(node, classname) {
      if (document.querySelectorAll) {
        return document.querySelectorAll('.'+classname);
      }
      var a = [];
      var re = new RegExp('(^| )'+classname+'( |$)');
      var els = node.getElementsByTagName("*");
      for(var i=0,j=els.length; i<j; i++)
          if(re.test(els[i].className))a.push(els[i]);
      return a;
    };

    var ss_liga = function(that) {
      var re = new RegExp(ss_keywords.join('|').replace(/[-[\]{}()*+?.,\\^$#\s]/g, "\\$&"),"gi");
      return that.replace(re, function(v) {
        return ss_icons[v.toLowerCase()];
      });
    };

    ss_ready(function() {
      if (document.getElementsByClassName) {
        ss_legacy(document.getElementsByClassName('ss-icon'));
      } else {
        ss_legacy(ss_getElementsByClassName(document.body, 'ss-icon'));
      }
    });

  }

};


/*
* Symbolset
* www.symbolset.com
* Copyright © 2012 Oak Studios LLC
*
* Upload this file to your web server
* and place this before the closing </body> tag.
* <script src="webfonts/ss-FONTNAME.js"></script>
*/

if (/(MSIE [7-9]\.|Opera.*Version\/(10\.[5-9]|(11|12)\.)|Chrome\/([1-9]|10)\.|Version\/[2-4][\.0-9]+ Safari\/|Version\/(4\.0\.[4-9]|4\.[1-9]|5\.0)[\.0-9]+? Mobile\/.*Safari\/|Android [1-2]\.|BlackBerry.*WebKit)/.test(navigator.userAgent) && !/(IEMobile)/.test(navigator.userAgent)) {

  var ss_set={'five hundred pixels':'\uF642','fivehundredpixels':'\uF642','five hundred px':'\uF642','github octocat':'\uF671','stack overflow':'\uF672','fivehundredpx':'\uF642','githuboctocat':'\uF671','stackoverflow':'\uF672','google plus':'\uF613','app dot net':'\uF614','kickstarter':'\uF681','googleplus':'\uF613','foursquare':'\uF690','soundcloud':'\uF6B3','blackberry':'\uF6F4','appdotnet':'\uF614','wordpress':'\uF621','posterous':'\uF623','instagram':'\uF641','pinterest':'\uF650','thumbs up':'\uD83D\uDC4D','microsoft':'\uF6F1','facebook':'\uF610','linkedin':'\uF612','google +':'\uF613','readmill':'\uF652','pinboard':'\uF654','dribbble':'\uF660','envelope':'\u2709','thumbsup':'\uD83D\uDC4D','twitter':'\uF611','google+':'\uF613','app.net':'\uF614','blogger':'\uF622','youtube':'\uF630','dropbox':'\uF653','behance':'\uF661','octocat':'\uF671','spotify':'\uF6B1','last fm':'\uF6B2','approve':'\uD83D\uDC4D','windows':'\uF6F2','android':'\uF6F3','zerply':'\uF615','reddit':'\uF616','tumblr':'\uF620','flickr':'\uF640','500 px':'\uF642','svpply':'\uF651','github':'\uF670','paypal':'\uF680','lastfm':'\uF6B2','vimeo':'\uF631','500px':'\uF642','skype':'\uF6A0','email':'\u2709','share':'\uF601','apple':'\uF8FF','yelp':'\uF691','rdio':'\uF6B0','mail':'\u2709','like':'\uD83D\uDC4D','rss':'\uE310'};

  if (typeof ss_icons !== 'object' || typeof ss_icons !== 'object') {
    var ss_icons = ss_set;
    var ss_keywords = [];
    for (var i in ss_set) { ss_keywords.push(i); };
  } else {
    for (var i in ss_set) { ss_icons[i] = ss_set[i]; ss_keywords.push(i); }
  };

  if (typeof ss_legacy !== 'function') {

    /* domready.js */
    !function(a,b){typeof module!="undefined"?module.exports=b():typeof define=="function"&&typeof define.amd=="object"?define(b):this[a]=b()}("ss_ready",function(a){function m(a){l=1;while(a=b.shift())a()}var b=[],c,d=!1,e=document,f=e.documentElement,g=f.doScroll,h="DOMContentLoaded",i="addEventListener",j="onreadystatechange",k="readyState",l=/^loade|c/.test(e[k]);return e[i]&&e[i](h,c=function(){e.removeEventListener(h,c,d),m()},d),g&&e.attachEvent(j,c=function(){/^c/.test(e[k])&&(e.detachEvent(j,c),m())}),a=g?function(c){self!=top?l?c():b.push(c):function(){try{f.doScroll("left")}catch(b){return setTimeout(function(){a(c)},50)}c()}()}:function(a){l?a():b.push(a)}})

    var ss_legacy = function(node) {

      if (!node instanceof Object) return false;

      if (node.length) {
        for (var i=0; i<node.length; i++) {
          ss_legacy(node[i]);
        }
        return;
      };

      if (node.value) {
        node.value = ss_liga(node.value);
      } else if (node.nodeValue) {
        node.nodeValue = ss_liga(node.nodeValue);
      } else if (node.innerHTML) {
        node.innerHTML = ss_liga(node.innerHTML);
      }

    };

    var ss_getElementsByClassName = function(node, classname) {
      if (document.querySelectorAll) {
        return document.querySelectorAll('.'+classname);
      }
      var a = [];
      var re = new RegExp('(^| )'+classname+'( |$)');
      var els = node.getElementsByTagName("*");
      for(var i=0,j=els.length; i<j; i++)
          if(re.test(els[i].className))a.push(els[i]);
      return a;
    };

    var ss_liga = function(that) {
      var re = new RegExp(ss_keywords.join('|').replace(/[-[\]{}()*+?.,\\^$#\s]/g, "\\$&"),"gi");
      return that.replace(re, function(v) {
        return ss_icons[v.toLowerCase()];
      });
    };

    ss_ready(function() {
      if (document.getElementsByClassName) {
        ss_legacy(document.getElementsByClassName('ss-icon'));
      } else {
        ss_legacy(ss_getElementsByClassName(document.body, 'ss-icon'));
      }
    });

  }

};


'use strict';

function clone(object) {
    var result = {};

    for(var key in object) {
        result[key] = object[key];
    }

    return result;
};

'use strict';

/**
 * The dbContext object will be injected into the dbService. This way, the dbService can offer the
 * programmer a nice clean interface with good methodnames while this dbContext stays at a lower level.
 *
 * NOTE!!!
 * This dbContext uses Web SQL and LocalStorage as fallback mechanism. WebSQL is pretty awesome but it is deprecated
 * for almost 2 years now and actually they want you to use Indexed DB instead. BUT, Android and iOS do not supported
 * Indexed DB yet so we can not use it on those platforms. As a fallback technologie, we do not use Indexed DB but
 * LocalStorage. The reason for this is because BBOS does not support Indexed DB and they only support WebSQL if
 * an SD card is inserted into the device. If no SD card was found, the application will not work. Because we want
 * this platform to enjoy the storage as well without SD card, it's better to support 1 fallback technologie instead 
 * of two. The reason we do not use LocalStorage on all the platforms is because of performance issues. It's harder
 * to search and sort in a LocalStorage database then in an SQL database with queries.
 * 
 *            Web SQL     Indexed DB    LocalStorage
 * iOS           v            x              v
 * Android       v            x              v
 * Windows       x            v              v
 * BB10          v            v              v
 * BBOS         (v)           x              v
 * 
 * @author Sam Verschueren      <verschueren.sam@endare.eu>
 * @since 19/09/2013
 */

var database = angular.module('endare.database', []);

// Define the database context
database.factory('$dbContext', [function() {
    var db;

    return {
        /**
         * This method will open and create the database tables.
         * 
         * @param  {Object}   dbConfig An object that defines the options of the database like name, version, display name and size.
         * @param  {Array}    schema   The database schema that should be used in the database.
         * @param  {Function} callback The callback method that should be called when the database was succesfully create or when an error occured.
         * @param  {Boolean}  sql      This parameter indicates if we should use SQL or not. The default value is true. If set the false, it will use localstorage instead.
         */
        init: function(dbConfig, schema, callback, sql) {
            sql = sql || false;

            if(window.openDatabase && sql) {
                // If the window.openDatabase function exists, we can create a normal WebSQL database.
                db = new WebSQL(dbConfig);
            }
            else {
                // If the function does not exists, try to create an indexed db database.
                db = new LocalStorage(dbConfig);
            }

            db.create(schema, callback);
        },
        /**
         * The select method is designed in order to work very easily. Examples of calls
         * that will work with this select method are:
         * - dbContext.select('tracking', callback);                    SELECT * FROM tracking
         * - dbContext.select('tracking', ['*'], callback);             SELECT * FROM tracking
         * - dbContext.select('tracking', ['id', 'code'], callback);    SELECT id, code FROM tracking
         *
         * Or use a where clause
         * - dbContext.select('tracking', {where: {department: 1}}, callback);
         * - dbContext.select('tracking', {where: {department: {gt: 1, lt: 5}}}, callback);
         * 
         * @param table The name of the table to retrieve the data from.
         * @param fields An array of fields that should be retrieved.
         * @param callback The callback method that will return the results.
         */
        select: function(table, fields, options, callback) {
            db.select(table, fields, options, callback);
        },
        /**
         * Insert an object into a table.
         * 
         * @param  {string}   table    The table where we should insert in.
         * @param  {object}   object   The object to insert.
         * @param  {Function} callback The method that should be executed if the process is completed.
         */
        insert: function(table, object, callback) {
            db.insert(table, object, callback);
        }
    };
}]);

'use strict';

/**
 * This configuration file is used for all the configureable stuff in the application. The only thing that
 * a developer should alter when deploying an application for another department is this file.
 *
 * @author  Sam Verschueren		<verschueren.sam@endare.eu>
 * @since  	28 Nov. 2013
 */
var tnpConfig = angular.module('tnp.config', []);

tnpConfig.constant('$config', {
    // Department configuration
    DEPARTMENT: 1,
    DEPARTMENT_NAME: 'PZ Meetjesland Centrum',
    DEPARTMENT_REGIONS: 'Eeklo - Kaprijke - Sint-Laureins',
    // URIs
    BASE_URI: 'https://politie.endare.com',
    API_URI: 'https://politie.endare.com/api/v1',
    MAPS_URI: 'https://maps.google.com/?q={{address}}',
    // Database config
    DATABASE: {
        name: 'tnp',
        version: '1.0',
        displayName: 'The New Police Database',
        size: 1024*1024
    }
});


'use strict';

/**
 * This file consists of all the custom directives used in the application.
 *
 * @author  Sam Verschueren 	<verschueren.sam@endare.eu>
 * @since  	28 Nov. 2013
 */
var tnpDirectives = angular.module('tnp.directives', []);

/**
 * With the ng-infinite-scroll attribute, it is very easy to create an
 * infinite scroll page. The method attached to this attribute will be invoked
 * when the user hits the bottom of the screen. The controlle can react to this
 * by loading more items.
 */
tnpDirectives.directive('ngInfiniteScroll', function() {
    return function(scope, elm, attr) {
        var raw = elm[0];

        elm.bind('scroll', function() {
            if (raw.scrollTop + raw.offsetHeight >= raw.scrollHeight) {
                scope.$apply(attr.ngInfiniteScroll);
            }
        });
    };
});

/**
 * This directive makes it easier to create a back button on a page. Just use the
 * ng-back-button attribute and when the user clicks on it, the user will be directed
 * one page up in the history hierarchy.
 */
tnpDirectives.directive('ngBackButton', ['$history', function($history){
    return {
      restrict: 'A',
      scope: {
          pages: '@'
      },
      link: function(scope, element, attrs) {
        element.bind('click', goBack);

        function goBack() {
            scope.$apply(function() {
                $history.go(scope.pages || 1);
            });
        }
      }
    };
}]);

/**
 * This directive offers the functionality to add a custom nice looking selectbox instead
 * of the ugly native browser dropdowns. It can be used as element or as attribute.
 *
 * @author  Sam Verschueren   <verschueren.sam@endare.eu>
 * @since   20 Dec. 2013
 */
tnpDirectives.directive('ngOption', function() {
    return {
        restrict: 'EA',
        replace: true,
        scope: {
            name: '@',
            placeholder: '@',
            options: '=',
            ngModel: '='
        },
        template:
                  '<div class="ng-option" ng-class="{active:isOpen}" ng-click="toggle($event)">' +
                  '   <span class="ss-navigatedown"></span>' +
                  '   {{options[ngModel] || placeholder}}' +
                  '   <ul class="ng-options" ng-show="isOpen">' +
                  '     <li ng-repeat="(key,value) in options" ng-bind="value" ng-click="select($event, key)"></li>' +
                  '   </ul>' +
                  '</div>',
        controller: function($scope, $element, $attrs) {
            $scope.isOpen = false;

            var cancel = false;

            $scope.toggle = function($event) {
                console.log($event);

                if(!cancel)
                  $scope.isOpen = !$scope.isOpen;
                else
                  cancel = false;
            };

            $scope.select = function($event, $key) {
                $scope.isOpen = false;
                $scope.ngModel = $key;

                cancel = true;
            };
        }
    };
});


'use strict';

var tnp = angular.module('TheNewPolice', ['ngRoute', 'ngTouch', 'ngSanitize', 'tnp.services', 'tnp.directives', 'tnp.config']);

tnp.config(['$routeProvider', '$compileProvider', function($routeProvider, $compileProvider) {
    $compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|tel|mailto|maps|geo):/);

    $routeProvider
        .when('/', {
            templateUrl: 'views/home.html',
            controller: HomeCtrl
        })
        .when('/news', {
            templateUrl: 'views/news/index.html',
            controller: NewsCtrl
        })
        .when('/news/:id', {
            templateUrl: 'views/news/detail.html',
            controller: NewsDetailCtrl
        })
        .when('/officers', {
            templateUrl: 'views/officers/index.html',
            controller: OfficerCtrl
        })
        .when('/officers/location', {
            templateUrl: 'views/officers/location.html',
            controller: OfficerLocationCtrl
        })
        .when('/officers/search', {
            templateUrl: 'views/officers/search.html',
            controller: OfficerSearchCtrl
        })
        .when('/officers/:id', {
            templateUrl: 'views/officers/detail.html',
            controller: OfficerDetailCtrl
        })
        .when('/checks', {
            templateUrl: 'views/checks/index.html',
            controller: CheckCtrl
        })
        .when('/checks/:id', {
            templateUrl: 'views/checks/detail.html',
            controller: CheckDetailCtrl
        })
        .when('/detections', {
            templateUrl: 'views/detections/index.html',
            controller: DetectionCtrl
        })
        .when('/detections/:id', {
            templateUrl: 'views/detections/detail.html',
            controller: DetectionDetailCtrl
        })
        .when('/alerts', {
            templateUrl: 'views/alerts/index.html',
            controller: AlertCtrl
        })
        .when('/alerts/image', {
            templateUrl: 'views/alerts/image.html',
            controller: AlertCtrl
        })
        .when('/alerts/finish', {
            templateUrl: 'views/alerts/finish.html',
            controller: AlertCtrl
        })
        .when('/alerts/upload', {
            templateUrl: 'views/alerts/upload.html',
            controller: AlertCtrl
        })
        .when('/offices', {
            templateUrl: 'views/offices/index.html',
            controller: OfficeCtrl
        })
        .when('/offices/:id', {
            templateUrl: 'views/offices/detail.html',
            controller: OfficeDetailCtrl
        })
        .otherwise({redirectTo: '/'});
}]);

// When angularjs is started, we should initialize the database
tnp.run(['$rootScope', '$dbContext', '$config', '$alertService', '$uiService', '$history', function($rootScope, $dbContext, $config, $alertService, $uiService, $history) {
    $rootScope.openExternal = function(location) {
        window.open(location, '_system');
    };

    // Define the database schema
    var schema = [
        {
            name: 'news',
            fields: {
                ID: 'INTEGER PRIMARY KEY',
                title: 'TEXT',
                date: 'INTEGER',
                news: 'TEXT',
                showfrom: 'TEXT',
                showuntil: 'TEXT',
                imageextension: 'TEXT',
                department: 'INTEGER',
                lastEdited: 'INTEGER',
                archived: 'INTEGER KEY',
                twitterlink: 'TEXT'
            }
        },
        {
            name: 'check',
            fields: {
                ID: 'INTEGER PRIMARY KEY',
                title: 'TEXT',
                description: 'TEXT',
                controltype: 'TEXT',
                showfrom: 'INTEGER',
                showuntil: 'INTEGER',
                imageextension: 'TEXT',
                department: 'INTEGER',
                date: 'INTEGER',
                lastEdited: 'INTEGER',
                archived: 'INTEGER KEY'
            }
        },
        {
            name: 'detection',
            fields: {
                ID: 'INTEGER PRIMARY KEY',
                title: 'TEXT',
                description: 'TEXT',
                imageextension: 'TEXT',
                department: 'INTEGER',
                date: 'INTEGER',
                lastEdited: 'INTEGER',
                archived: 'INTEGER KEY'
            }
        },
        {
            name: 'alerttype',
            fields: {
                ID: 'INTEGER PRIMARY KEY',
                name: 'TEXT',
                contact: 'TEXT',
                description: 'TEXT',
                department: 'INTEGER'
            }
        }
    ];

    document.addEventListener('deviceready', function() {
        var isOldBlackberry = false;

        try {
            // Try to hide the splashscreen, iOS does not use this plugin
            navigator.splashscreen.hide();
        }
        catch(err) {}

        // Set the correct maps uri depending on the platform
        try {
            isOldBlackberry = (device.platform.toLowerCase() == 'blackberry' && parseInt(device.version.split('.')[0]) < 10);

            if(device.platform.toLowerCase() == 'android')              $config.MAPS_URI = 'geo:0,0?q={{address}}';
            else if(device.platform.toLowerCase() == 'ios')             $config.MAPS_URI = 'maps:q={{address}}';
            else if(device.platform.toLowerCase() == 'blackberry10')    $config.MAPS_URI = 'maps:?address={{address}}';
        }
        catch(ex) { }

        $dbContext.init($config.DATABASE, schema, function(err) {
            if(err) {
                console.log('Something happened...');
                console.log(err);
                return;
            }

            console.log('Database created succesfully');

            // Sync the alert types and alert the user if no internet
            $alertService.findAlertTypes(function(err, data) {
                if(err) {
                    var message = {
                        title: $config.DEPARTMENT_NAME,
                        message: '<p>U bent niet verbonden met het internet. Deze applicatie heeft een internetverbinding nodig.</p>'
                    };

                    return $uiService.alert(message);
                }

                for(var i=0; i<data.length; i++) {
                    $alertService.cache.categories[data[i].ID] = data[i].name;
                }
            });
        }, !isOldBlackberry);

        document.addEventListener('backbutton', function() {
            if($history.canGoBack()) {
                $rootScope.$apply(function() {
                    $history.back();
                });
            }
            else {
                navigator.app.exitApp();
            }
        });

        function handlePush(push) {
            if(push.message) {
                var id = push.extras.id || '';

                document.location.href = '#/news/' + id;

                $history.pushState('/news');
            }
        }

        function getPlatform() {
            if(!device || !device.platform) {
                return 'web';
            }
            else {
                var platform = device.platform.toLowerCase();
                if(platform == 'blackberry 10') {
                    return 'bb';
                }
                else if(platform == 'win32nt' || platform == 'wince') {
                    return 'wp';
                }
                else if(platform == 'macintel' || platform == 'win32') {
                    return 'web';
                }
                else {
                    return platform;
                }
            }
        }

        // We do not use push on older blackberry devices.
        if(!isOldBlackberry) {
            console.log("Enabling push...");
            // Handle resume
            document.addEventListener('resume', function() {
                PushNotification.getIncoming(handlePush);
            }, false)

            PushNotification.getIncoming(handlePush);

            // Ask if the push is enabled, if not, enable it.
            PushNotification.subscribe({
                platform: getPlatform()
            }, function(err, token) {
                if(err) {
                    console.log("Failed to enable push: " + err);
                }
                else {
                    console.log("Push was enabled, token is " + token);
                }
            });
        }
    }, false);

    if (!navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|Windows Phone)/)) {
        window.setTimeout(function() {
            navigator.notification = window;
            var e = document.createEvent('Events');
            e.initEvent("deviceready", false, false);
            console.log('Firing fake deviceready event...');
            document.dispatchEvent(e);
        }, 200);
    }
}]);

tnp.filter('tel', function () {
    return function (tel) {
        if(!tel) {
            return '';
        }

        return tel.replace(/[^0-9+]/g, '');
    };
});

// console.log = function() {};


'use strict';

var Database = (function() {

    function Database(config) {
        this.name = config.name;
        this.version = config.version;
        this.displayName = config.displayName;
        this.size = config.size;
    };

    Database.prototype.create = function(schema, callback) {
        if(callback) callback(new Error('The create method is not implemented.'));
    };

    Database.prototype.insert = function(table, object, callback) {
        if(callback) callback(new Error('The insert method is not implemented.'));
    };

    Database.prototype.select = function(table, fields, options, callback) {
        if(callback) callback(new Error('The select method is not implemented.'));
    };

    Database.prototype._convertWhere = function(where) {
        var query = convertHelper(where, {join: 'AND'});

        return convertToQuery(query.items).join(' ' + query.join + ' ');


                /*
        {
            join: 'AND',
            items: [
                {
                    join: '=',
                    key: 'department'.
                    value: 'test'
                },
                {
                    join: 'OR',
                    items: [
                        {
                            join: '=',
                            key: 'blabla',
                            value: 'PFF'
                        }
                        {
                            join: 'AND'
                            items: [
                                {
                                    join: '>',
                                    key: 'blabla',
                                    value: 'test'
                                },
                                {
                                    join: '<',
                                    key: 'blabla',
                                    value: 'test'
                                }
                            ]
                        }
                    ]
                }
            ]
        }

        WHERE department=test AND (test='PFF' OR (blabla>test AND blabla<test))

        {department: 'test', or: {test: 'PFF', blabla: {gt: 'test', lt: 'pff'}}}
         */

        function convertHelper(object, query) {
            var result = query;
            result.items = result.items || [];

            if(Array.isArray(object)) {
                for(var i=0; i<object.length; i++) {
                    convertHelper(object[i], result);
                }
            }
            else {
                for(var key in object) {
                    var value = object[key];

                    if(key === 'or') {
                        result.items.push(convertHelper(value, {join: 'OR'}))
                    }
                    else if(key === 'and') {
                        result.items.push(convertHelper(value, {join: 'AND'}));
                    }
                    else if(typeof value === 'object') {
                        var item = {
                            join: 'AND',
                            items: []
                        };

                        for(var k in value) {
                            var q = {
                                join: '',
                                key: key,
                                value: value[k]
                            }

                            if(k === 'eq')          q.join = '=';
                            else if(k === 'neq')    q.join = '!=';
                            else if(k === 'gt')     q.join = '>';
                            else if(k === 'gte')    q.join = '>=';
                            else if(k === 'lt')     q.join = '<';
                            else if(k === 'lte')    q.join = '<=';

                            item.items.push(q);
                        }

                        result.items.push(item);
                    }
                    else {
                        result.items.push({
                            join: '=',
                            key: key,
                            value: value
                        });
                    }  
                }
            }

            return result;
        };

        function convertToQuery(array) {
            var result = new Array();

            for(var i=0; i<array.length; i++) {
                if(array[i].items) {
                    result.push('(' + convertToQuery(array[i].items).join(' ' + array[i].join + ' ') + ')');
                }
                else {
                    var value = array[i].value;

                    if(isNaN(value)) {
                        value = '\'' + value + '\'';
                    }

                    if(value == '\'NULL\'') {
                        if(array[i].join == '=') {
                            result.push('`' + array[i].key + '` IS NULL');
                        }
                        else {
                            result.push('`' + array[i].key + '` IS NOT NULL');
                        }
                    }
                    else {
                        result.push('`' + array[i].key + '`' + array[i].join + value);
                    }
                }
            }

            return result;
        };
    };

    return Database;
})();

'use strict';

/**
 * This derived class is a Database class that provides a uniform set of methods for the developer
 * for creating, inserting and selecting data of an IndexedDB database. It is important to note
 * that Windows Phone 7 and 8 do not have a WebSQL database so that an IndexedDB should be used.
 * 
 * @author Sam Verschueren      <verschueren.sam@endare.eu>
 * @since  3 Jan. 2014
 */
var IndexedDB = (function() {

    var _super;                                         // Store a reference to the parent object

    /**
     * Creates a new IndexedDB object that can be used to create, select or insert data
     * from an IndexedDB database.
     * 
     * @param {Object} config The configuration object.
     */
    function IndexedDB(config) {
        _super = new Database(config);                  // Call the parent
    };

    IndexedDB.prototype = clone(Database.prototype);    // Copy the prototypes before defining our own!

    IndexedDB.prototype.select = function(table, fields, options, callback) {
        if(!_super.database) {
            if(callback) callback(new Error('Database does not exists.'));
            return;
        }

        if(!Array.isArray(fields)) {
            // If fields is not an array and fields is a function, the fields present the callback
            // and the options are empty
            if(!!(fields && fields.constructor && fields.call && fields.apply)) {
                callback = fields;
                options = {};
                fields = ['*'];
            }
            // If fields is not an array and not a function, the fields represent the options
            else {
                callback = options;
                options = fields;
                fields = ['*'];
            }
        }
        else {
            // if options is a function, it has to be the callback.
            if(!!(options && options.constructor && options.call && options.apply)) {
                callback = options;
                options = {};
            }
        }

        var objectStore = _super.database.transaction(table).objectStore(table);

        var result = [];
        var where = _this.convertWhere(options.where);

        console.log(options);

        objectStore.openCursor().onsuccess = function(event) {
            var cursor = event.target.result;

            if(cursor) {
                var filtered = _this.filter(cursor.value, fields, where);

                if(filtered) {
                    result.push(filtered);
                }

                cursor.continue();
            }
            else {
                _this.order(options.order, result, function(sorted) {
                    console.log('splice on ' + (options.offset || 0) + ' , ' + (options.limit || 0));

                    

                    callback(undefined, sorted.splice(options.offset || 0, options.limit || 0));
                });
            }
        };
    };

    /**
     * This method will insert one or more objects into the objectstore. The second parameter
     * could be an object or an array.
     * 
     * @param  {String}         table    The name of the objectstore.
     * @param  {Object|Array}   object   The object or objects that should be inserted.
     * @param  {Function}       callback The callback method that should be fired if it succeeds or if something fails.
     */
    IndexedDB.prototype.insert = function(table, object, callback) {
        if(!_super.database) {
            if(callback) callback(new Error('Database does not exists.'));
            return;
        }

        // If the object passed is not an array, convert it to an array with one item.
        if(!Array.isArray(object)) {
            object = [object];
        }

        // Start the transaction in readwrite mode. Other options are readonly and versionchange.
        var transaction = _super.database.transaction([table], 'readwrite');

        // If the transaction completed, call the callback method.
        transaction.oncomplete = function() {
            if(callback)
                callback();
        };
        
        try {
            // Try to grab the store, it throws an exception when the store does not exist
            var store = transaction.objectStore(table);
        }
        catch(e) {
            switch(e.code) {
                case 8:
                    if(callback) callback(new Error('The table ' + table + ' does not exists.'));
                    break;
                default:
                    if(callback) callback(new Error(e.message));
                    break;
            }

            return;
        }

        //Start the iteration process
        var i=0;
        putNext();

        function putNext() {
            if(i<object.length) {
                var request = store.put(object[i++]);

                request.onsuccess = putNext();

                request.onerror = function(e) {
                    if(callback) callback(e.value);
                };
            }
        }
    };

    /**
     * This method will create the object stores that are defined in the schema. IndexedDB does not
     * need to know the types because it works liks a key value pair.
     * 
     * @param  {Object}   schema   The schema of the database.
     * @param  {Function} callback The callback that is called when the creation proces succeeds or fails.
     */
    IndexedDB.prototype.create = function(schema, callback) {
        // Open the database
        var request = window.indexedDB.open(_super.name);

        // The on success method is fired after the onupgradeneeded or if no version change was made
        request.onsuccess = function() {
            _super.database = request.result;

            return callback();
        };

        // When we fail to open the database, fire the callback with an error message
        request.onerror = function() {
            if(callback) return callback(new Error('Could not open database'));
        };

        // We can only create Object stores in a versionchange transaction.
        request.onupgradeneeded = function() {
            // Store the database in the parent
            _super.database = request.result;

            var index = undefined;

            // Iterate over the schema
            for(var i=0; i<schema.length; i++) {
                // Search for the primary key
                for(var key in schema[i].fields) {
                    if(schema[i].fields[key].toLowerCase().indexOf('primary key') > -1) {
                        index = key;
                    }
                }

                // Use the index that was defined in the schema or make on of our own.
                index = index || 'ID';

                console.log('Create database ' + schema[i].name + ' with index ' + index);

                // Create the objectstore
                _super.database.createObjectStore(schema[i].name, {keyPath: index});
            }
        };
    };

    var _this = {
        filter: function(value, fields, where) {
            var result = {};

            if(where == '') {
                return value;
            }

            for(var key in value) {
                var val = typeof value[key] === 'boolean' ? (value[key] ? 1 : 0) : value[key];

                where = where.replace(new RegExp('`' + key + '`', 'g'), val);
            }

            var evaluated = eval(where);

            if(!evaluated) {
                return undefined;
            }

            return generateObject(value);

            function generateObject(value) {
                if(fields.length == 1 && fields[0] == '*') {
                    return value;
                }
                else {
                    var result = {};

                    for(var i=0; i<fields.length; i++) {
                        var f = fields[i];

                        if(value[f]) {
                            result[f] = value[f];
                        }
                    }

                    return result;
                }
            }
        },
        convertWhere: function(where) {
            return _super._convertWhere(where)
                        .replace(/AND/g, '&&')
                        .replace(/OR/g, '||')
                        .replace(/=/g, '==')
                        .replace(/<==/g, '<=')
                        .replace(/>==/g, '>=')
                        .replace(/IS NULL/g, '==null')
                        .replace(/IS NOT NULL/g, '!=null');
        },
        order: function(order, array, callback) {
            if(!order) {
                return callback(array);
            }

            var splitted = order.split(' ');
            if(splitted.length == 1) splitted.push('ASC');

            array.sort(function(a, b) {
                var one = a[splitted[0]];
                var two = b[splitted[0]];

                if(typeof one === 'string') {
                    return one.localeCompare(two);
                }
                else if(typeof one === 'number') {
                    return one - two;
                }
            });

            if(splitted[1].toLowerCase() == 'desc') {
                array.reverse();
            }

            callback(array);
        }
    };

    return IndexedDB;
})();

'use strict';

/**
 * This derived class is a Database class that provides a uniform set of methods for the developer
 * for creating, inserting and selecting data of a WebSQL database. It is important to note
 * that Windows Phone 7 and 8 do not have a WebSQL database so that an IndexedDB should be used.
 *
 * @author Sam Verschueren      <verschueren.sam@endare.eu>
 * @since  3 Jan. 2014
 */
var WebSQL = (function() {

    var _super;                                         // Store a reference to the parent object

    /**
     * Creates a new WebSQL object that can be used to create, select or insert data
     * from a WebSQL database.
     *
     * @param {Object} config The configuration object.
     */
    function WebSQL(config) {
        _super = new Database(config);                  // Call the parent
    };

    WebSQL.prototype = clone(Database.prototype);       // Copy the prototypes before defining our own!

    WebSQL.prototype.select = function(table, fields, options, callback) {
        if(!_super.database) {
            if(callback) callback(new Error('Database does not exists.'));
            return;
        }

        if(!Array.isArray(fields)) {
            // If fields is not an array and fields is a function, the fields present the callback
            // and the options are empty
            if(!!(fields && fields.constructor && fields.call && fields.apply)) {
                callback = fields;
                options = {};
                fields = ['*'];
            }
            // If fields is not an array and not a function, the fields represent the options
            else {
                callback = options;
                options = fields;
                fields = ['*'];
            }
        }
        else {
            // if options is a function, it has to be the callback.
            if(!!(options && options.constructor && options.call && options.apply)) {
                callback = options;
                options = {};
            }
        }

        _super.database.readTransaction(function(tx) {
            var query = 'SELECT ' + fields.join(', ') + ' FROM `' + table + '`';

            // construct the where clause
            if(options.where) {
                query += ' WHERE ' + _super._convertWhere(options.where);
            }

            if(options.order) {
                query += ' ORDER BY ' + options.order;
            }

            if(options.limit) {
                query += ' LIMIT ' + options.limit;
            }

            if(options.offset) {
                query += ' OFFSET ' + options.offset;
            }

            tx.executeSql(query, [], function (tx, results) {
                var r = new Array();

                for(var i=0; i<results.rows.length; i++) {
                    r.push(results.rows.item(i));
                }

                return callback(undefined, r);
            }, function (tx, err) {
                console.log(err);
                return callback(err);
            });
        });
    };

    /**
     * This method will insert one or more objects into the database. The second parameter
     * could be an object or an array.
     *
     * @param  {String}         table    The name of the table.
     * @param  {Object|Array}   object   The object or objects that should be inserted.
     * @param  {Function}       callback The callback method that should be fired if it succeeds or if something fails.
     */
    WebSQL.prototype.insert = function(table, object, callback) {
        if(!_super.database) {
            if(callback) callback(new Error('Database does not exists.'));
            return;
        }

        _super.database.transaction(function(tx) {
            var keys = new Array();
            var placeholders = new Array();
            var values;

            if(!Array.isArray(object)) {
                object = [object];
            }

            if(object.length == 0) {
                callback();
            }

            // Create two arrays with the keys and with the placeholders
            map(object[0], keys, placeholders);

            // Create a prepared statement
            var query = 'INSERT OR REPLACE INTO `' + table + '`(' + keys.join(',') + ') VALUES(' + placeholders.join(', ') + ')';
            var count = object.length;

            // Iterate over the objects and insert the values.
            for(var i=0; i<object.length; i++) {
                tx.executeSql(query, getValues(object[i]), function() {
                    if(--count == 0 && callback) {
                        callback();
                    }
                }, function(tx, err) {
                    callback(err);
                });
            }

            function map(object, keys, placeholers) {
                for(var i in object) {
                    keys.push('`' + i + '`');
                    placeholders.push('?');
                }
            }

            function getValues(object) {
                var values = new Array();

                for(var i in object) {
                    var val = object[i];

                    if(typeof val === 'boolean') {
                        val = val ? 1 : 0;
                    }

                    values.push(val);
                }

                return values;
            }
        });
    };

    /**
     * This method will create the tables that are defined in the schema.
     *
     * @param  {Object}   schema   The schema of the database.
     * @param  {Function} callback The callback that is called when the creation proces succeeds or fails.
     */
    WebSQL.prototype.create = function(schema, callback) {
        _super.database = window.openDatabase(_super.name, _super.version, _super.displayName, _super.size);

        // If the database does not exist, execute the callback.
        if(!_super.database) {
            if(callback) callback(new Error('Could not open database'));

            return;
        }

        // Start a database transaction to create the database tables.
        _super.database.transaction(create, function(err) {
            if(callback)
                callback(err);
        }, function() {
            if(callback)
                callback();
        });

        /**
         * This method creates the database depending on the schema provided
         *
         * @param {Object} tx The transaction object of the database.
         */
        function create(tx) {
            for(var i=0; i<schema.length; i++) {
                var table = schema[i];

                var fields = new Array();

                for(var k in table.fields) {
                    fields.push('`' + k + '` ' + table.fields[k]);
                }

                //tx.executeSql('DROP TABLE IF EXISTS `' + table.name + '`');
                tx.executeSql('CREATE TABLE IF NOT EXISTS `' + table.name + '`(' + fields.join(', ') + ')');
            }
        }
    };

    return WebSQL;
})();


'use strict';

/**
 * This derived class is a Database class that provides a uniform set of methods for the developer
 * for creating, inserting and selecting data of a LocalStorage database. It is important to note
 * that Windows Phone 7 and 8 do not have a WebSQL database so that a LocalStorage database should 
 * be used. IndexedDB could be used as well, but BlackBerry OS stores its database on the Micro SD
 * card. So when running on BlackBerry OS, we should use the LocalStorage as well.
 * 
 * @author Sam Verschueren      <verschueren.sam@endare.eu>
 * @since  22 Jan. 2014
 */
var LocalStorage = (function() {

    var _super;                                             // Store a reference to the parent object

    /**
     * Creates a new LocalStorage object that can be used to create, select or insert data
     * from a LocalStorage database.
     * 
     * @param {Object} config The configuration object.
     */
    function LocalStorage(config) {
        _super = new Database(config);                      // Call the parent

        _super.database = window.localStorage;
    }

    LocalStorage.prototype = clone(Database.prototype);     // Copy the prototypes before defining our own!

    /**
     * This method selects data from the database.
     * 
     * @param  string     tableName The name of the table
     * @param  array      fields    The fields we want to retrieve.
     * @param  object     options   Some options such as order, offset, limit
     * @param  Function   callback  The callback method that should be invoked with the results.
     */
    LocalStorage.prototype.select = function(tableName, fields, options, callback) {
        if(!_super.database) {
            if(callback) callback(new Error('Database does not exists.'));
            return;
        }

        if(!Array.isArray(fields)) {
            // If fields is not an array and fields is a function, the fields present the callback
            // and the options are empty
            if(!!(fields && fields.constructor && fields.call && fields.apply)) {
                callback = fields;
                options = {};
                fields = ['*'];
            }
            // If fields is not an array and not a function, the fields represent the options
            else {
                callback = options;
                options = fields;
                fields = ['*'];
            }
        }
        else {
            // if options is a function, it has to be the callback.
            if(!!(options && options.constructor && options.call && options.apply)) {
                callback = options;
                options = {};
            }
        }

        var table = _super.database.getObject(tableName).data;

        var result = [];
        var where = _this.convertWhere(options.where);

        for(var key in table) {
            var filtered = _this.filter(table[key], fields, where);

            if(filtered) {
                result.push(filtered);
            }
        }

        _this.order(options.order, result, function(sorted) {
            if(options.limit) {
                return callback(undefined, sorted.splice(options.offset || 0, options.limit));
            }

            return callback(undefined, sorted);
        });
    };

    /**
     * This method will insert one or more objects into the objectstore. The second parameter
     * could be an object or an array.
     * 
     * @param  {String}         tableName   The name of the objectstore.
     * @param  {Object|Array}   object      The object or objects that should be inserted.
     * @param  {Function}       callback    The callback method that should be fired if it succeeds or if something fails.
     */
    LocalStorage.prototype.insert = function(tableName, object, callback) {
        if(!_super.database) {
            if(callback) callback(new Error('Database does not exists.'));
            return;
        }

        // If the object passed is not an array, convert it to an array with one item.
        if(!Array.isArray(object)) {
            object = [object];
        }

        var table = _super.database.getObject(tableName);

        for(var i=0; i<object.length; i++) {
            var key = object[i][table.index];

            table.data[key] = object[i];
        }

        _super.database.setObject(tableName, table);

        callback();
    };

    /**
     * This method will create the correct objects in the localstorage. LocalStorage does not need
     * to know the types because it works likes a key value pair system.
     * 
     * @param  {Object}   schema   The schema of the database.
     * @param  {Function} callback The callback that is called when the creation proces succeeds or fails.
     */
    LocalStorage.prototype.create = function(schema, callback) {
        // Iterate over the schema
        for(var i=0; i<schema.length; i++) {
            // Do not create if it already exists
            if(!_super.database.getObject(schema[i].name)) {
                var index = undefined;

                // Search for the primary key
                for(var key in schema[i].fields) {
                    if(schema[i].fields[key].toLowerCase().indexOf('primary key') > -1) {
                        index = key;
                    }
                }

                index = index || 'ID';

                // Create the table
                _super.database.setObject(schema[i].name, {index: index, data: {}});
            }
        }

        callback();
    };

    var _this = {
        filter: function(value, fields, where) {
            var result = {};

            if(where == '') {
                return generateObject(value);
            }

            for(var key in value) {
                var val = typeof value[key] === 'boolean' ? (value[key] ? 1 : 0) : value[key];

                where = where.replace(new RegExp('`' + key + '`', 'g'), val);
            }

            var evaluated = eval(where);

            if(!evaluated) {
                return undefined;
            }

            return generateObject(value);

            function generateObject(value) {
                if(fields.length == 1 && fields[0] == '*') {
                    return value;
                }
                else {
                    var result = {};

                    for(var i=0; i<fields.length; i++) {
                        var f = fields[i];

                        if(value[f]) {
                            result[f] = value[f];
                        }
                    }

                    return result;
                }
            }
        },
        convertWhere: function(where) {
            return _super._convertWhere(where)
                        .replace(/AND/g, '&&')
                        .replace(/OR/g, '||')
                        .replace(/=/g, '==')
                        .replace(/<==/g, '<=')
                        .replace(/>==/g, '>=')
                        .replace(/IS NULL/g, '==null')
                        .replace(/IS NOT NULL/g, '!=null');
        },
        order: function(order, array, callback) {
            if(!order) {
                return callback(array);
            }

            var splitted = order.split(' ');
            if(splitted.length == 1) splitted.push('ASC');

            array.sort(function(a, b) {
                var one = a[splitted[0]];
                var two = b[splitted[0]];

                if(typeof one === 'string') {
                    return one.localeCompare(two);
                }
                else if(typeof one === 'number') {
                    return one - two;
                }
            });

            if(splitted[1].toLowerCase() == 'desc') {
                array.reverse();
            }

            callback(array);
        }
    };

    return LocalStorage;
})();

// Extension methods for the local storage
Storage.prototype.setObject = function(key, value) {
    this.setItem(key, JSON.stringify(value));
}

Storage.prototype.getObject = function(key) {
    return JSON.parse(this.getItem(key));
}

'use strict';

/**
 * This class forms the controller for the detail view of the 
 * detection section of the application.
 *
 * @author  Sam Verschueren <verschueren.sam@endare.eu>
 * @since   20 Nov. 2013
 */

function DetectionDetailCtrl($scope, $location, $routeParams, $detectionService) {
    if(!$detectionService.cache.data[$routeParams.id]) {
        // If the officer does not exist in the cache, go back
        $location.path('/detections');
        return;
    }

    $scope.detection = $detectionService.cache.data[$routeParams.id];
};

// Inject the correct instances into the controller
DetectionDetailCtrl.$inject = ['$scope', '$location', '$routeParams', '$detectionService'];

'use strict';

/**
 * This class forms the controller of the detail of the office section.
 * 
 * @author  Sam Verschueren <verschueren.sam@endare.eu>
 * @since   18 Dec. 2013
 */

function OfficeDetailCtrl($scope, $location, $routeParams, $officeService, $config) {
    if(!$officeService.cache.data[$routeParams.id]) {
        // If the officer does not exist in the cache, go back
        $location.path('/offices');
        return;
    }

    $scope.office = $officeService.cache.data[$routeParams.id];
    $scope.office.mapurl = $config.MAPS_URI.replace('{{address}}', $scope.office.address + ',' + $scope.office.zipcode + '+' + $scope.office.city);
    $scope.isLoading = true;

    $officeService.findOfficeById($scope.office.ID, function(err, data) {
        $scope.office.contacts = data.contacts;
        $scope.office.visitinghours = data.visitinghours;

        $scope.isLoading = false;
    });

    $scope.openMap = function() {
        if($scope.office.mapurl.indexOf('maps:') == 0) {
            window.location.href = $scope.office.mapurl;
        }
        else {
            window.open($scope.office.mapurl, '_system');
        }        
    };
};

// Inject the correct instances into the controller
OfficeDetailCtrl.$inject = ['$scope', '$location', '$routeParams', '$officeService', '$config'];

'use strict';

/**
 * This class forms the controller for the detection section of the application.
 *
 * @author  Sam Verschueren <verschueren.sam@endare.eu>
 * @since   20 Nov. 2013
 */

function DetectionCtrl($scope, $location, $detectionService) {
    $scope.detections = $detectionService.cache.data;
    $scope.isLoading = false;

    var clearCache = true;

    var loads = 0;

    $scope.loadMore = function() {
        $detectionService.findDetections($scope.detections.length, function(err, detections) {
            if(err) {
                console.log(err);
            }

            for(var i=0; i<detections.length; i++) {
                $detectionService.cache.data.push(detections[i]);
            }

            $scope.isLoading = false;
            if(!$scope.$$phase) $scope.$apply();

            if(window.innerHeight > 500 && $scope.detections.length < 20 && ++loads < 2) {
                $scope.loadMore();
            }
        });
    };

    $scope.showDetail = function(id) {
        clearCache = false;

        $location.path('/detections/' + id);
    };

    $scope.$on('$destroy', function() {
        if(clearCache) {
            $detectionService.cache.data = new Array();
        }
    });

    if($scope.detections.length == 0) {
        $scope.isLoading = true;
        $scope.loadMore();
    }
};

// Inject the correct instances into the controller
DetectionCtrl.$inject = ['$scope', '$location', '$detectionService'];

'use strict';

/**
 * This class forms the controller for the detail view of the 
 * checks section of the application.
 *
 * @author  Sam Verschueren <verschueren.sam@endare.eu>
 * @since   19 Nov. 2013
 */

function CheckDetailCtrl($scope, $location, $routeParams, $checkService) {
    if(!$checkService.cache.data[$routeParams.id]) {
        // If the officer does not exist in the cache, go back
        $location.path('/checks');
        return;
    }

    $scope.check = $checkService.cache.data[$routeParams.id];
};

// Inject the correct instances into the controller
CheckDetailCtrl.$inject = ['$scope', '$location', '$routeParams', '$checkService'];

'use strict';

/**
 * This controller controls the detail page of the newsitems.
 * 
 * @author  Sam Verschueren     <verschueren.sam@endare.eu>
 * @since   28 Nov. 2013
 */

function NewsDetailCtrl($scope, $routeParams, $newsService, $config, $sce) {
    $scope.isLoading = true;

    $newsService.findNewsById($routeParams.id, function(err, data) {
        $scope.item = data;

        var news = $scope.item.news.replace(/<a[^>]*href="(?!mailto:)([^>"]*)"[^>]*>/g, "<a onclick=\"window.open('$1', '_system');\">");

        $scope.item.news = $sce.trustAsHtml(news);

        if($scope.item.imageextension != '' && $scope.item.imageextension != null && $scope.item.imageextension != undefined) {
            $scope.item.image = $config.BASE_URI + '/images/uploads/' + $scope.item.department + '/newsitem' + $scope.item.ID + $scope.item.imageextension;
        }

        $scope.isLoading = false;
    });
};

// Inject the correct instances into the controller
NewsDetailCtrl.$inject = ['$scope', '$routeParams', '$newsService', '$config', '$sce'];

'use strict';

/**
 * This class forms the controller of the office section.
 * 
 * @author  Sam Verschueren <verschueren.sam@endare.eu>
 * @since   18 Dec. 2013
 */

function OfficeCtrl($scope, $location, $officeService) {
    $scope.offices = $officeService.cache.data;
    $scope.isLoading = false;

    var clearCache = true;

    if($scope.offices.length === 0) {
        $scope.isLoading = true;

        $officeService.findOffices(function(err, data) {
            $scope.offices = $officeService.cache.data = data;     

            $scope.isLoading = false;   
        });
    }

    $scope.$on('$destroy', function() {
        if(clearCache) {
            $officeService.cache.data = new Array();
        }
    });

    $scope.showDetail = function(id) {
        clearCache = false;

        $location.path('/offices/' + id);
    };
};

// Inject the correct instances into the controller
OfficeCtrl.$inject = ['$scope', '$location', '$officeService'];

'use strict';

/**
 * This class forms the controller of the officer section.
 *
 * @author  Sam Verschueren <verschueren.sam@endare.eu>
 * @since   18 Dec. 2013
 */

function OfficerDetailCtrl($scope, $location, $routeParams, $officerService) {
    if(!$officerService.cache.officers[$routeParams.id]) {
        // If the officer does not exist in the cache, go back
        $location.path('/officers');
        return;
    }

    var search = $location.search();

    $scope.officer = $officerService.cache.officers[$routeParams.id];
    $scope.officer.contact = undefined;
    $scope.isLoading = true;
    $scope.pages = search.goback || 1;

    $officerService.findOfficerById($routeParams.id, function(err, officer) {
        $scope.officer.contacts = officer.contacts;
        $scope.isLoading = false;
    });
};

// Inject the correct instances into the controller
OfficerDetailCtrl.$inject = ['$scope', '$location', '$routeParams', '$officerService'];

'use strict';

/**
 * This class forms the controller of the officer section. The officers will be kept
 * in the cache during the entire lifetime of the application. Be aware of this!
 *
 * @author  Sam Verschueren <verschueren.sam@endare.eu>
 * @since   18 Dec. 2013
 */

function OfficerCtrl($scope, $location, $officerService) {
    $scope.regions = $officerService.cache.data;
    $scope.isLoading = false;

    if($scope.regions.length == 0) {
        $scope.isLoading = true;

        $officerService.findRegions(function(err, regions) {
            regions = regions || [];

            $scope.regions = $officerService.cache.data = regions;

            for(var i=0; i<regions.length; i++) {
                for(var j=0; j<regions[i].officers.length; j++) {
                    var officer = regions[i].officers[j];

                    $officerService.cache.officers[officer.ID] = officer;
                }
            }

            $scope.isLoading = false;
        });
    }

    $scope.showDetail = function(id) {
        $location.path('/officers/' + id);

    };
};

// Inject the correct instances into the controller
OfficerCtrl.$inject = ['$scope', '$location', '$officerService'];

'use strict';

/**
 * This class forms the controller for the news section of the application.
 *
 * @author 	Sam Verschueren <verschueren.sam@endare.eu>
 * @since 	19 Nov. 2013
 */

function NewsCtrl($scope, $location, $newsService) {
	$scope.isLoading = false;
	$scope.news = $newsService.cache.data;

	var clearCache = true;

	var loads = 0;

	$scope.loadMore = function() {
		$newsService.findNews($scope.news.length, function(err, data) {
			if(err) {
				console.log(err.message);
				return;
			}

			for(var i=0; i<data.length; i++) {
				$newsService.cache.data.push(data[i]);
			}

			$scope.isLoading = false;
			if(!$scope.$$phase) $scope.$apply();

			if(window.innerHeight > 500 && $scope.news.length < 20 && ++loads < 2) {
                $scope.loadMore();
            }
		});
	};

	$scope.showDetail = function(id) {
		clearCache = false;
        
        $location.path('/news/' + id);
	};

	$scope.$on('$destroy', function() {
		if(clearCache) {
			$newsService.cache.data = new Array();
		}
	});

	if($scope.news.length == 0) {
		$scope.isLoading = true;
		$scope.loadMore();
	}
};

// Inject the correct instances into the controller
NewsCtrl.$inject = ['$scope', '$location', '$newsService'];

'use strict';


function OfficerSearchCtrl($scope, $location, $locationService, $officerService) {
    $scope.isSearching = false;

    $scope.loadStreet = function() {
        if(!$scope.isSearching){
            $scope.isSearching = true;

            $locationService.location({enableHighAccuracy: true}).then(function(location){
                
                $officerService.findStreet(location.latitude, location.longitude, function(err, response){
                    if(err) {
                        return onFail();
                    }

                    $scope.street = response.street;
                    $scope.isSearching = false;
                });
            }, onFail);
        }
    }

    $scope.goToOfficer = function() {
        $scope.error = '';

        $location.path('/officers/location').search('street', $scope.street);
    };

    function onFail(){
        $scope.street = '';
        $scope.isSearching = false;
        $scope.error = 'Kan uw huidige locatie niet opvragen. Probeer het later opnieuw.';
    }
};

// Inject the correct instances into the controller
OfficerSearchCtrl.$inject = ['$scope', '$location', '$locationService', '$officerService'];

'use strict';

function HomeCtrl($scope, $config, $alertService) {
    $scope.title = $config.DEPARTMENT_NAME;
    $scope.subtitle = $config.DEPARTMENT_REGIONS;

    $alertService.cache.reset();
};

HomeCtrl.$inject = ['$scope', '$config', '$alertService'];

'use strict';

/**
 * This class forms the controller for the alert section.
 * 
 * @author Sam Verschueren      <verschueren.sam@endare.eu>
 * @since  20 Dec. 2013
 */

function AlertCtrl($scope, $location, $alertService, $uiService, $config, $locationService, $route, $history) {
    // If the user did not accept the disclaimer, show it to him
    if(!window.localStorage.getItem('disclaimer')) {
        var confirm = {
            title: 'Disclaimer',
            labels: ['Ik ga akkoord', 'Ik ga NIET akkoord'],
            message: '<p>Deze applicatie van de ' + $config.DEPARTMENT_NAME + ' is niet bedoeld voor dringende meldingen. Als u dringend hulp nodig heeft bel dan de Politie of de Hulpdiensten.</p><p>Alle gegevens die via deze applicatie worden geregistreerd, worden enkel gebruikt door agenten van de politiezone. Door een melding te versturen gaat u akkoord dat men u kan contacteren voor eventuele vragen en opmerkingen.</p>'
        };


        $uiService.confirm(confirm, function(confirmed) {
            if(!confirmed) {
                $scope.$apply(function() {
                    $history.back();
                });
            }
            else {
                window.localStorage.setItem('disclaimer', true);
            }
        });
    }

    $scope.errors = {
        description: false,
        category: false,
        name: false,
        email: false,
        phone: false,
        location: false
    };

    $scope.alert = $alertService.cache.data;
    $scope.categories = $alertService.cache.categories;

    $scope.getPicture = function(type) {
        var config = {
            quality: 49, 
            destinationType: Camera.DestinationType.DATA_URL, 
            sourceType: type, 
            encodingType: Camera.EncodingType.JPEG, 
            targetWidth: 1024, 
            targetHeight: 768, 
            correctOrientation: false
        };

        navigator.camera.getPicture(function(data) {
            $scope.alert.image = data;
            $scope.$apply();
        }, function() {

        }, config);
    };

    $scope.next = function(step) {
        if(step == 1) {
            $scope.errors.description = $scope.alert.description === undefined;
            $scope.errors.category = $scope.alert.category === undefined;

            if(!$scope.errors.description && !$scope.errors.category) {
                $location.path('/alerts/image');
            }
        }
        else if(step == 2) {
            $location.path('/alerts/finish');
        }
        else if(step == 3) {
            $scope.errors.name = !$scope.alert.name;
            $scope.errors.email = !$scope.alert.email;
            $scope.errors.phone = !$scope.alert.phone;

            if(!$scope.errors.name && !$scope.errors.email && !$scope.errors.phone) {
                window.localStorage.setItem('name', $scope.alert.name);
                window.localStorage.setItem('email', $scope.alert.email);
                window.localStorage.setItem('phone', $scope.alert.phone);

                $location.path('/alerts/upload');
            }
        }
    };

    $scope.init = function(step) {
        if(step == 3) {
            $scope.alert.name = window.localStorage.getItem('name');
            $scope.alert.email = window.localStorage.getItem('email');
            $scope.alert.phone = window.localStorage.getItem('phone');

            $locationService.location({enableHighAccuracy: true}).then(function(location) {
                $scope.alert.location = location;
            }, function() {
                $scope.errors.location = true;
            });
        }
        else if(step == 4) {
            $alertService.createAlert($scope.alert, function(err, data) {
                // if(err) {

                //     return;
                // }
                
                $history.go(4);
            });
        }
    };
};

// Inject the correct instances into the controller
AlertCtrl.$inject = ['$scope', '$location', '$alertService', '$uiService', '$config', '$locationService', '$route', '$history'];

'use strict';

/**
 * This controller knows how to show the officers by location of the device.
 *
 * @author  Sam Verschueren <verschueren.sam@endare.eu>
 * @since   27 Dec. 2013
 */

function OfficerLocationCtrl($scope, $location, $officerService, $locationService) {
    $scope.officers = [];

    function init(){
        var search = $location.search();

        $officerService.findOfficersByLocation(search.street, onOfficersFound);
    }

    function onOfficersFound(err, officers) {
        $scope.error = '';

        if(officers && officers.length > 0){
            if(officers.length == 1) {
                $scope.showDetail(officers[0].ID);
            }
            else {
                $scope.officers = officers;
            }
        }
        else {
            $scope.error = "Er zijn geen wijkinspecteurs gevonden op uw locatie.";
        }

        $scope.isLoading = false;
    }

    $scope.showDetail = function(id) {
        $location.path('/officers/' + id).search('goback', 3);
    };

    $scope.searchWithNumber = function() {
        if(!$scope.housenumber || $scope.housenumber == '' || isNaN($scope.housenumber)) {
            $scope.housenumber = '';
            $scope.numberError = true;
            return;
        }

        $scope.numberError = undefined;
        $scope.isLoading = true;

        var number = $scope.housenumber;
        var i=0;
        var officer = undefined;

        while(i<$scope.officers.length && officer === undefined) {
            var o = $scope.officers[i];

            var ofs = o.streets;

            var j = 0;

            while(j<ofs.length && !officer){
                var s = ofs[j];

                if(s.nr == number ||
                   s.even && number%2 == 0 ||
                   s.odd && number%2 != 0 ||
                   number >= s.rangeFrom && number <= s.rangeTo) {
                    officer = o;
                }

                ++j
            }

            ++i;
        }

        if(officer) {
            $location.path('/officers/' + officer.ID).search('goback', 3);
        }
        else {
            $scope.error = "Er zijn geen wijkinspecteurs gevonden op uw locatie.";
        }

        $scope.isLoading = false;
    };

    init();
};

// Inject the correct instances into the controller
OfficerLocationCtrl.$inject = ['$scope', '$location', '$officerService', '$locationService'];


'use strict';

/**
 * This class forms the controller for the checks section of the application.
 *
 * @author  Sam Verschueren <verschueren.sam@endare.eu>
 * @since   19 Nov. 2013
 */

function CheckCtrl($scope, $location, $checkService) {
    $scope.checks = $checkService.cache.data;
    $scope.isLoading = false;

    var clearCache = true;

    var loads = 0;

    $scope.loadMore = function() {
        $checkService.findChecks($scope.checks.length, function(err, checks) {
            if(err) {
                console.log(err);
            }

            for(var i=0; i<checks.length; i++) {
                $checkService.cache.data.push(checks[i]);
            }

            $scope.isLoading = false;
            if(!$scope.$$phase) $scope.$apply();

            if(window.innerHeight > 500 && $scope.checks.length < 20 && ++loads < 2) {
                $scope.loadMore();
            }
        });
    };

    $scope.showDetail = function(id) {
        clearCache = false;

        $location.path('/checks/' + id);
    };

    $scope.$on('$destroy', function() {
        if(clearCache) {
            $checkService.cache.data = new Array();
        }
    });

    if($scope.checks.length == 0) {
        $scope.isLoading = true;

        $scope.loadMore();
    }
};

// Inject the correct instances into the controller
CheckCtrl.$inject = ['$scope', '$location', '$checkService'];


















'use strict';

/**
 * This Service is very important for Windows Phone. IE on Windows Phone can not make use of
 * the window.history when using the hashbangs. This implementation provides some basic history
 * functionality for going back or going back multiple pages.
 *
 * @author Sam Verschueren      <verschueren.sam@endare.eu>
 * @since  7 Jan. 2014
 */

var historyService = angular.module('tnp.historyService', ['ngRoute']);

historyService.factory('$history', ['$rootScope', '$location', function ($rootScope, $location) {
    var stack = [];

    var _this = {
        _pop: function(nr) {
            nr = nr || 1;

            if(stack.length < nr) return undefined;

            var result = stack[stack.length-nr];

            stack.splice(-nr, nr);

            return result;
        },
        _onRouteChange: function(event, next, current) {
            if(current) {
                // First we have to reconstruct the original path
                var path = current.$$route.originalPath;
                var params = current.pathParams;
                var qs = current.params;

                var regex = new RegExp(':([^\/]+)', 'g');

                var matches = path.match(regex) || [];

                for(var i=0; i<matches.length; i++) {
                    var key = matches[i].replace(':', '');

                    delete qs[key];

                    path = path.replace(matches[i], params[key]);
                }

                var temp = [];
                for(var key in qs) {
                    temp.push(key + '=' + qs[key]);
                }

                if(temp.length > 0) {
                    path += '?' + temp.join('&');
                }

                if(path != '') {
                    // Push the path to the historystack
                    stack.push(path);
                }
            }
        },
        _go: function(numberOfPages) {
            var popper = _this._pop(numberOfPages);

            deregistration();

            $location.url(popper);

            var locChangeListener = $rootScope.$on('$locationChangeSuccess', function() {
                deregistration = $rootScope.$on('$routeChangeStart', _this._onRouteChange);

                locChangeListener();
            });
        }
    };

    var deregistration = $rootScope.$on('$routeChangeStart', _this._onRouteChange);

    return {
        /**
         * This method makes sure that we go back 1 page if possible.
         */
        back: function() {
            _this._go(1);
        },
        /**
         * This method can go back a specified number of pages. If it's not possible to
         * go back the number of pages specified, it will not do anything.
         *
         * @param  {Number} numberOfPages The number of pages we want to go back.
         */
        go: function(numberOfPages) {
            _this._go(numberOfPages);
        },
        /**
         * This method returns a boolean indicating if we can go back in history or not.
         *
         * @return {Boolean} A boolean indicating if wen can go back or not.
         */
        canGoBack: function() {
            return stack.length > 0;
        },
        /**
         * Returns the number of pages in the stack.
         *
         * @return {Number} The number of items in the stack.
         */
        length: function() {
            return stack.length;
        },
        /**
         * This method allows the user to push a certain page on the stack.
         *
         * @param  {String} page The page that should be pushed on the stack.
         */
        pushState: function(page) {
            stack.push(page);
        },
        /**
         * Clears the entire history.
         */
        clear: function() {
            stack = [];
        }
    };
}]);


'use strict';

/**
 * This file consist of multiple services that knows how to sync the data with the online
 * database. This means that the service will return cached data if it exist and will
 * ask the API if there are updates since the last update.
 *
 * @author 	Sam Verschueren	<verschueren.sam@endare.eu>
 * @since 	20 Nov. 2013
 */

var services = angular.module('tnp.services', ['tnp.policeService', 'tnp.syncService', 'tnp.uiService', 'tnp.historyService', 'endare.database']);

services.factory('$newsService', ['$dbContext', '$api', '$syncService', '$config', function($dbContext, $api, $syncService, $config) {
	function findLocalNews(offset, callback) {
		if(isNaN(offset)) {
			callback = offset;
			offset = 0;
		}

		var now = new Date().getTime();

		var where = {
            archived: 0,
            and: [
                {
                    or: [
                        {
                            showfrom: {lte: now}
                        },
                        {
                            showfrom: 'NULL'
                        }
                    ]
                },
                {
                    or: [
                        {
                            showuntil: {gte: now}
                        },
                        {
                            showuntil: 'NULL'
                        }
                    ]
                }
            ]
        };

		$dbContext.select('news', {where: where, offset: offset, order: 'date DESC', limit: 10}, function(err, data) {
			if(callback) callback(err, data);
		});
	}

	return {
		cache: {
			data: new Array()
		},
		findNews: function(offset, callback) {
			if(isNaN(offset)) {
				callback = offset;
				offset = 0;
			}

			if(offset == 0) {
				$syncService.getSince('news', function(err, since) {
					$syncService.sync($api.getNews, since, function() {
						findLocalNews(offset, callback);
					});
				});
			}
			else {
				findLocalNews(offset, callback);
			}
		},
		findNewsById: function(id, callback) {
			$api.getNewsItem(id, callback);
		}
	}
}]);

services.factory('$officerService', ['$api', function($api) {
	return {
		cache: {
			data: new Array(),
			officers: {}
		},
		findRegions: function(callback) {
			$api.getRegionsWithOfficers(callback);
		},
		findOfficerById: function(id, callback) {
			$api.getOfficer(id, callback);
		},
		findStreet: function(latitude, longitude, callback) {
			$api.getStreet(latitude, longitude, callback);
		},
		findOfficersByLocation: function(street, callback){
			$api.getOfficersByLocation(street, callback);
		}
	}
}]);

services.factory('$officeService', ['$api', function($api) {
	return {
		cache: {
			data: new Array()
		},
		findOffices: function(callback) {
			$api.getOffices(callback);
		},
		findOfficeById: function(id, callback) {
			$api.getOffice(id, callback);
		}
	}
}]);

services.factory('$checkService', ['$api', '$dbContext', '$syncService', '$config', function($api, $dbContext, $syncService, $config) {
	function findLocalChecks(offset, callback) {
		if(isNaN(offset)) {
			callback = offset;
			offset = 0;
		}

		var now = new Date().getTime();

		var where = {
			archived: 0,
			and: [
				{
					or: [
						{
							showfrom: {lte: now}
						},
						{
							showfrom: 'NULL'
						}
					]
				},
				{
					or: [
						{
							showuntil: {gte: now}
						},
						{
							showuntil: 'NULL'
						}
					]
				}
			]
		};

		$dbContext.select('check', {where: where, offset: offset, order: 'date DESC', limit: 10}, function(err, data) {
			callback(err, data);
		});
	}

	return {
		cache: {
			data: new Array()
		},
		findChecks: function(offset, callback) {
			if(isNaN(offset)) {
				callback = offset;
				offset = 0;
			}

			if(offset == 0) {
				$syncService.getSince('check', function(err, since) {
					$syncService.sync($api.getChecks, since, function() {
						findLocalChecks(offset, callback);
					});
				});
			}
			else {
				findLocalChecks(offset, callback);
			}
		}
	}
}]);

services.factory('$detectionService', ['$api', '$dbContext', '$syncService', '$config', function($api, $dbContext, $syncService, $config) {
	function findLocalDetections(offset, callback) {
		if(isNaN(offset)) {
			callback = offset;
			offset = 0;
		}

		var now = new Date().getTime();

		$dbContext.select('detection', {offset: offset, order: 'date DESC', limit: 10}, function(err, data) {
			if(callback) callback(err, data);
		});
	}

	return {
		cache: {
			data: new Array()
		},
		findDetections: function(offset, callback) {
			if(isNaN(offset)) {
				callback = offset;
				offset = 0;
			}

			if(offset == 0) {
				$syncService.getSince('detection', function(err, since) {
					$syncService.sync($api.getDetections, since, function() {
						findLocalDetections(offset, callback);
					});
				});
			}
			else {
				findLocalDetections(offset, callback);
			}
		}
	}
}]);

services.factory('$alertService', ['$api', '$config', '$syncService', '$dbContext', function($api, $config, $syncService, $dbContext) {
	function findLocalAlertTypes(callback) {
		$dbContext.select('alerttype', {order: 'name'}, function(err, data) {
			if(callback) callback(err, data);
		});
	}

	return {
		cache: {
			data: {},
			categories: {},
			reset: function() {
				this.data = {};
			}
		},
		findAlertTypes: function(callback) {
			$syncService.sync($api.getAlertTypes, function(err) {
				if(err) {
					if(callback)
						callback(err);
					return;
				}

				findLocalAlertTypes(callback);
			});
		},
		createAlert: function(data, callback) {
			$api.saveAlert(data, callback);
		}
	}
}]);

services.factory('$locationService', ['$q', '$rootScope', function($q, $rootScope) {
    var service = {
        location: function(options) {
            var d = $q.defer();
            var o = options || { };
            setTimeout(function () {
                try {
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            function (position) {
                                $rootScope.$apply(function () {
                                    d.resolve({
                                        longitude: position.coords.longitude,
                                        latitude: position.coords.latitude,
                                        accuracy: position.coords.accuracy
                                    });
                                });
                            },
                            function (error) {
                                d.reject(error);
                            },
                            o
                        );
                    }
                    else {
                        d.reject('location services not allowed');
                    }
                }
                catch (err) {
                    d.reject(err);
                }
            }, 1000);

            return d.promise;
        }
    };

    return service;
}]);


'use strict';

/**
 * This service offers extensions to the UI. Popup boxes and such should be defined
 * here.
 * 
 * @author  Sam Verschueren     <verschueren.sam@endare.eu>
 * @since   20 Dec. 2013
 */
var uiService = angular.module('tnp.uiService', []);

// Define the UI service
uiService.factory('$uiService', [function() {
    return {
        /**
         * This method shows a confirmation popup box.
         * 
         * @param  {Object}   obj      The configuration of the popup like title, message and button labels.
         * @param  {Function} callback The callback method is called when the user presses a button.
         */
        confirm: function(obj, callback) {
            obj = obj || {};
            obj.title = obj.title || 'Confirm';
            obj.message = obj.message || '';
            obj.labels = obj.labels || ['OK', 'Annuleren'];

            if(obj.labels.length == 0) {
                obj.labels = ['OK', 'Annuleren'];
            }
            else if(obj.labels.length == 1) {
                obj.labels.push('Annuleren');
            }

            var overlay = document.createElement('div');
            overlay.setAttribute('id', 'alert');

            var title = document.createElement('h1');
            title.appendChild(document.createTextNode(obj.title));

            var message = document.createElement('div');
            message.innerHTML = obj.message;

            var confirm = document.createElement('button');
            confirm.setAttribute('class', 'confirm');
            confirm.addEventListener('click', function() {
                document.body.removeChild(overlay);
                if(callback) callback(true);
            });
            confirm.appendChild(document.createTextNode(obj.labels[0]));

            var cancel = document.createElement('button');
            cancel.setAttribute('class', 'deny');
            cancel.addEventListener('click', function() {
                document.body.removeChild(overlay);
                if(callback) callback(false);
            });
            cancel.appendChild(document.createTextNode(obj.labels[1]));

            var box = document.createElement('div');
            box.appendChild(title);
            box.appendChild(message);
            box.appendChild(confirm);
            box.appendChild(cancel);

            overlay.appendChild(box);
            
            document.body.appendChild(overlay);
        },
        /**
         * This method shows an alert popup.
         * 
         * @param  {Object}   obj      The configuration of the popup like title, message and label.
         * @param  {Function} callback The callback method is called when the user presses the button.
         */
        alert: function(obj, callback) {
            obj = obj || {};
            obj.title = obj.title || 'Confirm';
            obj.message = obj.message || '';
            obj.label = obj.label || 'OK';

            var overlay = document.createElement('div');
            overlay.setAttribute('id', 'alert');

            var title = document.createElement('h1');
            title.appendChild(document.createTextNode(obj.title));

            var message = document.createElement('div');
            message.innerHTML = obj.message;

            var confirm = document.createElement('button');
            confirm.setAttribute('class', 'confirm');
            confirm.addEventListener('click', function() {
                document.body.removeChild(overlay);
                if(callback) callback();
            });
            confirm.appendChild(document.createTextNode(obj.label));

            var box = document.createElement('div');
            box.appendChild(title);
            box.appendChild(message);
            box.appendChild(confirm);

            overlay.appendChild(box);
            
            document.body.appendChild(overlay);
        }
    }
}]);

'use strict';

/**
 * This service is used for syncing data into the local database. It does not know how to call an API or something else.
 * The only thing this service knows is how to synchronize the data that the API method returns. The API method
 * to call is passed through as parameter in the sync method.
 *
 * @author  Sam Verschueren <verschueren.sam@endare.eu>
 * @since   19 Dec. 2013
 */
var syncService = angular.module('tnp.syncService', ['tnp.config', 'endare.database']);

// Define the syncservice
syncService.factory('$syncService', ['$dbContext', '$config', function($dbContext, $config) {
    return {
        /**
         * This method knows how to sync the data it receives from the api in the local database.
         *
         * @param  {Function} method    The method that should be invoked in order to retrieve online data.
         * @param  {Number}   since     The timestamp that indicates since when we want to retrieve the updates from the server.
         * @param  {Function} callback  The callback method that should be invoked if everything went fine.
         */
        sync: function(method, since, callback) {
            if(isNaN(since)) {
                callback = since;
                since = 0;
            }

            method(since, dataHandler);

            function dataHandler(err, data) {
                if(err) {
                    if(callback)
                        callback(err);

                    return;
                }

                $dbContext.insert(data.name, data.items, function(err) {
                    if(err) {
                        return callback(err);
                    }

                    if(data.nextPageToken) {
                        method(since, data.nextPageToken, dataHandler);
                    }
                    else {
                        callback();
                    }
                });
            }
        },
        /**
         * This method returns the highest timestamp in the table provided.
         * 
         * @param  {String}   table    The table name in which we want to search for a timestamp.
         * @param  {Function} callback The callback method that should be invoked if on return.
         */
        getSince: function(table, callback) {
            $dbContext.select(table, ['lastEdited', 'date'], function(err, data) {
                function calculate() {
                    if(err) {
                        return callback(err);
                    }

                    var max = 0;

                    for(var i=0; i<data.length; i++) {
                        max = Math.max(data[i].date, max);
                        max = Math.max(data[i].lastEdited || 0, max);
                    }

                    callback(undefined, max);
                }

                setTimeout(calculate, 0);
            });
        }
    }
}]);

'use strict';

/**
 * This service is used to call the API to retrieve data from it. In this file, you will only
 * find API related code.
 *
 * @author 	Sam Verschueren	<verschueren.sam@endare.eu>
 * @since 	20 Nov. 2013
 */

var policeService = angular.module('tnp.policeService', ['tnp.config']);

policeService.factory('$api', ['$http', '$config', function($http, $config) {
	/**
	 * This method generates the correct API key for the department
	 * specified in the config file.
	 * 
	 * @return {String}   The encrypted API key.
	 */
	function getApiKey() {
		var now = new Date();
		var message = String(now.getDate()) + String(now.getMonth()) + $config.DEPARTMENT + String(now.getFullYear()) + '.998423d9-2a38-478e-98a6-4be76758b984'

		// Generate the sha256 hash
		var hash = CryptoJS.SHA256(message);

		return hash.toString();
	}

	function fetch(method, id, since, page, callback) {
		var apiKey = getApiKey();

		var parameters = [];
		parameters.push('apiKey=' + apiKey);

		if(isNaN(id) && id !== undefined) {
			callback = id;
			id = undefined;
		}
		else {
			if(isNaN(since)) {
				callback = since;
				since = undefined;
			}
			else {
				parameters.push('since=' + since);

				if(isNaN(page)) {
					callback = page;
					page = undefined
				}
				else {
					parameters.push('page=' + page);
				}
			}
		}

		// Construct the URI
		var uri = $config.API_URI + '/' + $config.DEPARTMENT + '/' + method;
		uri += id ? '/' + id : '';
		uri += '?' + parameters.join('&');

		request(uri, callback);
	}

	function request(uri, page, callback) {
		if(isNaN(page)) {
			callback = page;
			page = 0;
		}

		console.log(uri);

		// Retrieve the data from the URI
		$http.get(uri).success(function(data) {
			// The data was retrieved succesfully so if we have a callback, return the data
			if(callback) callback(undefined, data, page);
		}).error(function(data, status) {
			// Something went wrong so if we have a callback, return an error object
			if(callback) callback(new Error(status));
		});
	}

	function create(method, data, callback) {
		var apiKey = getApiKey();

		var parameters = [];
		parameters.push('apiKey=' + apiKey);

		var uri = $config.API_URI + '/' + $config.DEPARTMENT + '/' + method;
		uri += '?' + parameters.join('&');

		$http.post(uri, data).success(function(data) {
			if(callback) callback(undefined, data);
		}).error(function(data, status) {
			if(callback) callback(new Error(status));
		});
	}

	return {
		/**
		 * Returns the news of the specified department since the timestamp specified.
		 * 
		 * @param  {Number}   since  	 The resultset should only consist of items that are changed after this timestamp.
		 * @param  {Function} callback   The callback method to executed when the data is received.
		 */
		getNews: function(since, page, callback) {
			// If the second parameter is not a number, it is the callback.
			// This method can then be called with or without since. 
			if(isNaN(since)) {
				callback = since;
				since = 0;
				page = 0;
			}
			else if(isNaN(page)) {
				callback = page;
				page = 0;
			}

			fetch('news', undefined, since, page, callback);
		},
		/**
		 * This method will return an individual newsitem that should be shown to the user.
		 * 
		 * @param  {[type]}   id       The id of the newsitem that should be fetched.
		 * @param  {Function} callback The callback method that should be invoked when the server responded.
		 */
		getNewsItem: function(id, callback) {
			fetch('news', id, callback);
		},
		/**
		 * Returns the officers of the specified department.
		 * 
		 * @param  {Function} callback   The callback method to executed when the data is received.
		 */
		getRegionsWithOfficers: function(callback) {
			fetch('regions', callback);
		},
		/**
		 * Returns the officer with the specified ID and all it contacts.
		 * 
		 * @param  {Number}   id       The unique id of the officer.
		 * @param  {Function} callback The callback method that should be called when the data is loaded.
		 */
		getOfficer: function(id, callback) {
			fetch('officer', id, callback);
		},

		/**
		 * Returns the officers in the street corresponding to the street provided as
		 * parameter.
		 * @param  {String}   street   The location of the user
		 * @param  {Function} callback  The callback method that should be called when the officers are loaded.
		 */
		getOfficersByLocation: function(street, callback) {
			var uri = $config.API_URI + '/' + $config.DEPARTMENT + '/officer/location/' + street + '?apiKey=' + getApiKey();

			request(uri, callback);
		},

		/**
		 * Returns the officers in the street corresponding to the street provided as
		 * parameter.
		 * 
		 * @param  {Number}   latitude  The latitude component of the location.
		 * @param  {Number}   longitude The longitude component of the location.
		 * @param  {Function} callback  The callback method that should be called when the officers are loaded.
		 */
		getStreet: function(latitude, longitude, callback){
			var qs = new Array();
			qs.push('latitude=' + latitude);
			qs.push('longitude=' + longitude);
			qs.push('apiKey=' + getApiKey());

			// Construct the URI
			var uri = $config.API_URI + '/search?' + qs.join('&');

			request(uri, callback);
		},
		/**
		 * Returns the offices of the department of the application.
		 * 
		 * @param  {Function} callback The callback method to execute when the data is loaded.
		 */
		getOffices: function(callback) {
			fetch('offices', callback);
		},
		/**
		 * Returns the office with the specified ID and all it's extra data like
		 * contacts and visitinghours.
		 * 
		 * @param  {Number}   id       The unique id of the office.
		 * @param  {Function} callback The callback method that should be called when the data is loaded.
		 */
		getOffice: function(id, callback) {
			fetch('offices', id, callback);
		},
		getChecks: function(since, page, callback) {
			if(isNaN(since)) {
				callback = since;
				since = 0;
				page = 0;
			}
			else if(isNaN(page)) {
				callback = page;
				page = 0;
			}

			fetch('checks', undefined, since, page, callback);
		},
		getDetections: function(since, page, callback) {
			if(isNaN(since)) {
				callback = since;
				since = 0;
				page = 0;
			}
			else if(isNaN(page)) {
				callback = page;
				page = 0;
			}

			fetch('detections', undefined, since, page, callback);
		},
		getAlertTypes: function(since, callback) {
			fetch('alerttypes', callback);
		},
		saveAlert: function(data, callback) {
			create('alert', data, callback);
		}
	}
}]);
